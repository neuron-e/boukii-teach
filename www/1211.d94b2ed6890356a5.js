(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1211],{5961:(Y,L,T)=>{"use strict";T.d(L,{GW:()=>c,dk:()=>Q,oK:()=>j});var j=function(F){return F.Prompt="PROMPT",F.Camera="CAMERA",F.Photos="PHOTOS",F}(j||{}),c=function(F){return F.Rear="REAR",F.Front="FRONT",F}(c||{}),Q=function(F){return F.Uri="uri",F.Base64="base64",F.DataUrl="dataUrl",F}(Q||{})},1211:(Y,L,T)=>{"use strict";T.d(L,{Y:()=>e});var j=T(5861),c=T(6689),Q=T(2726),F=T(5961);const E=(0,Q.fo)("Camera",{web:()=>T.e(6468).then(T.bind(T,6468)).then(t=>new t.CameraWeb)});var m=T(8963),A=T(6814);function n(t,g){if(1&t&&c._UZ(0,"img",14),2&t){const s=c.oxw(2);c.Q6J("src",s.filePreview,c.LSH)}}function o(t,g){if(1&t&&c._UZ(0,"video",15),2&t){const s=c.oxw(2);c.Q6J("src",s.filePreview,c.LSH)}}function f(t,g){if(1&t){const s=c.EpF();c.TgZ(0,"div",10),c.YNc(1,n,1,1,"img",11),c.YNc(2,o,1,1,"video",12),c.TgZ(3,"button",13),c.NdJ("click",function(){c.CHM(s);const r=c.oxw();return c.KtG(r.saveFile())}),c._uU(4,"Sauvegarder"),c.qZA()()}if(2&t){const s=c.oxw();c.xp6(1),c.Q6J("ngIf",!s.isVideo),c.xp6(1),c.Q6J("ngIf",s.isVideo)}}let e=(()=>{var t;class g{constructor(){this.title="T\xe9l\xe9verser un fichier",this.allowImage=!0,this.allowVideo=!0,this.isVideo=!1,this.close=new c.vpe,this.fileSelected=new c.vpe}onFileSelected(a){const r=a.target;if(r.files&&r.files.length>0){const u=r.files[0];this.isVideo=u.type.startsWith("video"),this.isVideo?this.previewVideo(u):this.resizeAndPreviewImage(u)}}openCamera(){var a=this;return(0,j.Z)(function*(){try{const r=yield E.getPhoto({quality:90,allowEditing:!1,resultType:F.dk.Uri,source:F.oK.Camera});if(a.isVideo="video"===r.format,a.isVideo)a.filePreview=r.webPath,a.fileResult={base64:r.webPath,isVideo:!0};else{const u=yield fetch(r.webPath).then(h=>h.blob());a.resizeAndPreviewImage(u)}}catch(r){console.error("Error accessing camera or gallery",r)}})()}resizeAndPreviewImage(a){this.resizeImage(a,600).then(u=>{this.filePreview=u,this.fileResult={base64:u,isVideo:!1}}).catch(u=>{console.error("Error resizing image:",u)})}previewVideo(a){const r=new FileReader;r.onload=()=>{this.filePreview=r.result,this.fileResult={base64:r.result,isVideo:!0}},r.readAsDataURL(a)}saveFile(){this.fileResult&&(this.fileSelected.emit(this.fileResult),this.close.emit())}doCloseModal(){this.close.emit()}get acceptTypes(){let a="";return this.allowImage&&(a+="image/*"),this.allowVideo&&(a+=this.allowImage?",video/*":"video/*"),a}resizeImage(a,r){return new Promise((u,h)=>{const d="image/png"===a.type,x=["image/png","image/gif","image/avif","image/bmp","image/tiff","image/ico","image/heic"].includes(a.type)?"image/jpeg":a.type||"image/jpeg",M=new FileReader;M.onload=U=>{const _=new Image;_.src=U.target.result,_.onload=()=>{let C=_.width,b=_.height;if(C>r||b>r)if(C>b){const y=r/C;C=r,b*=y}else{const y=r/b;b=r,C*=y}const w=document.createElement("canvas");if(w.width=C,w.height=b,d){const y=w.getContext("2d");y.fillStyle="white",y.fillRect(0,0,w.width,w.height)}const k=document.createElement("canvas");k.width=C,k.height=b,m().resize(_,k).then(y=>(w.getContext("2d").drawImage(k,0,0,C,b),m().toBlob(w,x,.6))).then(y=>{const S=new FileReader;S.onloadend=()=>u(S.result),S.readAsDataURL(y)}).catch(h)}},M.readAsDataURL(a)})}}return(t=g).\u0275fac=function(a){return new(a||t)},t.\u0275cmp=c.Xpm({type:t,selectors:[["app-file-upload"]],inputs:{title:"title",allowImage:"allowImage",allowVideo:"allowVideo"},outputs:{close:"close",fileSelected:"fileSelected"},decls:14,vars:3,consts:[[1,"modal"],[1,"modal-content","content-background-image"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","modal-close",3,"click"],[1,"title-upload","mt-24","mb-24"],[1,"file-upload"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],[1,"content-button","btn-back-grey","montserrat",3,"click"],[1,"camera-upload","mt-24"],["class","mt-24 mb-32",4,"ngIf"],[1,"mt-24","mb-32"],["class","preview",3,"src",4,"ngIf"],["class","preview","muted","","playsinline","",3,"src",4,"ngIf"],[1,"content-button","btn-back-primary","montserrat","mt-24",3,"click"],[1,"preview",3,"src"],["muted","","playsinline","",1,"preview",3,"src"]],template:function(a,r){if(1&a){const u=c.EpF();c.TgZ(0,"div",0)(1,"div",1)(2,"img",2),c.NdJ("click",function(){return r.doCloseModal()}),c.qZA(),c.TgZ(3,"div",3),c._uU(4),c.qZA(),c.TgZ(5,"div",4)(6,"input",5,6),c.NdJ("change",function(d){return r.onFileSelected(d)}),c.qZA(),c.TgZ(8,"button",7),c.NdJ("click",function(){c.CHM(u);const d=c.MAs(7);return c.KtG(d.click())}),c._uU(9,"Choisir le fichier"),c.qZA()(),c.TgZ(10,"div",8)(11,"button",7),c.NdJ("click",function(){return r.openCamera()}),c._uU(12,"Utiliser la cam\xe9ra"),c.qZA()(),c.YNc(13,f,5,2,"div",9),c.qZA()()}2&a&&(c.xp6(4),c.Oqu(r.title),c.xp6(2),c.Q6J("accept",r.acceptTypes),c.xp6(7),c.Q6J("ngIf",r.filePreview))},dependencies:[A.O5],styles:[".modal[_ngcontent-%COMP%]{width:100%;height:100vh;min-height:100vh;max-height:100vh;z-index:999;background:rgba(0,0,0,.7);position:fixed;top:0;left:0}.modal-content[_ngcontent-%COMP%]{width:80%;max-width:300px;padding:20px 16px;position:relative;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:8px;text-align:center}.modal-close[_ngcontent-%COMP%]{width:28px;position:absolute;top:8px;right:8px}.title-upload[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px}"]}),g})()},8963:Y=>{Y.exports=function c(Q,F,E){function m(o,f){if(!F[o]){if(!Q[o]){if(A)return A(o,!0);var t=new Error("Cannot find module '"+o+"'");throw t.code="MODULE_NOT_FOUND",t}var g=F[o]={exports:{}};Q[o][0].call(g.exports,function(s){return m(Q[o][1][s]||s)},g,g.exports,c,Q,F,E)}return F[o].exports}for(var A=void 0,n=0;n<E.length;n++)m(E[n]);return m}({1:[function(c,Q,F){"use strict";var E=c("multimath"),m=c("./mm_unsharp_mask"),A=c("./mm_resize");function n(o){var f=o||[],e={js:f.indexOf("js")>=0,wasm:f.indexOf("wasm")>=0};E.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(m),this.use(A)}(n.prototype=Object.create(E.prototype)).constructor=n,n.prototype.resizeAndUnsharp=function(f,e){var t=this.resize(f,e);return f.unsharpAmount&&this.unsharp_mask(t,f.toWidth,f.toHeight,f.unsharpAmount,f.unsharpRadius,f.unsharpThreshold),t},Q.exports=n},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(c,Q,F){"use strict";function E(e){return e<0?0:e>255?255:e}function m(e){return e>=0?e:0}Q.exports={convolveHor:function A(e,t,g,s,a,r){var u,h,d,B,x,M,U,_,C,b,w,k=0,y=0;for(C=0;C<s;C++){for(x=0,b=0;b<a;b++){for(M=r[x++],U=r[x++],_=k+4*M|0,u=h=d=B=0;U>0;U--)B=B+(w=r[x++])*e[_+3]|0,d=d+w*e[_+2]|0,h=h+w*e[_+1]|0,u=u+w*e[_]|0,_=_+4|0;t[y+3]=m(B>>7),t[y+2]=m(d>>7),t[y+1]=m(h>>7),t[y]=m(u>>7),y=y+4*s|0}y=4*(C+1)|0,k=(C+1)*g*4|0}},convolveVert:function n(e,t,g,s,a,r){var u,h,d,B,x,M,U,_,C,b,w,k=0,y=0;for(C=0;C<s;C++){for(x=0,b=0;b<a;b++){for(M=r[x++],U=r[x++],_=k+4*M|0,u=h=d=B=0;U>0;U--)B=B+(w=r[x++])*e[_+3]|0,d=d+w*e[_+2]|0,h=h+w*e[_+1]|0,u=u+w*e[_]|0,_=_+4|0;u>>=7,h>>=7,d>>=7,t[y+3]=E(8192+(B>>=7)>>14),t[y+2]=E(d+8192>>14),t[y+1]=E(h+8192>>14),t[y]=E(u+8192>>14),y=y+4*s|0}y=4*(C+1)|0,k=(C+1)*g*4|0}},convolveHorWithPre:function o(e,t,g,s,a,r){var u,h,d,B,x,M,U,_,C,b,w,k,y=0,S=0;for(b=0;b<s;b++){for(M=0,w=0;w<a;w++){for(U=r[M++],_=r[M++],C=y+4*U|0,u=h=d=B=0;_>0;_--)B=B+(k=r[M++])*(x=e[C+3])|0,d=d+k*e[C+2]*x|0,h=h+k*e[C+1]*x|0,u=u+k*e[C]*x|0,C=C+4|0;d=d/255|0,h=h/255|0,u=u/255|0,t[S+3]=m(B>>7),t[S+2]=m(d>>7),t[S+1]=m(h>>7),t[S]=m(u>>7),S=S+4*s|0}S=4*(b+1)|0,y=(b+1)*g*4|0}},convolveVertWithPre:function f(e,t,g,s,a,r){var u,h,d,B,x,M,U,_,C,b,w,k=0,y=0;for(C=0;C<s;C++){for(x=0,b=0;b<a;b++){for(M=r[x++],U=r[x++],_=k+4*M|0,u=h=d=B=0;U>0;U--)B=B+(w=r[x++])*e[_+3]|0,d=d+w*e[_+2]|0,h=h+w*e[_+1]|0,u=u+w*e[_]|0,_=_+4|0;u>>=7,h>>=7,d>>=7,(B=E(8192+(B>>=7)>>14))>0&&(u=255*u/B|0,h=255*h/B|0,d=255*d/B|0),t[y+3]=B,t[y+2]=E(d+8192>>14),t[y+1]=E(h+8192>>14),t[y]=E(u+8192>>14),y=y+4*s|0}y=4*(C+1)|0,k=(C+1)*g*4|0}}}},{}],3:[function(c,Q,F){"use strict";Q.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(c,Q,F){"use strict";Q.exports={name:"resize",fn:c("./resize"),wasm_fn:c("./resize_wasm"),wasm_src:c("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(c,Q,F){"use strict";var E=c("./resize_filter_gen"),m=c("./convolve"),A=m.convolveHor,n=m.convolveVert,o=m.convolveHorWithPre,f=m.convolveVertWithPre;Q.exports=function(s){var a=s.src,r=s.width,u=s.height,h=s.toWidth,d=s.toHeight,B=s.scaleX||s.toWidth/s.width,x=s.scaleY||s.toHeight/s.height,M=s.offsetX||0,U=s.offsetY||0,_=s.dest||new Uint8Array(h*d*4),C=typeof s.filter>"u"?"mks2013":s.filter,b=E(C,r,h,B,M),w=E(C,u,d,x,U),k=new Uint16Array(h*u*4);return function e(g,s,a){for(var r=3,u=s*a*4|0;r<u;){if(255!==g[r])return!0;r=r+4|0}return!1}(a,r,u)?(o(a,k,r,u,h,b),f(k,_,u,h,d,w)):(A(a,k,r,u,h,b),n(k,_,u,h,d,w),function t(g,s,a){for(var r=3,u=s*a*4|0;r<u;)g[r]=255,r=r+4|0}(_,h,d)),_}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(c,Q,F){"use strict";var E=c("./resize_filter_info");function A(n){return Math.round(16383*n)}Q.exports=function(o,f,e,t,g){var h,d,B,x,M,U,_,C,b,w,k,y,S,P,i,l,s=E.filter[o].fn,a=1/t,r=Math.min(1,t),u=E.filter[o].win/r,p=Math.floor(2*(u+1)),v=new Int16Array((p+2)*e),G=0,D=!v.subarray||!v.set;for(h=0;h<e;h++){for(d=(h+.5)*a+g,B=Math.max(0,Math.floor(d-u)),M=(x=Math.min(f-1,Math.ceil(d+u)))-B+1,U=new Float32Array(M),_=new Int16Array(M),C=0,b=B,w=0;b<=x;b++,w++)C+=k=s((b+.5-d)*r),U[w]=k;for(y=0,w=0;w<U.length;w++)y+=S=U[w]/C,_[w]=A(S);for(_[e>>1]+=A(1-y),P=0;P<_.length&&0===_[P];)P++;if(P<_.length){for(i=_.length-1;i>0&&0===_[i];)i--;if(l=i-P+1,v[G++]=B+P,v[G++]=l,D)for(w=P;w<=i;w++)v[G++]=_[w];else v.set(_.subarray(P,i+1),G),G+=l}else v[G++]=0,v[G++]=0}return v}},{"./resize_filter_info":7}],7:[function(c,Q,F){"use strict";Q.exports={filter:{box:{win:.5,fn:function(A){return A<0&&(A=-A),A<.5?1:0}},hamming:{win:1,fn:function(A){if(A<0&&(A=-A),A>=1)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*(.54+.46*Math.cos(n/1))}},lanczos2:{win:2,fn:function(A){if(A<0&&(A=-A),A>=2)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*Math.sin(n/2)/(n/2)}},lanczos3:{win:3,fn:function(A){if(A<0&&(A=-A),A>=3)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*Math.sin(n/3)/(n/3)}},mks2013:{win:2.5,fn:function(A){return A<0&&(A=-A),A>=2.5?0:A>=1.5?-.125*(A-2.5)*(A-2.5):A>=.5?.25*(4*A*A-11*A+7):1.0625-1.75*A*A}}},f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(c,Q,F){"use strict";var E=c("./resize_filter_gen");var o=!0;try{o=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch{}function f(e,t,g){if(o)t.set(function n(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),g);else for(var s=g,a=0;a<e.length;a++){var r=e[a];t[s++]=255&r,t[s++]=r>>8&255}}Q.exports=function(t){var g=t.src,s=t.width,a=t.height,r=t.toWidth,u=t.toHeight,h=t.scaleX||t.toWidth/t.width,d=t.scaleY||t.toHeight/t.height,B=t.offsetX||0,x=t.offsetY||0,M=t.dest||new Uint8Array(r*u*4),U=typeof t.filter>"u"?"mks2013":t.filter,_=E(U,s,r,h,B),C=E(U,a,u,d,x),w=Math.max(g.byteLength,M.byteLength),k=this.__align(0+w),S=this.__align(k+a*r*4*2),P=this.__align(S+_.byteLength),I=this.__instance("resize",P+C.byteLength),l=new Uint8Array(this.__memory.buffer),p=new Uint32Array(this.__memory.buffer),v=new Uint32Array(g.buffer);p.set(v),f(_,l,S),f(C,l,P);var G=I.exports.convolveHV||I.exports._convolveHV;return function m(e,t,g){for(var s=3,a=t*g*4|0;s<a;){if(255!==e[s])return!0;s=s+4|0}return!1}(g,s,a)?G(S,P,k,s,a,r,u,1):(G(S,P,k,s,a,r,u,0),function A(e,t,g){for(var s=3,a=t*g*4|0;s<a;)e[s]=255,s=s+4|0}(M,r,u)),new Uint32Array(M.buffer).set(new Uint32Array(this.__memory.buffer,0,u*r)),M}},{"./resize_filter_gen":6}],9:[function(c,Q,F){"use strict";Q.exports={name:"unsharp_mask",fn:c("./unsharp_mask"),wasm_fn:c("./unsharp_mask_wasm"),wasm_src:c("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(c,Q,F){"use strict";var E=c("glur/mono16");Q.exports=function(n,o,f,e,t,g){var s,a,r,u,h;if(!(0===e||t<.5)){t>2&&(t=2);var d=function m(A,n,o){for(var t,g,s,f=n*o,e=new Uint16Array(f),r=0;r<f;r++)s=A[4*r+2],e[r]=((t=A[4*r])>=(g=A[4*r+1])&&t>=s?t:g>=s&&g>=t?g:s)<<8;return e}(n,o,f),B=new Uint16Array(d);E(B,o,f,t);for(var x=e/100*4096+.5|0,M=g<<8,U=o*f,_=0;_<U;_++)u=(s=d[_])-B[_],Math.abs(u)>=M&&(n[h=4*_]=n[h]*(r=((a=(a=(a=s+(x*u+2048>>12))>65280?65280:a)<0?0:a)<<12)/(s=0!==s?s:1)|0)+2048>>12,n[h+1]=n[h+1]*r+2048>>12,n[h+2]=n[h+2]*r+2048>>12)}}},{"glur/mono16":18}],11:[function(c,Q,F){"use strict";Q.exports=function(m,A,n,o,f,e){if(!(0===o||f<.5)){f>2&&(f=2);var t=A*n,g=4*t,s=2*t,a=2*t,r=4*Math.max(A,n),d=g,B=d+s,x=B+a,M=x+a,U=M+r,_=this.__instance("unsharp_mask",g+s+2*a+r+32,{exp:Math.exp}),C=new Uint32Array(m.buffer);new Uint32Array(this.__memory.buffer).set(C);var w=_.exports.hsv_v16||_.exports._hsv_v16;w(0,d,A,n),(w=_.exports.blurMono16||_.exports._blurMono16)(d,B,x,M,U,A,n,f),(w=_.exports.unsharp||_.exports._unsharp)(0,0,d,B,A,n,o,e),C.set(new Uint32Array(this.__memory.buffer,0,t))}}},{}],12:[function(c,Q,F){"use strict";Q.exports="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"},{}],13:[function(c,Q,F){"use strict";function m(A,n){this.create=A,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=n||2e3}m.prototype.acquire=function(){var n,A=this;return 0!==this.available.length?n=this.available.pop():((n=this.create()).id=this.lastId++,n.release=function(){return A.release(n)}),this.acquired[n.id]=n,n},m.prototype.release=function(A){var n=this;delete this.acquired[A.id],A.lastUsed=Date.now(),this.available.push(A),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return n.gc()},100))},m.prototype.gc=function(){var A=this,n=Date.now();this.available=this.available.filter(function(o){return!(n-o.lastUsed>A.idle&&(o.destroy(),1))}),this.timeoutId=0!==this.available.length?setTimeout(function(){return A.gc()},100):0},Q.exports=m},{}],14:[function(c,Q,F){"use strict";Q.exports=function(A,n,o,f,e,t){var a=(2*t+2+1)/e;if(a>.5)return[[o,f]];var r=Math.ceil(Math.log(Math.min(o/A,f/n))/Math.log(a));if(r<=1)return[[o,f]];for(var u=[],h=0;h<r;h++){var d=Math.round(Math.pow(Math.pow(A,r-h-1)*Math.pow(o,h+1),1/r)),B=Math.round(Math.pow(Math.pow(n,r-h-1)*Math.pow(f,h+1),1/r));u.push([d,B])}return u}},{}],15:[function(c,Q,F){"use strict";var E=1e-5;function m(n){var o=Math.round(n);return Math.abs(n-o)<E?o:Math.floor(n)}function A(n){var o=Math.round(n);return Math.abs(n-o)<E?o:Math.ceil(n)}Q.exports=function(o){var f=o.toWidth/o.width,e=o.toHeight/o.height,t=m(o.srcTileSize*f)-2*o.destTileBorder,g=m(o.srcTileSize*e)-2*o.destTileBorder;if(t<1||g<1)throw new Error("Internal error in pica: target tile width/height is too small.");var s,a,r,u,h,d,x,B=[];for(u=0;u<o.toHeight;u+=g)for(r=0;r<o.toWidth;r+=t)(s=r-o.destTileBorder)<0&&(s=0),s+(h=r+t+o.destTileBorder-s)>=o.toWidth&&(h=o.toWidth-s),(a=u-o.destTileBorder)<0&&(a=0),a+(d=u+g+o.destTileBorder-a)>=o.toHeight&&(d=o.toHeight-a),x={toX:s,toY:a,toWidth:h,toHeight:d,toInnerX:r,toInnerY:u,toInnerWidth:t,toInnerHeight:g,offsetX:s/f-m(s/f),offsetY:a/e-m(a/e),scaleX:f,scaleY:e,x:m(s/f),y:m(a/e),width:A(h/f),height:A(d/e)},B.push(x);return B}},{}],16:[function(c,Q,F){"use strict";function E(m){return Object.prototype.toString.call(m)}Q.exports.isCanvas=function(A){var n=E(A);return"[object HTMLCanvasElement]"===n||"[object OffscreenCanvas]"===n||"[object Canvas]"===n},Q.exports.isImage=function(A){return"[object HTMLImageElement]"===E(A)},Q.exports.isImageBitmap=function(A){return"[object ImageBitmap]"===E(A)},Q.exports.limiter=function(A){var n=0,o=[];function f(){n<A&&o.length&&(n++,o.shift()())}return function(t){return new Promise(function(g,s){o.push(function(){t().then(function(a){g(a),n--,f()},function(a){s(a),n--,f()})}),f()})}},Q.exports.cib_quality_name=function(A){switch(A){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},Q.exports.cib_support=function(A){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var n=A(100,100);return createImageBitmap(n,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(o){var f=10===o.width;return o.close(),n=null,f})}).catch(function(){return!1})},Q.exports.worker_offscreen_canvas_support=function(){return new Promise(function(A,n){if(typeof OffscreenCanvas>"u")A(!1);else{var f=btoa("(".concat(function o(t){typeof createImageBitmap>"u"?t.postMessage(!1):Promise.resolve().then(function(){var g=new OffscreenCanvas(10,10);return g.getContext("2d").rect(0,0,1,1),createImageBitmap(g,0,0,1,1)}).then(function(){return t.postMessage(!0)},function(){return t.postMessage(!1)})}.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(f));e.onmessage=function(t){return A(t.data)},e.onerror=n}}).then(function(A){return A},function(){return!1})},Q.exports.can_use_canvas=function(A){var n=!1;try{var f=A(2,1).getContext("2d"),e=f.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,f.putImageData(e,0,0),e=null,12===(e=f.getImageData(0,0,2,1)).data[0]&&23===e.data[1]&&34===e.data[2]&&255===e.data[3]&&45===e.data[4]&&56===e.data[5]&&67===e.data[6]&&255===e.data[7]&&(n=!0)}catch{}return n},Q.exports.cib_can_use_region=function(){return new Promise(function(A){if(typeof Image>"u"||typeof createImageBitmap>"u")A(!1);else{var n=new Image;n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",n.onload=function(){createImageBitmap(n,0,0,n.width,n.height).then(function(o){A(o.width===n.width&&o.height===n.height)},function(){return A(!1)})},n.onerror=function(){return A(!1)}}})}},{}],17:[function(c,Q,F){"use strict";Q.exports=function(){var m,E=c("./mathlib");onmessage=function(n){var o=n.data.opts;if(!o.src&&o.srcBitmap){var e=new OffscreenCanvas(o.width,o.height),t=e.getContext("2d");t.drawImage(o.srcBitmap,0,0),o.src=t.getImageData(0,0,o.width,o.height).data,e.width=e.height=0,e=null,o.srcBitmap.close(),o.srcBitmap=null}m||(m=new E(n.data.features));var g=m.resizeAndUnsharp(o);postMessage({data:g},[g.buffer])}}},{"./mathlib":1}],18:[function(c,Q,F){var E,m,A,n,o,f;function s(r,u,h,d,B,x){var M,U,_,C,b,w,k,y,S,P,i,I,l,p;for(S=0;S<x;S++){for(k=S,y=0,C=b=(M=r[w=S*B])*d[6],i=d[0],I=d[1],l=d[4],p=d[5],P=0;P<B;P++)_=(U=r[w])*i+M*I+C*l+b*p,b=C,M=U,h[y]=C=_,y++,w++;for(y--,k+=x*(B-1),C=b=(M=r[--w])*d[7],U=M,i=d[2],I=d[3],P=B-1;P>=0;P--)_=U*i+M*I+C*l+b*p,b=C,M=U,U=r[w],u[k]=h[y]+(C=_),w--,y--,k-=x}}Q.exports=function a(r,u,h,d){if(d){var B=new Uint16Array(r.length),x=new Float32Array(Math.max(u,h)),M=function g(r){r<.5&&(r=.5);var u=Math.exp(.527076)/r,h=Math.exp(-u),d=Math.exp(-2*u),B=(1-h)*(1-h)/(1+2*u*h-d);return E=B,m=B*(u-1)*h,A=B*(u+1)*h,n=-B*d,o=2*h,f=-d,new Float32Array([E,m,A,n,o,f,(E+m)/(1-o-f),(A+n)/(1-o-f)])}(d);s(r,B,x,M,u,h),s(B,r,x,M,h,u)}}},{}],19:[function(c,Q,F){"use strict";var E=c("object-assign"),m=c("./lib/base64decode"),A=c("./lib/wa_detect"),n={js:!0,wasm:!0};function o(f){if(!(this instanceof o))return new o(f);var e=E({},n,f||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}o.prototype.has_wasm=A,o.prototype.use=function(f){return this.__modules[f.name]=f,this[f.name]=this.options.wasm&&this.has_wasm()&&f.wasm_fn?f.wasm_fn:f.fn,this},o.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var f=this;return this.__init_promise=Promise.all(Object.keys(f.__modules).map(function(e){var t=f.__modules[e];return f.options.wasm&&f.has_wasm()&&t.wasm_fn&&!f.__wasm[e]?WebAssembly.compile(f.__base64decode(t.wasm_src)).then(function(g){f.__wasm[e]=g}):null})).then(function(){return f}),this.__init_promise},o.prototype.__base64decode=m,o.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},o.prototype.__instance=function(e,t,g){if(t&&this.__reallocate(t),this.__wasm[e]||(this.__wasm[e]=new WebAssembly.Module(this.__base64decode(this.__modules[e].wasm_src))),!this.__cache[e]){var a={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:E(a,g||{})})}return this.__cache[e]},o.prototype.__align=function(e,t){var g=e%(t=t||8);return e+(g?t-g:0)},Q.exports=o},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(c,Q,F){"use strict";Q.exports=function(A){for(var n=A.replace(/[\r\n=]/g,""),o=n.length,f=new Uint8Array(3*o>>2),e=0,t=0,g=0;g<o;g++)g%4==0&&g&&(f[t++]=e>>16&255,f[t++]=e>>8&255,f[t++]=255&e),e=e<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(n.charAt(g));var s=o%4*6;return 0===s?(f[t++]=e>>16&255,f[t++]=e>>8&255,f[t++]=255&e):18===s?(f[t++]=e>>10&255,f[t++]=e>>2&255):12===s&&(f[t++]=e>>4&255),f}},{}],21:[function(c,Q,F){"use strict";var E;Q.exports=function(){if(typeof E<"u"||(E=!1,typeof WebAssembly>"u"))return E;try{var A=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),n=new WebAssembly.Module(A);return 0!==new WebAssembly.Instance(n,{}).exports.test(4)&&(E=!0),E}catch{}return E}},{}],22:[function(c,Q,F){"use strict";var E=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;Q.exports=function o(){try{if(!Object.assign)return!1;var f=new String("abc");if(f[5]="de","5"===Object.getOwnPropertyNames(f)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(a){return e[a]}).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(a){s[a]=a}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch{return!1}}()?Object.assign:function(f,e){for(var t,s,g=function n(f){if(null==f)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(f)}(f),a=1;a<arguments.length;a++){for(var r in t=Object(arguments[a]))m.call(t,r)&&(g[r]=t[r]);if(E){s=E(t);for(var u=0;u<s.length;u++)A.call(t,s[u])&&(g[s[u]]=t[s[u]])}}return g}},{}],23:[function(c,Q,F){var E=arguments[3],m=arguments[4],A=arguments[5],n=JSON.stringify;Q.exports=function(o,f){for(var e,t=Object.keys(A),g=0,s=t.length;g<s;g++){var r=A[a=t[g]].exports;if(r===o||r&&r.default===o){e=a;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var u={};for(g=0,s=t.length;g<s;g++){var a;u[a=t[g]]=a}m[e]=["function(require,module,exports){"+o+"(self); }",u]}var h=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[e]=e,m[h]=["function(require,module,exports){var f = require("+n(e)+");(f.default ? f.default : f)(self);}",d];var B={};!function x(w){for(var k in B[w]=!0,m[w][1]){var y=m[w][1][k];B[y]||x(y)}}(h);var M="("+E+")({"+Object.keys(B).map(function(w){return n(w)+":["+m[w][0]+","+n(m[w][1])+"]"}).join(",")+"},{},["+n(h)+"])",U=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([M],{type:"text/javascript"});if(f&&f.bare)return _;var C=U.createObjectURL(_),b=new Worker(C);return b.objectURL=C,b}},{}],"/index.js":[function(c,Q,F){"use strict";function E(i,I){return function f(i){if(Array.isArray(i))return i}(i)||function o(i,I){var l=null==i?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(null!=l){var D,R,p=[],v=!0,G=!1;try{for(l=l.call(i);!(v=(D=l.next()).done)&&(p.push(D.value),!I||p.length!==I);v=!0);}catch(O){G=!0,R=O}finally{try{!v&&null!=l.return&&l.return()}finally{if(G)throw R}}return p}}(i,I)||function A(i,I){if(i){if("string"==typeof i)return n(i,I);var l=Object.prototype.toString.call(i).slice(8,-1);if("Object"===l&&i.constructor&&(l=i.constructor.name),"Map"===l||"Set"===l)return Array.from(i);if("Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return n(i,I)}}(i,I)||function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(i,I){(null==I||I>i.length)&&(I=i.length);for(var l=0,p=new Array(I);l<I;l++)p[l]=i[l];return p}var e=c("object-assign"),t=c("webworkify"),g=c("./lib/mathlib"),s=c("./lib/pool"),a=c("./lib/utils"),r=c("./lib/worker"),u=c("./lib/stepper"),h=c("./lib/tiler"),d=c("./lib/mm_resize/resize_filter_info"),B={},x=!1;try{typeof navigator<"u"&&navigator.userAgent&&(x=navigator.userAgent.indexOf("Safari")>=0)}catch{}var M=1;typeof navigator<"u"&&(M=Math.min(navigator.hardwareConcurrency||1,4));var U={tile:1024,concurrency:M,features:["js","wasm","ww"],idle:2e3,createCanvas:function(I,l){var p=document.createElement("canvas");return p.width=I,p.height=l,p}},_={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},C=!1,b=!1,w=!1,k=!1,y=!1;function S(){return{value:t(r),destroy:function(){if(this.value.terminate(),typeof window<"u"){var I=window.URL||window.webkitURL||window.mozURL||window.msURL;I&&I.revokeObjectURL&&this.value.objectURL&&I.revokeObjectURL(this.value.objectURL)}}}}function P(i){if(!(this instanceof P))return new P(i);this.options=e({},U,i||{});var I="lk_".concat(this.options.concurrency);this.__limit=B[I]||a.limiter(this.options.concurrency),B[I]||(B[I]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}P.prototype.init=function(){var i=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),C=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?b=!0:this.debug("ImageBitmap does not support .close(), disabled"));var I=this.options.features.slice();if(I.indexOf("all")>=0&&(I=["cib","wasm","js","ww"]),this.__requested_features=I,this.__mathlib=new g(I),I.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{c("webworkify")(function(){}).terminate(),this.features.ww=!0;var p="wp_".concat(JSON.stringify(this.options));B[p]?this.__workersPool=B[p]:(this.__workersPool=new s(S,this.options.idle),B[p]=this.__workersPool)}catch{}var G,D,v=this.__mathlib.init().then(function(O){e(i.features,O.features)});G=b?a.cib_support(this.options.createCanvas).then(function(O){i.features.cib&&I.indexOf("cib")<0?i.debug("createImageBitmap() resize supported, but disabled by config"):I.indexOf("cib")>=0&&(i.features.cib=O)}):Promise.resolve(!1),w=a.can_use_canvas(this.options.createCanvas),D=(D=b&&C&&-1!==I.indexOf("ww")?a.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(O){k=O});var R=a.cib_can_use_region().then(function(O){y=O});return this.__initPromise=Promise.all([v,G,D,R]).then(function(){return i}),this.__initPromise},P.prototype.__invokeResize=function(i,I){var l=this;return I.__mathCache=I.__mathCache||{},Promise.resolve().then(function(){return l.features.ww?new Promise(function(p,v){var G=l.__workersPool.acquire();I.cancelToken&&I.cancelToken.catch(function(R){return v(R)}),G.value.onmessage=function(R){G.release(),R.data.err?v(R.data.err):p(R.data)};var D=[];i.src&&D.push(i.src.buffer),i.srcBitmap&&D.push(i.srcBitmap),G.value.postMessage({opts:i,features:l.__requested_features,preload:{wasm_nodule:l.__mathlib.__}},D)}):{data:l.__mathlib.resizeAndUnsharp(i,I.__mathCache)}})},P.prototype.__extractTileData=function(i,I,l,p,v){if(this.features.ww&&k&&(a.isCanvas(I)||y))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(p.srcImageBitmap||I,i.x,i.y,i.width,i.height).then(function(R){return v.srcBitmap=R,v});if(a.isCanvas(I))return p.srcCtx||(p.srcCtx=I.getContext("2d")),this.debug("Get tile pixel data"),v.src=p.srcCtx.getImageData(i.x,i.y,i.width,i.height).data,v;this.debug("Draw tile imageBitmap/image to temporary canvas");var G=this.options.createCanvas(i.width,i.height),D=G.getContext("2d");return D.globalCompositeOperation="copy",D.drawImage(p.srcImageBitmap||I,i.x,i.y,i.width,i.height,0,0,i.width,i.height),this.debug("Get tile pixel data"),v.src=D.getImageData(0,0,i.width,i.height).data,G.width=G.height=0,v},P.prototype.__landTileData=function(i,I,l){var p;if(this.debug("Convert raw rgba tile result to ImageData"),I.bitmap)return l.toCtx.drawImage(I.bitmap,i.toX,i.toY),null;if(C)p=new ImageData(new Uint8ClampedArray(I.data),i.toWidth,i.toHeight);else if((p=l.toCtx.createImageData(i.toWidth,i.toHeight)).data.set)p.data.set(I.data);else for(var v=p.data.length-1;v>=0;v--)p.data[v]=I.data[v];return this.debug("Draw tile"),x?l.toCtx.putImageData(p,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth+1e-5,i.toInnerHeight+1e-5):l.toCtx.putImageData(p,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth,i.toInnerHeight),null},P.prototype.__tileAndResize=function(i,I,l){var p=this,v={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(function(){if(v.toCtx=I.getContext("2d"),a.isCanvas(i))return null;if(a.isImageBitmap(i))return v.srcImageBitmap=i,v.isImageBitmapReused=!0,null;if(a.isImage(i))return b?(p.debug("Decode image via createImageBitmap"),createImageBitmap(i).then(function(D){v.srcImageBitmap=D}).catch(function(D){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(l.canceled)return l.cancelToken;p.debug("Calculate tiles");var R=h({width:l.width,height:l.height,srcTileSize:p.options.tile,toWidth:l.toWidth,toHeight:l.toHeight,destTileBorder:l.__destTileBorder}).map(function(H){return function(R){return p.__limit(function(){if(l.canceled)return l.cancelToken;var O={width:R.width,height:R.height,toWidth:R.toWidth,toHeight:R.toHeight,scaleX:R.scaleX,scaleY:R.scaleY,offsetX:R.offsetX,offsetY:R.offsetY,filter:l.filter,unsharpAmount:l.unsharpAmount,unsharpRadius:l.unsharpRadius,unsharpThreshold:l.unsharpThreshold};return p.debug("Invoke resize math"),Promise.resolve(O).then(function(H){return p.__extractTileData(R,i,l,v,H)}).then(function(H){return p.debug("Invoke resize math"),p.__invokeResize(H,l)}).then(function(H){return l.canceled?l.cancelToken:(v.srcImageData=null,p.__landTileData(R,H,v))})})}(H)});function O(H){H.srcImageBitmap&&(H.isImageBitmapReused||H.srcImageBitmap.close(),H.srcImageBitmap=null)}return p.debug("Process tiles"),Promise.all(R).then(function(){return p.debug("Finished!"),O(v),I},function(H){throw O(v),H})})},P.prototype.__processStages=function(i,I,l,p){var v=this;if(p.canceled)return p.cancelToken;var N,W,D=E(i.shift(),2),R=D[0],O=D[1],H=0===i.length;return N=H||d.q2f.indexOf(p.filter)<0?p.filter:"box"===p.filter?"box":"hamming",p=e({},p,{toWidth:R,toHeight:O,filter:N}),H||(W=this.options.createCanvas(R,O)),this.__tileAndResize(I,H?l:W,p).then(function(){return H?l:(p.width=R,p.height=O,v.__processStages(i,W,l,p))}).then(function(q){return W&&(W.width=W.height=0),q})},P.prototype.__resizeViaCreateImageBitmap=function(i,I,l){var p=this,v=I.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(i,{resizeWidth:l.toWidth,resizeHeight:l.toHeight,resizeQuality:a.cib_quality_name(d.f2q[l.filter])}).then(function(G){if(l.canceled)return l.cancelToken;if(!l.unsharpAmount)return v.drawImage(G,0,0),G.close(),v=null,p.debug("Finished!"),I;p.debug("Unsharp result");var D=p.options.createCanvas(l.toWidth,l.toHeight),R=D.getContext("2d");R.drawImage(G,0,0),G.close();var O=R.getImageData(0,0,l.toWidth,l.toHeight);return p.__mathlib.unsharp_mask(O.data,l.toWidth,l.toHeight,l.unsharpAmount,l.unsharpRadius,l.unsharpThreshold),v.putImageData(O,0,0),D.width=D.height=0,O=R=D=v=null,p.debug("Finished!"),I})},P.prototype.resize=function(i,I,l){var p=this;this.debug("Start resize...");var v=e({},_);if(isNaN(l)?l&&(v=e(v,l)):v=e(v,{quality:l}),v.toWidth=I.width,v.toHeight=I.height,v.width=i.naturalWidth||i.width,v.height=i.naturalHeight||i.height,Object.prototype.hasOwnProperty.call(v,"quality")){if(v.quality<0||v.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(v.quality));v.filter=d.q2f[v.quality]}return 0===I.width||0===I.height?Promise.reject(new Error("Invalid output size: ".concat(I.width,"x").concat(I.height))):(v.unsharpRadius>2&&(v.unsharpRadius=2),v.canceled=!1,v.cancelToken&&(v.cancelToken=v.cancelToken.then(function(D){throw v.canceled=!0,D},function(D){throw v.canceled=!0,D})),v.__destTileBorder=Math.ceil(Math.max(3,2.5*v.unsharpRadius|0)),this.init().then(function(){if(v.canceled)return v.cancelToken;if(p.features.cib){if(d.q2f.indexOf(v.filter)>=0)return p.__resizeViaCreateImageBitmap(i,I,v);p.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!w){var D=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw D.code="ERR_GET_IMAGE_DATA",D}var R=u(v.width,v.height,v.toWidth,v.toHeight,p.options.tile,v.__destTileBorder);return p.__processStages(R,i,I,v)}))},P.prototype.resizeBuffer=function(i){var I=this,l=e({},_,i);if(Object.prototype.hasOwnProperty.call(l,"quality")){if(l.quality<0||l.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(l.quality));l.filter=d.q2f[l.quality]}return this.init().then(function(){return I.__mathlib.resizeAndUnsharp(l)})},P.prototype.toBlob=function(i,I,l){return I=I||"image/png",new Promise(function(p){if(i.toBlob)i.toBlob(function(O){return p(O)},I,l);else if(i.convertToBlob)p(i.convertToBlob({type:I,quality:l}));else{for(var v=atob(i.toDataURL(I,l).split(",")[1]),G=v.length,D=new Uint8Array(G),R=0;R<G;R++)D[R]=v.charCodeAt(R);p(new Blob([D],{type:I}))}})},P.prototype.debug=function(){},Q.exports=P},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")}}]);