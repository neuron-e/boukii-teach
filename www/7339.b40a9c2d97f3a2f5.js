"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7339],{7339:(D,u,l)=>{l.r(u),l.d(u,{NotificationsPageModule:()=>I});var d=l(177),b=l(9417),f=l(8974),g=l(3314),h=l(7586),t=l(6996),v=l(4387),x=l(7473),p=l(1547);function _(o,s){if(1&o){const a=t.RV6();t.j41(0,"button",15),t.bIt("click",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.clearDateFilter())}),t.EFF(1,"\u2715"),t.k0s()}}function m(o,s){1&o&&(t.j41(0,"div",16),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(1),t.JRh(t.bMT(2,1,"loading")))}function P(o,s){1&o&&(t.j41(0,"div",16),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&o&&(t.R7$(1),t.SpI(" ",t.bMT(2,1,"no_notifications")," "))}function M(o,s){if(1&o&&(t.j41(0,"div",27),t.EFF(1),t.k0s()),2&o){const a=t.XpG().$implicit,e=t.XpG();t.R7$(1),t.SpI(" ",e.formatDate(a.event_date)," ")}}const y=function(o){return{"notification-unread":o}},C=function(o){return{"is-unread":o}};function w(o,s){if(1&o){const a=t.RV6();t.j41(0,"div",17),t.bIt("click",function(){const i=t.eBV(a).$implicit,r=t.XpG();return t.Njj(r.openNotification(i))}),t.j41(1,"div",18)(2,"div",19),t.EFF(3),t.k0s(),t.j41(4,"div",20),t.EFF(5),t.nI1(6,"translate"),t.nI1(7,"translate"),t.k0s()(),t.j41(8,"div",21)(9,"div",22)(10,"div",23)(11,"div",24),t.EFF(12),t.k0s(),t.j41(13,"div",25)(14,"span"),t.EFF(15),t.k0s()()()()(),t.DNE(16,M,2,1,"div",26),t.k0s()}if(2&o){const a=s.$implicit,e=t.XpG();t.Y8G("ngClass",t.eq3(11,y,!a.read_at)),t.R7$(3),t.SpI(" ",e.formatDate(a.created_at)," "),t.R7$(1),t.Y8G("ngClass",t.eq3(13,C,!a.read_at)),t.R7$(1),t.SpI(" ",a.read_at?t.bMT(6,7,"read"):t.bMT(7,9,"unread")," "),t.R7$(7),t.SpI(" ",e.getDisplayTitle(a)," "),t.R7$(3),t.JRh(e.getDisplayBody(a)),t.R7$(1),t.Y8G("ngIf",a.event_date)}}const k=[{path:"",component:(()=>{var o;class s{constructor(e,n,i,r){this.router=e,this.teachService=n,this.notificationService=i,this.translate=r,this.notifications=[],this.filteredNotifications=[],this.loading=!1,this.showUnreadOnly=!1,this.selectedDate=""}ngOnInit(){this.loadNotifications()}ionViewWillEnter(){this.loadNotifications()}loadNotifications(){this.loading=!0;const e=this.getMonitorId(),n={perPage:50};e&&(n.monitor_id=e),this.teachService.getData("teach/notifications",null,n).subscribe({next:i=>{this.notifications=(null==i?void 0:i.data)||[],this.applyFilters(),0===this.notifications.length&&this.notificationService.setUnreadCount(0),this.loading=!1},error:()=>{this.loading=!1}})}applyFilters(){const e=this.selectedDate,n=this.showUnreadOnly;this.filteredNotifications=this.notifications.filter(i=>{return!(n&&i.read_at||e&&((null==i?void 0:i.event_date)||(null==i||null===(r=i.payload)||void 0===r?void 0:r.date))!==e);var r})}toggleUnreadOnly(){this.showUnreadOnly=!this.showUnreadOnly,this.applyFilters()}onDateChange(e){const n=e.target;this.selectedDate=(null==n?void 0:n.value)||"",this.applyFilters()}clearDateFilter(){this.selectedDate="",this.applyFilters()}markAllRead(){this.notificationService.markAllRead().subscribe({next:()=>{this.notifications=this.notifications.map(e=>({...e,read_at:(new Date).toISOString()})),this.applyFilters(),this.notificationService.refreshUnreadCount()}})}openNotification(e){var n;null!=e&&e.id&&!e.read_at&&this.notificationService.markRead(e.id).subscribe({next:()=>{e.read_at=(new Date).toISOString(),this.notificationService.refreshUnreadCount()}});const i=this.normalizeDateString((null==e?void 0:e.event_date)||(null==e||null===(n=e.payload)||void 0===n?void 0:n.date));if(i)return localStorage.setItem("calendarTargetDate",i),void this.router.navigate(["calendar"],{queryParams:{date:i}});this.router.navigate(["calendar"])}formatDate(e){return e?h(e).format("DD/MM/YYYY HH:mm"):""}getDisplayTitle(e){const n=null==e?void 0:e.type;if(!n)return(null==e?void 0:e.title)||"";const i=this.getTranslationParams(e);return this.translateInstant(`notification_types.${n}.title`,i)||(null==e?void 0:e.title)||""}getDisplayBody(e){const n=null==e?void 0:e.type;if(!n)return(null==e?void 0:e.body)||"";const i=this.getTranslationParams(e);return this.requiresWhen(n)&&!i.when||this.requiresBooking(n)&&!i.booking||this.requiresNwdType(n)&&!i.nwd_type?(null==e?void 0:e.body)||"":this.translateInstant(`notification_types.${n}.body`,i)||(null==e?void 0:e.body)||""}getTranslationParams(e){const n=(null==e?void 0:e.payload)||{},i=this.formatWhen(n),r=(null==n?void 0:n.booking_id)||(null==n?void 0:n.course_date_id)||"",c=this.resolveNwdTypeLabel(n);return{when:i,booking:r?String(r):"",nwd_type:c}}formatWhen(e){if(!e)return"";const n=this.normalizeDateString(null==e?void 0:e.date),i=n?h(n,"YYYY-MM-DD").format("DD/MM/YYYY"):"",r=(null==e?void 0:e.hour_start)||"",c=(null==e?void 0:e.hour_end)||"";return i&&r&&c?`${i} ${r}-${c}`:i||""}normalizeDateString(e){if(!e)return"";const n=String(e);return n.includes("T")||n.includes(" ")?n.slice(0,10):n}translateInstant(e,n){const i=this.translate.instant(e,n);return i===e?"":i}requiresWhen(e){return["booking_created","booking_updated","booking_cancelled","group_assigned","private_assigned","subgroup_changed"].includes(e)}requiresBooking(e){return["group_removed","private_removed"].includes(e)}requiresNwdType(e){return["nwd_created","nwd_updated","nwd_deleted"].includes(e)}resolveNwdTypeLabel(e){var n,i;const r=Number(null!==(n=null!==(i=null==e?void 0:e.nwd_subtype_id)&&void 0!==i?i:null==e?void 0:e.user_nwd_subtype_id)&&void 0!==n?n:null==e?void 0:e.nwd_type_id);let c="notification_nwd_types.unpaid";return 2===r?c="notification_nwd_types.paid":!Number.isNaN(r)&&1!==r&&(c="notification_nwd_types.absence"),this.translateInstant(c,{})||""}goTo(...e){this.router.navigate(e)}getMonitorId(){const e=localStorage.getItem("monitorId");if(!e)return null;const n=Number(e);return Number.isNaN(n)?null:n}}return(o=s).\u0275fac=function(e){return new(e||o)(t.rXU(g.Ix),t.rXU(v.R),t.rXU(x.J),t.rXU(p.c$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-notifications"]],decls:25,vars:16,consts:[[1,"content-wrapper","dark-background","status-bar-overlap-wrapper"],[1,"header-top","mb-12"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/icon-notification-blue.png"],[1,"notifications-actions"],[1,"filters-row"],["type","button",1,"btn-back-grey","montserrat","filter-button",3,"click"],[1,"date-filter"],["type","date",3,"value","change"],["class","btn-clear montserrat",3,"click",4,"ngIf"],["type","button",1,"btn-back-grey","montserrat","mark-read-button",3,"click"],[1,"list-box-selector-c"],["class","montserrat color-light",4,"ngIf"],["class","box-selector cursor-pointer pb-12",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"btn-clear","montserrat",3,"click"],[1,"montserrat","color-light"],[1,"box-selector","cursor-pointer","pb-12",3,"ngClass","click"],[1,"box-selector-top"],[1,"box-selector-date"],[1,"notification-status",3,"ngClass"],[1,"box-selector-middle"],[1,"box-selector-middle-interior"],[1,"box-selector-text"],[1,"montserrat","box-selector-title"],[1,"montserrat","color-light","box-selector-subtitle"],["class","montserrat color-light box-selector-date-small",4,"ngIf"],[1,"montserrat","color-light","box-selector-date-small"]],template:function(e,n){1&e&&(t.j41(0,"ion-content")(1,"div",0)(2,"div",1)(3,"img",2),t.bIt("click",function(){return n.goTo("home")}),t.k0s(),t.j41(4,"div",3),t.nrm(5,"img",4),t.j41(6,"div"),t.EFF(7),t.nI1(8,"translate"),t.k0s()()(),t.j41(9,"div",5)(10,"div",6)(11,"button",7),t.bIt("click",function(){return n.toggleUnreadOnly()}),t.EFF(12),t.nI1(13,"translate"),t.nI1(14,"translate"),t.k0s(),t.j41(15,"div",8)(16,"input",9),t.bIt("change",function(r){return n.onDateChange(r)}),t.k0s(),t.DNE(17,_,2,0,"button",10),t.k0s()(),t.j41(18,"button",11),t.bIt("click",function(){return n.markAllRead()}),t.EFF(19),t.nI1(20,"translate"),t.k0s()(),t.j41(21,"div",12),t.DNE(22,m,3,3,"div",13),t.DNE(23,P,3,3,"div",13),t.DNE(24,w,17,15,"div",14),t.k0s()()()),2&e&&(t.R7$(7),t.JRh(t.bMT(8,8,"notifications")),t.R7$(5),t.SpI(" ",n.showUnreadOnly?t.bMT(13,10,"all"):t.bMT(14,12,"unread")," "),t.R7$(4),t.Y8G("value",n.selectedDate),t.R7$(1),t.Y8G("ngIf",n.selectedDate),t.R7$(2),t.JRh(t.bMT(20,14,"mark_as_read")),t.R7$(3),t.Y8G("ngIf",n.loading),t.R7$(1),t.Y8G("ngIf",!n.loading&&0===n.filteredNotifications.length),t.R7$(1),t.Y8G("ngForOf",n.filteredNotifications))},dependencies:[d.YU,d.Sq,d.bT,f.W9,p.D9],styles:[".content-wrapper[_ngcontent-%COMP%]{width:100%;min-height:100%;padding:20px 16px}.content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.dark-background[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:var(--ion-back-color-dark)}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center;margin-bottom:24px}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:16px;font-weight:600}.flex-buttons[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;gap:4px}.flex-buttons-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:14px;width:100%;padding:6px 0;border-radius:4px}.notifications-actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin:12px 0 20px}.notification-unread[_ngcontent-%COMP%]   .box-selector-title[_ngcontent-%COMP%]{font-weight:700}.filters-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.filter-button[_ngcontent-%COMP%]{min-width:96px;height:32px;padding:0 14px;border-radius:16px;border:1px solid #3a424d;background:#2b303b;color:#fff;font-size:12px}.mark-read-button[_ngcontent-%COMP%]{align-self:flex-end;height:32px;padding:0 14px;border-radius:16px;border:1px solid #3a424d;background:#2b303b;color:#fff;font-size:12px}.date-filter[_ngcontent-%COMP%]{position:relative;flex:1;min-width:160px}.date-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:#1d232b;border:1px solid #3a424d;color:#fff;border-radius:16px;padding:6px 32px 6px 14px;font-size:12px;width:100%;height:32px}.date-filter[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::-webkit-calendar-picker-indicator{filter:invert(1);opacity:.8}.btn-clear[_ngcontent-%COMP%]{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:#b5bdc7;font-size:12px}.list-box-selector-c[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.box-selector[_ngcontent-%COMP%]{display:flex;white-space:normal;width:100%;padding:8px;flex-direction:column;gap:8px;align-items:flex-start;border-radius:8px;border-bottom:1px solid #444953}.box-selector-top[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.notification-status[_ngcontent-%COMP%]{font-size:11px;padding:3px 10px;border-radius:10px;background:#2b303b;color:#c8c8c8}.notification-status.is-unread[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff}.box-selector-middle[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;width:100%}.box-selector-middle-b[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.box-selector-date[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:500}.box-selector-price[_ngcontent-%COMP%]{font-size:13px}.box-selector-middle-interior[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.box-selector-image-wrapper[_ngcontent-%COMP%]{width:46px;min-width:46px;height:46px;border-radius:8px;position:relative}.box-selector-image[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%;border-radius:8px}.box-selector-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.box-selector-title[_ngcontent-%COMP%]{color:#fff;font-size:14px}.box-selector-title-level[_ngcontent-%COMP%]{font-size:12px;color:#faafaf}.box-selector-subtitle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.box-selector-subtitle[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px}.box-selector-date-small[_ngcontent-%COMP%]{font-size:11px;width:100%;text-align:right;margin-top:-12px}.box-selector-level[_ngcontent-%COMP%]{font-size:12px;color:#faafaf;background:#613136;padding:4px 6px;border-radius:20px}.box-selector-location[_ngcontent-%COMP%]{width:13px}.no-border[_ngcontent-%COMP%]{border:none!important}"]}),s})()}];let O=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[g.iI.forChild(k),g.iI]}),s})();var N=l(5553);let I=(()=>{var o;class s{}return(o=s).\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[d.MD,b.YN,f.bv,O,N.h,p.h]}),s})()}}]);