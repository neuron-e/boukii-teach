(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1211],{5961:(Y,L,T)=>{"use strict";T.d(L,{GW:()=>i,dk:()=>C,oK:()=>N});var N=function(F){return F.Prompt="PROMPT",F.Camera="CAMERA",F.Photos="PHOTOS",F}(N||{}),i=function(F){return F.Rear="REAR",F.Front="FRONT",F}(i||{}),C=function(F){return F.Uri="uri",F.Base64="base64",F.DataUrl="dataUrl",F}(C||{})},1211:(Y,L,T)=>{"use strict";T.d(L,{Y:()=>t});var N=T(5861),i=T(6689),C=T(2726),F=T(5961);const E=(0,C.fo)("Camera",{web:()=>T.e(6468).then(T.bind(T,6468)).then(u=>new u.CameraWeb)});var m=T(8963),o=T(6814);function A(u,c){if(1&u){const f=i.EpF();i.TgZ(0,"button",7),i.NdJ("click",function(){i.CHM(f),i.oxw();const r=i.MAs(15);return i.KtG(r.click())}),i._uU(1,"Enregistrer une vid\xe9o"),i.qZA()}}function s(u,c){if(1&u&&i._UZ(0,"img",18),2&u){const f=i.oxw(2);i.Q6J("src",f.filePreview,i.LSH)}}function l(u,c){if(1&u&&i._UZ(0,"video",19),2&u){const f=i.oxw(2);i.Q6J("src",f.filePreview,i.LSH)}}function e(u,c){if(1&u){const f=i.EpF();i.TgZ(0,"div",14),i.YNc(1,s,1,1,"img",15),i.YNc(2,l,1,1,"video",16),i.TgZ(3,"button",17),i.NdJ("click",function(){i.CHM(f);const r=i.oxw();return i.KtG(r.saveFile())}),i._uU(4,"Sauvegarder"),i.qZA()()}if(2&u){const f=i.oxw();i.xp6(1),i.Q6J("ngIf",!f.isVideo),i.xp6(1),i.Q6J("ngIf",f.isVideo)}}let t=(()=>{var u;class c{constructor(){this.title="T\xe9l\xe9verser un fichier",this.allowImage=!0,this.allowVideo=!0,this.isVideo=!1,this.close=new i.vpe,this.fileSelected=new i.vpe}onFileSelected(a){const r=a.target;if(r.files&&r.files.length>0){const h=r.files[0];this.isVideo=h.type.startsWith("video"),this.isVideo?this.previewVideo(h):this.resizeAndPreviewImage(h)}}onVideoSelected(a){const r=a.target;if(r.files&&r.files.length>0){const h=r.files[0];this.isVideo=!0,this.previewVideo(h)}}openCamera(){var a=this;return(0,N.Z)(function*(){try{const r=yield E.getPhoto({quality:90,allowEditing:!1,resultType:F.dk.Uri,source:F.oK.Camera});if(a.isVideo="video"===r.format,a.isVideo)a.filePreview=r.webPath,a.fileResult={base64:r.webPath,isVideo:!0};else{const h=yield fetch(r.webPath).then(d=>d.blob());a.resizeAndPreviewImage(h)}}catch(r){console.error("Error accessing camera or gallery",r)}})()}resizeAndPreviewImage(a){this.resizeImage(a,600).then(h=>{this.filePreview=h,this.fileResult={base64:h,isVideo:!1}}).catch(h=>{console.error("Error resizing image:",h)})}previewVideo(a){const r=new FileReader;r.onload=()=>{this.filePreview=r.result,this.fileResult={base64:r.result,isVideo:!0}},r.readAsDataURL(a)}saveFile(){this.fileResult&&(this.fileSelected.emit(this.fileResult),this.close.emit())}doCloseModal(){this.close.emit()}get acceptTypes(){let a="";return this.allowImage&&(a+="image/*"),this.allowVideo&&(a+=this.allowImage?",video/*":"video/*"),a}resizeImage(a,r){return new Promise((h,d)=>{const p="image/png"===a.type,M=["image/png","image/gif","image/avif","image/bmp","image/tiff","image/ico","image/heic"].includes(a.type)?"image/jpeg":a.type||"image/jpeg",k=new FileReader;k.onload=w=>{const Q=new Image;Q.src=w.target.result,Q.onload=()=>{let b=Q.width,B=Q.height;if(b>r||B>r)if(b>B){const S=r/b;b=r,B*=S}else{const S=r/B;B=r,b*=S}const D=document.createElement("canvas");if(D.width=b,D.height=B,p){const S=D.getContext("2d");S.fillStyle="white",S.fillRect(0,0,D.width,D.height)}const x=document.createElement("canvas");x.width=b,x.height=B,m().resize(Q,x).then(S=>(D.getContext("2d").drawImage(x,0,0,b,B),m().toBlob(D,M,.6))).then(S=>{const R=new FileReader;R.onloadend=()=>h(R.result),R.readAsDataURL(S)}).catch(d)}},k.readAsDataURL(a)})}}return(u=c).\u0275fac=function(a){return new(a||u)},u.\u0275cmp=i.Xpm({type:u,selectors:[["app-file-upload"]],inputs:{title:"title",allowImage:"allowImage",allowVideo:"allowVideo"},outputs:{close:"close",fileSelected:"fileSelected"},decls:18,vars:4,consts:[[1,"modal"],[1,"modal-content","content-background-image"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","modal-close",3,"click"],[1,"title-upload","mt-24","mb-24"],[1,"file-upload"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],[1,"content-button","btn-back-grey","montserrat",3,"click"],[1,"camera-upload","mt-12"],[1,"file-upload","mt-12"],["type","file","accept","video/*","capture","user",2,"display","none",3,"change"],["videoInput",""],["class","content-button btn-back-grey montserrat",3,"click",4,"ngIf"],["class","mt-24 mb-32",4,"ngIf"],[1,"mt-24","mb-32"],["class","preview",3,"src",4,"ngIf"],["class","preview","muted","","playsinline","",3,"src",4,"ngIf"],[1,"content-button","btn-back-primary","montserrat","mt-24",3,"click"],[1,"preview",3,"src"],["muted","","playsinline","",1,"preview",3,"src"]],template:function(a,r){if(1&a){const h=i.EpF();i.TgZ(0,"div",0)(1,"div",1)(2,"img",2),i.NdJ("click",function(){return r.doCloseModal()}),i.qZA(),i.TgZ(3,"div",3),i._uU(4),i.qZA(),i.TgZ(5,"div",4)(6,"input",5,6),i.NdJ("change",function(p){return r.onFileSelected(p)}),i.qZA(),i.TgZ(8,"button",7),i.NdJ("click",function(){i.CHM(h);const p=i.MAs(7);return i.KtG(p.click())}),i._uU(9,"Choisir le fichier"),i.qZA()(),i.TgZ(10,"div",8)(11,"button",7),i.NdJ("click",function(){return r.openCamera()}),i._uU(12,"Utiliser la cam\xe9ra"),i.qZA()(),i.TgZ(13,"div",9)(14,"input",10,11),i.NdJ("change",function(p){return r.onVideoSelected(p)}),i.qZA(),i.YNc(16,A,2,0,"button",12),i.qZA(),i.YNc(17,e,5,2,"div",13),i.qZA()()}2&a&&(i.xp6(4),i.Oqu(r.title),i.xp6(2),i.Q6J("accept",r.acceptTypes),i.xp6(10),i.Q6J("ngIf",r.allowVideo),i.xp6(1),i.Q6J("ngIf",r.filePreview))},dependencies:[o.O5],styles:[".modal[_ngcontent-%COMP%]{width:100%;height:100vh;min-height:100vh;max-height:100vh;z-index:999;background:rgba(0,0,0,.7);position:fixed;top:0;left:0}.modal-content[_ngcontent-%COMP%]{width:80%;max-width:300px;padding:20px 16px;position:relative;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:8px;text-align:center}.modal-close[_ngcontent-%COMP%]{width:28px;position:absolute;top:8px;right:8px}.title-upload[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px}"]}),c})()},8963:Y=>{Y.exports=function i(C,F,E){function m(s,l){if(!F[s]){if(!C[s]){if(o)return o(s,!0);var t=new Error("Cannot find module '"+s+"'");throw t.code="MODULE_NOT_FOUND",t}var u=F[s]={exports:{}};C[s][0].call(u.exports,function(c){return m(C[s][1][c]||c)},u,u.exports,i,C,F,E)}return F[s].exports}for(var o=void 0,A=0;A<E.length;A++)m(E[A]);return m}({1:[function(i,C,F){"use strict";var E=i("multimath"),m=i("./mm_unsharp_mask"),o=i("./mm_resize");function A(s){var l=s||[],e={js:l.indexOf("js")>=0,wasm:l.indexOf("wasm")>=0};E.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(m),this.use(o)}(A.prototype=Object.create(E.prototype)).constructor=A,A.prototype.resizeAndUnsharp=function(l,e){var t=this.resize(l,e);return l.unsharpAmount&&this.unsharp_mask(t,l.toWidth,l.toHeight,l.unsharpAmount,l.unsharpRadius,l.unsharpThreshold),t},C.exports=A},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(i,C,F){"use strict";function E(e){return e<0?0:e>255?255:e}function m(e){return e>=0?e:0}C.exports={convolveHor:function o(e,t,u,c,f,a){var r,h,d,p,y,M,k,w,Q,b,B,D=0,x=0;for(Q=0;Q<c;Q++){for(y=0,b=0;b<f;b++){for(M=a[y++],k=a[y++],w=D+4*M|0,r=h=d=p=0;k>0;k--)p=p+(B=a[y++])*e[w+3]|0,d=d+B*e[w+2]|0,h=h+B*e[w+1]|0,r=r+B*e[w]|0,w=w+4|0;t[x+3]=m(p>>7),t[x+2]=m(d>>7),t[x+1]=m(h>>7),t[x]=m(r>>7),x=x+4*c|0}x=4*(Q+1)|0,D=(Q+1)*u*4|0}},convolveVert:function A(e,t,u,c,f,a){var r,h,d,p,y,M,k,w,Q,b,B,D=0,x=0;for(Q=0;Q<c;Q++){for(y=0,b=0;b<f;b++){for(M=a[y++],k=a[y++],w=D+4*M|0,r=h=d=p=0;k>0;k--)p=p+(B=a[y++])*e[w+3]|0,d=d+B*e[w+2]|0,h=h+B*e[w+1]|0,r=r+B*e[w]|0,w=w+4|0;r>>=7,h>>=7,d>>=7,t[x+3]=E(8192+(p>>=7)>>14),t[x+2]=E(d+8192>>14),t[x+1]=E(h+8192>>14),t[x]=E(r+8192>>14),x=x+4*c|0}x=4*(Q+1)|0,D=(Q+1)*u*4|0}},convolveHorWithPre:function s(e,t,u,c,f,a){var r,h,d,p,y,M,k,w,Q,b,B,D,x=0,S=0;for(b=0;b<c;b++){for(M=0,B=0;B<f;B++){for(k=a[M++],w=a[M++],Q=x+4*k|0,r=h=d=p=0;w>0;w--)p=p+(D=a[M++])*(y=e[Q+3])|0,d=d+D*e[Q+2]*y|0,h=h+D*e[Q+1]*y|0,r=r+D*e[Q]*y|0,Q=Q+4|0;d=d/255|0,h=h/255|0,r=r/255|0,t[S+3]=m(p>>7),t[S+2]=m(d>>7),t[S+1]=m(h>>7),t[S]=m(r>>7),S=S+4*c|0}S=4*(b+1)|0,x=(b+1)*u*4|0}},convolveVertWithPre:function l(e,t,u,c,f,a){var r,h,d,p,y,M,k,w,Q,b,B,D=0,x=0;for(Q=0;Q<c;Q++){for(y=0,b=0;b<f;b++){for(M=a[y++],k=a[y++],w=D+4*M|0,r=h=d=p=0;k>0;k--)p=p+(B=a[y++])*e[w+3]|0,d=d+B*e[w+2]|0,h=h+B*e[w+1]|0,r=r+B*e[w]|0,w=w+4|0;r>>=7,h>>=7,d>>=7,(p=E(8192+(p>>=7)>>14))>0&&(r=255*r/p|0,h=255*h/p|0,d=255*d/p|0),t[x+3]=p,t[x+2]=E(d+8192>>14),t[x+1]=E(h+8192>>14),t[x]=E(r+8192>>14),x=x+4*c|0}x=4*(Q+1)|0,D=(Q+1)*u*4|0}}}},{}],3:[function(i,C,F){"use strict";C.exports="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"},{}],4:[function(i,C,F){"use strict";C.exports={name:"resize",fn:i("./resize"),wasm_fn:i("./resize_wasm"),wasm_src:i("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(i,C,F){"use strict";var E=i("./resize_filter_gen"),m=i("./convolve"),o=m.convolveHor,A=m.convolveVert,s=m.convolveHorWithPre,l=m.convolveVertWithPre;C.exports=function(c){var f=c.src,a=c.width,r=c.height,h=c.toWidth,d=c.toHeight,p=c.scaleX||c.toWidth/c.width,y=c.scaleY||c.toHeight/c.height,M=c.offsetX||0,k=c.offsetY||0,w=c.dest||new Uint8Array(h*d*4),Q=typeof c.filter>"u"?"mks2013":c.filter,b=E(Q,a,h,p,M),B=E(Q,r,d,y,k),D=new Uint16Array(h*r*4);return function e(u,c,f){for(var a=3,r=c*f*4|0;a<r;){if(255!==u[a])return!0;a=a+4|0}return!1}(f,a,r)?(s(f,D,a,r,h,b),l(D,w,r,h,d,B)):(o(f,D,a,r,h,b),A(D,w,r,h,d,B),function t(u,c,f){for(var a=3,r=c*f*4|0;a<r;)u[a]=255,a=a+4|0}(w,h,d)),w}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(i,C,F){"use strict";var E=i("./resize_filter_info");function o(A){return Math.round(16383*A)}C.exports=function(s,l,e,t,u){var h,d,p,y,M,k,w,Q,b,B,D,x,S,R,n,g,c=E.filter[s].fn,f=1/t,a=Math.min(1,t),r=E.filter[s].win/a,_=Math.floor(2*(r+1)),v=new Int16Array((_+2)*e),P=0,U=!v.subarray||!v.set;for(h=0;h<e;h++){for(d=(h+.5)*f+u,p=Math.max(0,Math.floor(d-r)),M=(y=Math.min(l-1,Math.ceil(d+r)))-p+1,k=new Float32Array(M),w=new Int16Array(M),Q=0,b=p,B=0;b<=y;b++,B++)Q+=D=c((b+.5-d)*a),k[B]=D;for(x=0,B=0;B<k.length;B++)x+=S=k[B]/Q,w[B]=o(S);for(w[e>>1]+=o(1-x),R=0;R<w.length&&0===w[R];)R++;if(R<w.length){for(n=w.length-1;n>0&&0===w[n];)n--;if(g=n-R+1,v[P++]=p+R,v[P++]=g,U)for(B=R;B<=n;B++)v[P++]=w[B];else v.set(w.subarray(R,n+1),P),P+=g}else v[P++]=0,v[P++]=0}return v}},{"./resize_filter_info":7}],7:[function(i,C,F){"use strict";C.exports={filter:{box:{win:.5,fn:function(o){return o<0&&(o=-o),o<.5?1:0}},hamming:{win:1,fn:function(o){if(o<0&&(o=-o),o>=1)return 0;if(o<1.1920929e-7)return 1;var A=o*Math.PI;return Math.sin(A)/A*(.54+.46*Math.cos(A/1))}},lanczos2:{win:2,fn:function(o){if(o<0&&(o=-o),o>=2)return 0;if(o<1.1920929e-7)return 1;var A=o*Math.PI;return Math.sin(A)/A*Math.sin(A/2)/(A/2)}},lanczos3:{win:3,fn:function(o){if(o<0&&(o=-o),o>=3)return 0;if(o<1.1920929e-7)return 1;var A=o*Math.PI;return Math.sin(A)/A*Math.sin(A/3)/(A/3)}},mks2013:{win:2.5,fn:function(o){return o<0&&(o=-o),o>=2.5?0:o>=1.5?-.125*(o-2.5)*(o-2.5):o>=.5?.25*(4*o*o-11*o+7):1.0625-1.75*o*o}}},f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(i,C,F){"use strict";var E=i("./resize_filter_gen");var s=!0;try{s=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch{}function l(e,t,u){if(s)t.set(function A(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),u);else for(var c=u,f=0;f<e.length;f++){var a=e[f];t[c++]=255&a,t[c++]=a>>8&255}}C.exports=function(t){var u=t.src,c=t.width,f=t.height,a=t.toWidth,r=t.toHeight,h=t.scaleX||t.toWidth/t.width,d=t.scaleY||t.toHeight/t.height,p=t.offsetX||0,y=t.offsetY||0,M=t.dest||new Uint8Array(a*r*4),k=typeof t.filter>"u"?"mks2013":t.filter,w=E(k,c,a,h,p),Q=E(k,f,r,d,y),B=Math.max(u.byteLength,M.byteLength),D=this.__align(0+B),S=this.__align(D+f*a*4*2),R=this.__align(S+w.byteLength),I=this.__instance("resize",R+Q.byteLength),g=new Uint8Array(this.__memory.buffer),_=new Uint32Array(this.__memory.buffer),v=new Uint32Array(u.buffer);_.set(v),l(w,g,S),l(Q,g,R);var P=I.exports.convolveHV||I.exports._convolveHV;return function m(e,t,u){for(var c=3,f=t*u*4|0;c<f;){if(255!==e[c])return!0;c=c+4|0}return!1}(u,c,f)?P(S,R,D,c,f,a,r,1):(P(S,R,D,c,f,a,r,0),function o(e,t,u){for(var c=3,f=t*u*4|0;c<f;)e[c]=255,c=c+4|0}(M,a,r)),new Uint32Array(M.buffer).set(new Uint32Array(this.__memory.buffer,0,r*a)),M}},{"./resize_filter_gen":6}],9:[function(i,C,F){"use strict";C.exports={name:"unsharp_mask",fn:i("./unsharp_mask"),wasm_fn:i("./unsharp_mask_wasm"),wasm_src:i("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(i,C,F){"use strict";var E=i("glur/mono16");C.exports=function(A,s,l,e,t,u){var c,f,a,r,h;if(!(0===e||t<.5)){t>2&&(t=2);var d=function m(o,A,s){for(var t,u,c,l=A*s,e=new Uint16Array(l),a=0;a<l;a++)c=o[4*a+2],e[a]=((t=o[4*a])>=(u=o[4*a+1])&&t>=c?t:u>=c&&u>=t?u:c)<<8;return e}(A,s,l),p=new Uint16Array(d);E(p,s,l,t);for(var y=e/100*4096+.5|0,M=u<<8,k=s*l,w=0;w<k;w++)r=(c=d[w])-p[w],Math.abs(r)>=M&&(A[h=4*w]=A[h]*(a=((f=(f=(f=c+(y*r+2048>>12))>65280?65280:f)<0?0:f)<<12)/(c=0!==c?c:1)|0)+2048>>12,A[h+1]=A[h+1]*a+2048>>12,A[h+2]=A[h+2]*a+2048>>12)}}},{"glur/mono16":18}],11:[function(i,C,F){"use strict";C.exports=function(m,o,A,s,l,e){if(!(0===s||l<.5)){l>2&&(l=2);var t=o*A,u=4*t,c=2*t,f=2*t,a=4*Math.max(o,A),d=u,p=d+c,y=p+f,M=y+f,k=M+a,w=this.__instance("unsharp_mask",u+c+2*f+a+32,{exp:Math.exp}),Q=new Uint32Array(m.buffer);new Uint32Array(this.__memory.buffer).set(Q);var B=w.exports.hsv_v16||w.exports._hsv_v16;B(0,d,o,A),(B=w.exports.blurMono16||w.exports._blurMono16)(d,p,y,M,k,o,A,l),(B=w.exports.unsharp||w.exports._unsharp)(0,0,d,p,o,A,s,e),Q.set(new Uint32Array(this.__memory.buffer,0,t))}}},{}],12:[function(i,C,F){"use strict";C.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAE0B2AAAGAEf39/fwBgBn9/f39/fwBgCH9/f39/f39/AGAIf39/f39/f30AYAJ9fwBgAXwBfAIZAgNlbnYDZXhwAAYDZW52Bm1lbW9yeQIAAAMHBgAFAgQBAwYGAX8AQQALB4oBCBFfX3dhc21fY2FsbF9jdG9ycwABFl9fYnVpbGRfZ2F1c3NpYW5fY29lZnMAAg5fX2dhdXNzMTZfbGluZQADCmJsdXJNb25vMTYABAdoc3ZfdjE2AAUHdW5zaGFycAAGDF9fZHNvX2hhbmRsZQMAGF9fd2FzbV9hcHBseV9kYXRhX3JlbG9jcwABCsUMBgMAAQvWAQEHfCABRNuGukOCGvs/IAC7oyICRAAAAAAAAADAohAAIgW2jDgCFCABIAKaEAAiAyADoCIGtjgCECABRAAAAAAAAPA/IAOhIgQgBKIgAyACIAKgokQAAAAAAADwP6AgBaGjIgS2OAIAIAEgBSAEmqIiB7Y4AgwgASADIAJEAAAAAAAA8D+gIASioiIItjgCCCABIAMgAkQAAAAAAADwv6AgBKKiIgK2OAIEIAEgByAIoCAFRAAAAAAAAPA/IAahoCIDo7Y4AhwgASAEIAKgIAOjtjgCGAuGBQMGfwl8An0gAyoCDCEVIAMqAgghFiADKgIUuyERIAMqAhC7IRACQCAEQQFrIghBAEgiCQRAIAIhByAAIQYMAQsgAiAALwEAuCIPIAMqAhi7oiIMIBGiIg0gDCAQoiAPIAMqAgS7IhOiIhQgAyoCALsiEiAPoqCgoCIOtjgCACACQQRqIQcgAEECaiEGIAhFDQAgCEEBIAhBAUgbIgpBf3MhCwJ/IAQgCmtBAXFFBEAgDiENIAgMAQsgAiANIA4gEKIgFCASIAAvAQK4Ig+ioKCgIg22OAIEIAJBCGohByAAQQRqIQYgDiEMIARBAmsLIQIgC0EAIARrRg0AA0AgByAMIBGiIA0gEKIgDyAToiASIAYvAQC4Ig6ioKCgIgy2OAIAIAcgDSARoiAMIBCiIA4gE6IgEiAGLwECuCIPoqCgoCINtjgCBCAHQQhqIQcgBkEEaiEGIAJBAkohACACQQJrIQIgAA0ACwsCQCAJDQAgASAFIAhsQQF0aiIAAn8gBkECay8BACICuCINIBW7IhKiIA0gFrsiE6KgIA0gAyoCHLuiIgwgEKKgIAwgEaKgIg8gB0EEayIHKgIAu6AiDkQAAAAAAADwQWMgDkQAAAAAAAAAAGZxBEAgDqsMAQtBAAs7AQAgCEUNACAGQQRrIQZBACAFa0EBdCEBA0ACfyANIBKiIAJB//8DcbgiDSAToqAgDyIOIBCioCAMIBGioCIPIAdBBGsiByoCALugIgxEAAAAAAAA8EFjIAxEAAAAAAAAAABmcQRAIAyrDAELQQALIQMgBi8BACECIAAgAWoiACADOwEAIAZBAmshBiAIQQFKIQMgDiEMIAhBAWshCCADDQALCwvRAgIBfwd8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIglEAAAAAAAAAMCiEAAiDLaMOAIUIAQgCZoQACIKIAqgIg22OAIQIAREAAAAAAAA8D8gCqEiCyALoiAKIAkgCaCiRAAAAAAAAPA/oCAMoaMiC7Y4AgAgBCAMIAuaoiIOtjgCDCAEIAogCUQAAAAAAADwP6AgC6KiIg+2OAIIIAQgCiAJRAAAAAAAAPC/oCALoqIiCbY4AgQgBCAOIA+gIAxEAAAAAAAA8D8gDaGgIgqjtjgCHCAEIAsgCaAgCqO2OAIYIAYEQANAIAAgBSAIbEEBdGogAiAIQQF0aiADIAQgBSAGEAMgCEEBaiIIIAZHDQALCyAFRQ0AQQAhCANAIAIgBiAIbEEBdGogASAIQQF0aiADIAQgBiAFEAMgCEEBaiIIIAVHDQALCwtxAQN/IAIgA2wiBQRAA0AgASAAKAIAIgRBEHZB/wFxIgIgAiAEQQh2Qf8BcSIDIAMgBEH/AXEiBEkbIAIgA0sbIgYgBiAEIAIgBEsbIAMgBEsbQQh0OwEAIAFBAmohASAAQQRqIQAgBUEBayIFDQALCwuZAgIDfwF8IAQgBWwhBAJ/IAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6AiC5lEAAAAAAAA4EFjBEAgC6oMAQtBgICAgHgLIQUgBARAIAdBCHQhCUEAIQYDQCAJIAIgBkEBdCIHai8BACIBIAMgB2ovAQBrIgcgB0EfdSIIaiAIc00EQCAAIAZBAnQiCGoiCiAFIAdsQYAQakEMdSABaiIHQYD+AyAHQYD+A0gbIgdBACAHQQBKG0EMdCABQQEgARtuIgEgCi0AAGxBgBBqQQx2OgAAIAAgCEEBcmoiByABIActAABsQYAQakEMdjoAACAAIAhBAnJqIgcgASAHLQAAbEGAEGpBDHY6AAALIAZBAWoiBiAERw0ACwsL"},{}],13:[function(i,C,F){"use strict";function m(o,A){this.create=o,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=A||2e3}m.prototype.acquire=function(){var A,o=this;return 0!==this.available.length?A=this.available.pop():((A=this.create()).id=this.lastId++,A.release=function(){return o.release(A)}),this.acquired[A.id]=A,A},m.prototype.release=function(o){var A=this;delete this.acquired[o.id],o.lastUsed=Date.now(),this.available.push(o),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return A.gc()},100))},m.prototype.gc=function(){var o=this,A=Date.now();this.available=this.available.filter(function(s){return!(A-s.lastUsed>o.idle&&(s.destroy(),1))}),this.timeoutId=0!==this.available.length?setTimeout(function(){return o.gc()},100):0},C.exports=m},{}],14:[function(i,C,F){"use strict";C.exports=function(o,A,s,l,e,t){var f=(2*t+2+1)/e;if(f>.5)return[[s,l]];var a=Math.ceil(Math.log(Math.min(s/o,l/A))/Math.log(f));if(a<=1)return[[s,l]];for(var r=[],h=0;h<a;h++){var d=Math.round(Math.pow(Math.pow(o,a-h-1)*Math.pow(s,h+1),1/a)),p=Math.round(Math.pow(Math.pow(A,a-h-1)*Math.pow(l,h+1),1/a));r.push([d,p])}return r}},{}],15:[function(i,C,F){"use strict";var E=1e-5;function m(A){var s=Math.round(A);return Math.abs(A-s)<E?s:Math.floor(A)}function o(A){var s=Math.round(A);return Math.abs(A-s)<E?s:Math.ceil(A)}C.exports=function(s){var l=s.toWidth/s.width,e=s.toHeight/s.height,t=m(s.srcTileSize*l)-2*s.destTileBorder,u=m(s.srcTileSize*e)-2*s.destTileBorder;if(t<1||u<1)throw new Error("Internal error in pica: target tile width/height is too small.");var c,f,a,r,h,d,y,p=[];for(r=0;r<s.toHeight;r+=u)for(a=0;a<s.toWidth;a+=t)(c=a-s.destTileBorder)<0&&(c=0),c+(h=a+t+s.destTileBorder-c)>=s.toWidth&&(h=s.toWidth-c),(f=r-s.destTileBorder)<0&&(f=0),f+(d=r+u+s.destTileBorder-f)>=s.toHeight&&(d=s.toHeight-f),y={toX:c,toY:f,toWidth:h,toHeight:d,toInnerX:a,toInnerY:r,toInnerWidth:t,toInnerHeight:u,offsetX:c/l-m(c/l),offsetY:f/e-m(f/e),scaleX:l,scaleY:e,x:m(c/l),y:m(f/e),width:o(h/l),height:o(d/e)},p.push(y);return p}},{}],16:[function(i,C,F){"use strict";function E(m){return Object.prototype.toString.call(m)}C.exports.isCanvas=function(o){var A=E(o);return"[object HTMLCanvasElement]"===A||"[object OffscreenCanvas]"===A||"[object Canvas]"===A},C.exports.isImage=function(o){return"[object HTMLImageElement]"===E(o)},C.exports.isImageBitmap=function(o){return"[object ImageBitmap]"===E(o)},C.exports.limiter=function(o){var A=0,s=[];function l(){A<o&&s.length&&(A++,s.shift()())}return function(t){return new Promise(function(u,c){s.push(function(){t().then(function(f){u(f),A--,l()},function(f){c(f),A--,l()})}),l()})}},C.exports.cib_quality_name=function(o){switch(o){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},C.exports.cib_support=function(o){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var A=o(100,100);return createImageBitmap(A,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(s){var l=10===s.width;return s.close(),A=null,l})}).catch(function(){return!1})},C.exports.worker_offscreen_canvas_support=function(){return new Promise(function(o,A){if(typeof OffscreenCanvas>"u")o(!1);else{var l=btoa("(".concat(function s(t){typeof createImageBitmap>"u"?t.postMessage(!1):Promise.resolve().then(function(){var u=new OffscreenCanvas(10,10);return u.getContext("2d").rect(0,0,1,1),createImageBitmap(u,0,0,1,1)}).then(function(){return t.postMessage(!0)},function(){return t.postMessage(!1)})}.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(l));e.onmessage=function(t){return o(t.data)},e.onerror=A}}).then(function(o){return o},function(){return!1})},C.exports.can_use_canvas=function(o){var A=!1;try{var l=o(2,1).getContext("2d"),e=l.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,l.putImageData(e,0,0),e=null,12===(e=l.getImageData(0,0,2,1)).data[0]&&23===e.data[1]&&34===e.data[2]&&255===e.data[3]&&45===e.data[4]&&56===e.data[5]&&67===e.data[6]&&255===e.data[7]&&(A=!0)}catch{}return A},C.exports.cib_can_use_region=function(){return new Promise(function(o){if(typeof Image>"u"||typeof createImageBitmap>"u")o(!1);else{var A=new Image;A.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",A.onload=function(){createImageBitmap(A,0,0,A.width,A.height).then(function(s){o(s.width===A.width&&s.height===A.height)},function(){return o(!1)})},A.onerror=function(){return o(!1)}}})}},{}],17:[function(i,C,F){"use strict";C.exports=function(){var m,E=i("./mathlib");onmessage=function(A){var s=A.data.opts;if(!s.src&&s.srcBitmap){var e=new OffscreenCanvas(s.width,s.height),t=e.getContext("2d");t.drawImage(s.srcBitmap,0,0),s.src=t.getImageData(0,0,s.width,s.height).data,e.width=e.height=0,e=null,s.srcBitmap.close(),s.srcBitmap=null}m||(m=new E(A.data.features));var u=m.resizeAndUnsharp(s);postMessage({data:u},[u.buffer])}}},{"./mathlib":1}],18:[function(i,C,F){var E,m,o,A,s,l;function c(a,r,h,d,p,y){var M,k,w,Q,b,B,D,x,S,R,n,I,g,_;for(S=0;S<y;S++){for(D=S,x=0,Q=b=(M=a[B=S*p])*d[6],n=d[0],I=d[1],g=d[4],_=d[5],R=0;R<p;R++)w=(k=a[B])*n+M*I+Q*g+b*_,b=Q,M=k,h[x]=Q=w,x++,B++;for(x--,D+=y*(p-1),Q=b=(M=a[--B])*d[7],k=M,n=d[2],I=d[3],R=p-1;R>=0;R--)w=k*n+M*I+Q*g+b*_,b=Q,M=k,k=a[B],r[D]=h[x]+(Q=w),B--,x--,D-=y}}C.exports=function f(a,r,h,d){if(d){var p=new Uint16Array(a.length),y=new Float32Array(Math.max(r,h)),M=function u(a){a<.5&&(a=.5);var r=Math.exp(.527076)/a,h=Math.exp(-r),d=Math.exp(-2*r),p=(1-h)*(1-h)/(1+2*r*h-d);return E=p,m=p*(r-1)*h,o=p*(r+1)*h,A=-p*d,s=2*h,l=-d,new Float32Array([E,m,o,A,s,l,(E+m)/(1-s-l),(o+A)/(1-s-l)])}(d);c(a,p,y,M,r,h),c(p,a,y,M,h,r)}}},{}],19:[function(i,C,F){"use strict";var E=i("object-assign"),m=i("./lib/base64decode"),o=i("./lib/wa_detect"),A={js:!0,wasm:!0};function s(l){if(!(this instanceof s))return new s(l);var e=E({},A,l||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}s.prototype.has_wasm=o,s.prototype.use=function(l){return this.__modules[l.name]=l,this[l.name]=this.options.wasm&&this.has_wasm()&&l.wasm_fn?l.wasm_fn:l.fn,this},s.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var l=this;return this.__init_promise=Promise.all(Object.keys(l.__modules).map(function(e){var t=l.__modules[e];return l.options.wasm&&l.has_wasm()&&t.wasm_fn&&!l.__wasm[e]?WebAssembly.compile(l.__base64decode(t.wasm_src)).then(function(u){l.__wasm[e]=u}):null})).then(function(){return l}),this.__init_promise},s.prototype.__base64decode=m,s.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},s.prototype.__instance=function(e,t,u){if(t&&this.__reallocate(t),this.__wasm[e]||(this.__wasm[e]=new WebAssembly.Module(this.__base64decode(this.__modules[e].wasm_src))),!this.__cache[e]){var f={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:E(f,u||{})})}return this.__cache[e]},s.prototype.__align=function(e,t){var u=e%(t=t||8);return e+(u?t-u:0)},C.exports=s},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(i,C,F){"use strict";C.exports=function(o){for(var A=o.replace(/[\r\n=]/g,""),s=A.length,l=new Uint8Array(3*s>>2),e=0,t=0,u=0;u<s;u++)u%4==0&&u&&(l[t++]=e>>16&255,l[t++]=e>>8&255,l[t++]=255&e),e=e<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(A.charAt(u));var c=s%4*6;return 0===c?(l[t++]=e>>16&255,l[t++]=e>>8&255,l[t++]=255&e):18===c?(l[t++]=e>>10&255,l[t++]=e>>2&255):12===c&&(l[t++]=e>>4&255),l}},{}],21:[function(i,C,F){"use strict";var E;C.exports=function(){if(typeof E<"u"||(E=!1,typeof WebAssembly>"u"))return E;try{var o=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),A=new WebAssembly.Module(o);return 0!==new WebAssembly.Instance(A,{}).exports.test(4)&&(E=!0),E}catch{}return E}},{}],22:[function(i,C,F){"use strict";var E=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;C.exports=function s(){try{if(!Object.assign)return!1;var l=new String("abc");if(l[5]="de","5"===Object.getOwnPropertyNames(l)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(f){return e[f]}).join(""))return!1;var c={};return"abcdefghijklmnopqrst".split("").forEach(function(f){c[f]=f}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},c)).join("")}catch{return!1}}()?Object.assign:function(l,e){for(var t,c,u=function A(l){if(null==l)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(l)}(l),f=1;f<arguments.length;f++){for(var a in t=Object(arguments[f]))m.call(t,a)&&(u[a]=t[a]);if(E){c=E(t);for(var r=0;r<c.length;r++)o.call(t,c[r])&&(u[c[r]]=t[c[r]])}}return u}},{}],23:[function(i,C,F){var E=arguments[3],m=arguments[4],o=arguments[5],A=JSON.stringify;C.exports=function(s,l){for(var e,t=Object.keys(o),u=0,c=t.length;u<c;u++){var a=o[f=t[u]].exports;if(a===s||a&&a.default===s){e=f;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var r={};for(u=0,c=t.length;u<c;u++){var f;r[f=t[u]]=f}m[e]=["function(require,module,exports){"+s+"(self); }",r]}var h=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[e]=e,m[h]=["function(require,module,exports){var f = require("+A(e)+");(f.default ? f.default : f)(self);}",d];var p={};!function y(B){for(var D in p[B]=!0,m[B][1]){var x=m[B][1][D];p[x]||y(x)}}(h);var M="("+E+")({"+Object.keys(p).map(function(B){return A(B)+":["+m[B][0]+","+A(m[B][1])+"]"}).join(",")+"},{},["+A(h)+"])",k=window.URL||window.webkitURL||window.mozURL||window.msURL,w=new Blob([M],{type:"text/javascript"});if(l&&l.bare)return w;var Q=k.createObjectURL(w),b=new Worker(Q);return b.objectURL=Q,b}},{}],"/index.js":[function(i,C,F){"use strict";function E(n,I){return function l(n){if(Array.isArray(n))return n}(n)||function s(n,I){var g=null==n?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(null!=g){var U,G,_=[],v=!0,P=!1;try{for(g=g.call(n);!(v=(U=g.next()).done)&&(_.push(U.value),!I||_.length!==I);v=!0);}catch(O){P=!0,G=O}finally{try{!v&&null!=g.return&&g.return()}finally{if(P)throw G}}return _}}(n,I)||function o(n,I){if(n){if("string"==typeof n)return A(n,I);var g=Object.prototype.toString.call(n).slice(8,-1);if("Object"===g&&n.constructor&&(g=n.constructor.name),"Map"===g||"Set"===g)return Array.from(n);if("Arguments"===g||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return A(n,I)}}(n,I)||function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(n,I){(null==I||I>n.length)&&(I=n.length);for(var g=0,_=new Array(I);g<I;g++)_[g]=n[g];return _}var e=i("object-assign"),t=i("webworkify"),u=i("./lib/mathlib"),c=i("./lib/pool"),f=i("./lib/utils"),a=i("./lib/worker"),r=i("./lib/stepper"),h=i("./lib/tiler"),d=i("./lib/mm_resize/resize_filter_info"),p={},y=!1;try{typeof navigator<"u"&&navigator.userAgent&&(y=navigator.userAgent.indexOf("Safari")>=0)}catch{}var M=1;typeof navigator<"u"&&(M=Math.min(navigator.hardwareConcurrency||1,4));var k={tile:1024,concurrency:M,features:["js","wasm","ww"],idle:2e3,createCanvas:function(I,g){var _=document.createElement("canvas");return _.width=I,_.height=g,_}},w={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},Q=!1,b=!1,B=!1,D=!1,x=!1;function S(){return{value:t(a),destroy:function(){if(this.value.terminate(),typeof window<"u"){var I=window.URL||window.webkitURL||window.mozURL||window.msURL;I&&I.revokeObjectURL&&this.value.objectURL&&I.revokeObjectURL(this.value.objectURL)}}}}function R(n){if(!(this instanceof R))return new R(n);this.options=e({},k,n||{});var I="lk_".concat(this.options.concurrency);this.__limit=p[I]||f.limiter(this.options.concurrency),p[I]||(p[I]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}R.prototype.init=function(){var n=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),Q=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?b=!0:this.debug("ImageBitmap does not support .close(), disabled"));var I=this.options.features.slice();if(I.indexOf("all")>=0&&(I=["cib","wasm","js","ww"]),this.__requested_features=I,this.__mathlib=new u(I),I.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{i("webworkify")(function(){}).terminate(),this.features.ww=!0;var _="wp_".concat(JSON.stringify(this.options));p[_]?this.__workersPool=p[_]:(this.__workersPool=new c(S,this.options.idle),p[_]=this.__workersPool)}catch{}var P,U,v=this.__mathlib.init().then(function(O){e(n.features,O.features)});P=b?f.cib_support(this.options.createCanvas).then(function(O){n.features.cib&&I.indexOf("cib")<0?n.debug("createImageBitmap() resize supported, but disabled by config"):I.indexOf("cib")>=0&&(n.features.cib=O)}):Promise.resolve(!1),B=f.can_use_canvas(this.options.createCanvas),U=(U=b&&Q&&-1!==I.indexOf("ww")?f.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(O){D=O});var G=f.cib_can_use_region().then(function(O){x=O});return this.__initPromise=Promise.all([v,P,U,G]).then(function(){return n}),this.__initPromise},R.prototype.__invokeResize=function(n,I){var g=this;return I.__mathCache=I.__mathCache||{},Promise.resolve().then(function(){return g.features.ww?new Promise(function(_,v){var P=g.__workersPool.acquire();I.cancelToken&&I.cancelToken.catch(function(G){return v(G)}),P.value.onmessage=function(G){P.release(),G.data.err?v(G.data.err):_(G.data)};var U=[];n.src&&U.push(n.src.buffer),n.srcBitmap&&U.push(n.srcBitmap),P.value.postMessage({opts:n,features:g.__requested_features,preload:{wasm_nodule:g.__mathlib.__}},U)}):{data:g.__mathlib.resizeAndUnsharp(n,I.__mathCache)}})},R.prototype.__extractTileData=function(n,I,g,_,v){if(this.features.ww&&D&&(f.isCanvas(I)||x))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(_.srcImageBitmap||I,n.x,n.y,n.width,n.height).then(function(G){return v.srcBitmap=G,v});if(f.isCanvas(I))return _.srcCtx||(_.srcCtx=I.getContext("2d")),this.debug("Get tile pixel data"),v.src=_.srcCtx.getImageData(n.x,n.y,n.width,n.height).data,v;this.debug("Draw tile imageBitmap/image to temporary canvas");var P=this.options.createCanvas(n.width,n.height),U=P.getContext("2d");return U.globalCompositeOperation="copy",U.drawImage(_.srcImageBitmap||I,n.x,n.y,n.width,n.height,0,0,n.width,n.height),this.debug("Get tile pixel data"),v.src=U.getImageData(0,0,n.width,n.height).data,P.width=P.height=0,v},R.prototype.__landTileData=function(n,I,g){var _;if(this.debug("Convert raw rgba tile result to ImageData"),I.bitmap)return g.toCtx.drawImage(I.bitmap,n.toX,n.toY),null;if(Q)_=new ImageData(new Uint8ClampedArray(I.data),n.toWidth,n.toHeight);else if((_=g.toCtx.createImageData(n.toWidth,n.toHeight)).data.set)_.data.set(I.data);else for(var v=_.data.length-1;v>=0;v--)_.data[v]=I.data[v];return this.debug("Draw tile"),y?g.toCtx.putImageData(_,n.toX,n.toY,n.toInnerX-n.toX,n.toInnerY-n.toY,n.toInnerWidth+1e-5,n.toInnerHeight+1e-5):g.toCtx.putImageData(_,n.toX,n.toY,n.toInnerX-n.toX,n.toInnerY-n.toY,n.toInnerWidth,n.toInnerHeight),null},R.prototype.__tileAndResize=function(n,I,g){var _=this,v={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(function(){if(v.toCtx=I.getContext("2d"),f.isCanvas(n))return null;if(f.isImageBitmap(n))return v.srcImageBitmap=n,v.isImageBitmapReused=!0,null;if(f.isImage(n))return b?(_.debug("Decode image via createImageBitmap"),createImageBitmap(n).then(function(U){v.srcImageBitmap=U}).catch(function(U){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(g.canceled)return g.cancelToken;_.debug("Calculate tiles");var G=h({width:g.width,height:g.height,srcTileSize:_.options.tile,toWidth:g.toWidth,toHeight:g.toHeight,destTileBorder:g.__destTileBorder}).map(function(H){return function(G){return _.__limit(function(){if(g.canceled)return g.cancelToken;var O={width:G.width,height:G.height,toWidth:G.toWidth,toHeight:G.toHeight,scaleX:G.scaleX,scaleY:G.scaleY,offsetX:G.offsetX,offsetY:G.offsetY,filter:g.filter,unsharpAmount:g.unsharpAmount,unsharpRadius:g.unsharpRadius,unsharpThreshold:g.unsharpThreshold};return _.debug("Invoke resize math"),Promise.resolve(O).then(function(H){return _.__extractTileData(G,n,g,v,H)}).then(function(H){return _.debug("Invoke resize math"),_.__invokeResize(H,g)}).then(function(H){return g.canceled?g.cancelToken:(v.srcImageData=null,_.__landTileData(G,H,v))})})}(H)});function O(H){H.srcImageBitmap&&(H.isImageBitmapReused||H.srcImageBitmap.close(),H.srcImageBitmap=null)}return _.debug("Process tiles"),Promise.all(G).then(function(){return _.debug("Finished!"),O(v),I},function(H){throw O(v),H})})},R.prototype.__processStages=function(n,I,g,_){var v=this;if(_.canceled)return _.cancelToken;var j,W,U=E(n.shift(),2),G=U[0],O=U[1],H=0===n.length;return j=H||d.q2f.indexOf(_.filter)<0?_.filter:"box"===_.filter?"box":"hamming",_=e({},_,{toWidth:G,toHeight:O,filter:j}),H||(W=this.options.createCanvas(G,O)),this.__tileAndResize(I,H?g:W,_).then(function(){return H?g:(_.width=G,_.height=O,v.__processStages(n,W,g,_))}).then(function(q){return W&&(W.width=W.height=0),q})},R.prototype.__resizeViaCreateImageBitmap=function(n,I,g){var _=this,v=I.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(n,{resizeWidth:g.toWidth,resizeHeight:g.toHeight,resizeQuality:f.cib_quality_name(d.f2q[g.filter])}).then(function(P){if(g.canceled)return g.cancelToken;if(!g.unsharpAmount)return v.drawImage(P,0,0),P.close(),v=null,_.debug("Finished!"),I;_.debug("Unsharp result");var U=_.options.createCanvas(g.toWidth,g.toHeight),G=U.getContext("2d");G.drawImage(P,0,0),P.close();var O=G.getImageData(0,0,g.toWidth,g.toHeight);return _.__mathlib.unsharp_mask(O.data,g.toWidth,g.toHeight,g.unsharpAmount,g.unsharpRadius,g.unsharpThreshold),v.putImageData(O,0,0),U.width=U.height=0,O=G=U=v=null,_.debug("Finished!"),I})},R.prototype.resize=function(n,I,g){var _=this;this.debug("Start resize...");var v=e({},w);if(isNaN(g)?g&&(v=e(v,g)):v=e(v,{quality:g}),v.toWidth=I.width,v.toHeight=I.height,v.width=n.naturalWidth||n.width,v.height=n.naturalHeight||n.height,Object.prototype.hasOwnProperty.call(v,"quality")){if(v.quality<0||v.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(v.quality));v.filter=d.q2f[v.quality]}return 0===I.width||0===I.height?Promise.reject(new Error("Invalid output size: ".concat(I.width,"x").concat(I.height))):(v.unsharpRadius>2&&(v.unsharpRadius=2),v.canceled=!1,v.cancelToken&&(v.cancelToken=v.cancelToken.then(function(U){throw v.canceled=!0,U},function(U){throw v.canceled=!0,U})),v.__destTileBorder=Math.ceil(Math.max(3,2.5*v.unsharpRadius|0)),this.init().then(function(){if(v.canceled)return v.cancelToken;if(_.features.cib){if(d.q2f.indexOf(v.filter)>=0)return _.__resizeViaCreateImageBitmap(n,I,v);_.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!B){var U=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw U.code="ERR_GET_IMAGE_DATA",U}var G=r(v.width,v.height,v.toWidth,v.toHeight,_.options.tile,v.__destTileBorder);return _.__processStages(G,n,I,v)}))},R.prototype.resizeBuffer=function(n){var I=this,g=e({},w,n);if(Object.prototype.hasOwnProperty.call(g,"quality")){if(g.quality<0||g.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(g.quality));g.filter=d.q2f[g.quality]}return this.init().then(function(){return I.__mathlib.resizeAndUnsharp(g)})},R.prototype.toBlob=function(n,I,g){return I=I||"image/png",new Promise(function(_){if(n.toBlob)n.toBlob(function(O){return _(O)},I,g);else if(n.convertToBlob)_(n.convertToBlob({type:I,quality:g}));else{for(var v=atob(n.toDataURL(I,g).split(",")[1]),P=v.length,U=new Uint8Array(P),G=0;G<P;G++)U[G]=v.charCodeAt(G);_(new Blob([U],{type:I}))}})},R.prototype.debug=function(){},C.exports=R},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")}}]);