"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8734],{8734:(se,M,p)=>{p.r(M),p.d(M,{ClientLevelPageModule:()=>te});var g=p(6814),f=p(6223),_=p(3582),m=p(8520),h=p(5861),b=p(4036),v=p(6676),e=p(2029),P=p(2234),w=p(5693),O=p(3271),y=p(2425),L=p(7364),x=p(3911);const k=["circleSVG"];function T(n,s){if(1&n&&(e.O4$(),e._UZ(0,"path",12)),2&n){const l=s.index,t=e.oxw();e.uIk("d",t.getCirclePath(l))("stroke",t.getCircleColor(l,t.currentLevel))}}const Z=function(n){return{color:n}};let S=(()=>{var n;class s{constructor(){this.allLevels=[],this.currentLevel=0,this.currentLevelChange=new e.vpe,this.startX=0,this.endX=0,this.touchStartTime=0,this.moved=!1,this.objectiveValue=[]}ngOnInit(){if(this.currentLevel){let t=this.allLevels.findIndex(i=>i.id===this.currentLevel);this.currentLevel=-1===t?0:t}else this.currentLevel=0}ngAfterViewInit(){this.initializeCircleRotation()}ngOnChanges(t){t.currentLevel&&!t.currentLevel.firstChange&&this.initializeCircleRotation()}initializeCircleRotation(){this.setCircleRotation()}onTouchStart(t){this.startX=t.touches[0].clientX,this.touchStartTime=Date.now(),this.moved=!1}onTouchMove(t){this.endX=t.touches[0].clientX,this.moved=!0}onTouchEnd(t){const i=Date.now()-this.touchStartTime;this.moved&&i>200&&(this.startX-this.endX>50?this.rotate("right"):this.endX-this.startX>50&&this.rotate("left"))}onCircleClick(t){if(!this.moved){const i=t.target.getBoundingClientRect();this.rotate(t.clientX>i.left+i.width/2?"right":"left")}}getCirclePath(t){const o=this.screenWidth-16,r=360/this.allLevels.length,u=t*r-r,C=u+(r-8/o*(180/Math.PI));return`M ${this.screenWidth+o*Math.cos(this.degToRad(u-90))} ${this.screenWidth+o*Math.sin(this.degToRad(u-90))} A ${o} ${o} 0 ${C-u<=180?0:1} 1 ${this.screenWidth+o*Math.cos(this.degToRad(C-90))} ${this.screenWidth+o*Math.sin(this.degToRad(C-90))}`}degToRad(t){return t*Math.PI/180}get screenWidth(){return.75*window.innerWidth}get circleWidth(){return 2*this.screenWidth}getCircleColor(t,i){return t<=i?this.allLevels[t].color:this.allLevels[t].inactive_color}rotate(t){"left"===t&&0!==this.currentLevel?this.currentLevel--:"right"===t&&this.currentLevel!==this.allLevels.length-1&&this.currentLevel++,this.setCircleRotation(),this.currentLevelChange.emit(this.currentLevel)}setCircleRotation(){this.circleSVG.nativeElement.style.transform=`rotate(${-this.currentLevel*(360/this.allLevels.length)}deg)`}}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-level-wheel"]],viewQuery:function(t,i){if(1&t&&e.Gf(k,5),2&t){let o;e.iGM(o=e.CRH())&&(i.circleSVG=o.first)}},inputs:{allLevels:"allLevels",currentLevel:"currentLevel"},outputs:{currentLevelChange:"currentLevelChange"},features:[e.TTD],decls:14,vars:14,consts:[[1,"flex-circle"],[1,"circle-container",3,"click","touchstart","touchmove","touchend"],["xmlns","http://www.w3.org/2000/svg"],["circleSVG",""],["fill","none","stroke-width","8",4,"ngFor","ngForOf"],[1,"circle-marker"],["r","16","fill","#666666","opacity","0.4"],["r","12","fill","white"],[1,"padding-wrapper-circle"],[1,"circle-text"],[1,"circle-text-subtitle",3,"ngStyle"],[1,"circle-text-title"],["fill","none","stroke-width","8"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.NdJ("click",function(r){return i.onCircleClick(r)})("touchstart",function(r){return i.onTouchStart(r)})("touchmove",function(r){return i.onTouchMove(r)})("touchend",function(r){return i.onTouchEnd(r)}),e.O4$(),e.TgZ(2,"svg",2,3),e.YNc(4,T,1,2,"path",4),e.qZA(),e.TgZ(5,"svg",5),e._UZ(6,"circle",6)(7,"circle",7),e.qZA()()(),e.kcU(),e.TgZ(8,"div",8)(9,"div",9)(10,"div",10),e._uU(11),e.qZA(),e.TgZ(12,"div",11),e._uU(13),e.qZA()()()),2&t&&(e.xp6(2),e.uIk("width",i.circleWidth)("height",i.circleWidth),e.xp6(2),e.Q6J("ngForOf",i.allLevels),e.xp6(1),e.uIk("width",i.circleWidth)("height",i.circleWidth),e.xp6(1),e.uIk("cx",i.screenWidth)("cy",16),e.xp6(1),e.uIk("cx",i.screenWidth)("cy",16),e.xp6(3),e.Q6J("ngStyle",e.VKq(12,Z,i.allLevels[i.currentLevel].inactive_color)),e.xp6(1),e.hij(" ",i.allLevels[i.currentLevel].league," "),e.xp6(2),e.hij(" ",i.allLevels[i.currentLevel].name," "))},dependencies:[g.sg,g.PC],styles:['.padding-wrapper-circle[_ngcontent-%COMP%]{padding:20px 16px;margin-top:-25vw}.flex-circle[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center}.circle-container[_ngcontent-%COMP%]{width:150vw;height:40vw;position:relative;overflow:hidden}.circle-container[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{transition:transform .6s ease-in-out}.circle-container[_ngcontent-%COMP%]:active{opacity:.7}.circle-container[_ngcontent-%COMP%]:hover{cursor:pointer;opacity:.9}.circle-marker[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.circle-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:center;text-align:center}.circle-text-subtitle[_ngcontent-%COMP%]{font-size:14px}.circle-text-title[_ngcontent-%COMP%]{color:#fff;font-size:28px;font-weight:600}.circle-list-title[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between;margin-top:40px;margin-bottom:12px}.circle-list-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.circle-list-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:15px}.circle-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.circle-list-item[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.circle-list-check-empty[_ngcontent-%COMP%]{width:18px;min-width:18px;height:18px;background:transparent;border:1px solid #c8c8c8;border-radius:6px}.circle-list-item-text[_ngcontent-%COMP%]{font-size:13px}.input-label[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.textarea-form[_ngcontent-%COMP%]{width:100%;border-radius:12px;color:#fff;padding:12px 16px;margin-bottom:24px;font-size:15px;border:none;background:transparent;outline:0}.custom-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.simple-check-option[_ngcontent-%COMP%]{position:relative;display:inline-block;cursor:pointer;width:22px;height:22px}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.custom-check[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:22px;height:22px;background:transparent;border:1px solid #c8c8c8;border-radius:6px;display:block;align-items:center;justify-content:center}.custom-check[_ngcontent-%COMP%]:before{content:"";width:5px;height:10px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);position:absolute;top:4px;left:8px;display:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]{background:var(--ion-color-primary);border:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]:before{display:block}ion-range[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px;margin-top:-4px}.range-labels[_ngcontent-%COMP%]{display:flex;width:100%;font-size:10px;align-items:center;justify-content:space-between;margin-top:-14px}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){text-align:left}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){text-align:center}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){text-align:right}']}),s})();var A=p(1211);function I(n,s){if(1&n&&e._UZ(0,"img",6),2&n){const l=e.oxw(2);e.Q6J("src",l.file,e.LSH)}}function D(n,s){if(1&n&&e._UZ(0,"video",7),2&n){const l=e.oxw(2);e.Q6J("src",l.file,e.LSH)}}function E(n,s){if(1&n&&(e.TgZ(0,"div",3),e.YNc(1,I,1,1,"img",4),e.YNc(2,D,1,1,"video",5),e.qZA()),2&n){const l=e.oxw();e.xp6(1),e.Q6J("ngIf","image"==l.type),e.xp6(1),e.Q6J("ngIf","video"==l.type)}}let J=(()=>{var n;class s{constructor(){this.type="",this.file="",this.close=new e.vpe}doCloseModal(){this.close.emit()}}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-file-view"]],inputs:{type:"type",file:"file"},outputs:{close:"close"},decls:3,vars:1,consts:[[1,"modal"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","modal-close",3,"click"],["class","modal-content",4,"ngIf"],[1,"modal-content"],["class","preview",3,"src",4,"ngIf"],["class","preview","controls","",3,"src",4,"ngIf"],[1,"preview",3,"src"],["controls","",1,"preview",3,"src"]],template:function(t,i){1&t&&(e.TgZ(0,"div",0)(1,"img",1),e.NdJ("click",function(){return i.doCloseModal()}),e.qZA(),e.YNc(2,E,3,2,"div",2),e.qZA()),2&t&&(e.xp6(2),e.Q6J("ngIf",i.file))},dependencies:[g.O5],styles:[".modal[_ngcontent-%COMP%]{width:100%;height:100vh;min-height:100vh;max-height:100vh;z-index:999;background:rgba(0,0,0,.7);position:fixed;top:0;left:0}.modal-close[_ngcontent-%COMP%]{width:28px;position:absolute;top:10px;right:10px}.modal-content[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 44px);position:relative;z-index:1000;left:0;top:44px;border-radius:8px}.preview[_ngcontent-%COMP%]{object-fit:contain;width:100%;height:100%;border-radius:8px}"]}),s})();function z(n,s){if(1&n&&(e.TgZ(0,"div",24),e._UZ(1,"img",25),e.TgZ(2,"span",26),e._uU(3),e.qZA()()),2&n){const l=e.oxw();e.xp6(1),e.Q6J("src",l.sportEvaluation.icon_selected,e.LSH),e.xp6(2),e.Oqu(l.sportEvaluation.name)}}function G(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"app-level-wheel",27),e.NdJ("currentLevelChange",function(i){e.CHM(l);const o=e.oxw();return e.KtG(o.onCurrentLevelChange(i))}),e.qZA()}if(2&n){const l=e.oxw();e.Q6J("allLevels",l.sportDegrees)("currentLevel",l.clientMonitor.degree_sport)}}function j(n,s){1&n&&(e.TgZ(0,"div",28),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"level_completed")," "))}function F(n,s){if(1&n){const l=e.EpF();e.ynx(0),e.TgZ(1,"div",29)(2,"div",30),e._uU(3),e.qZA()(),e.TgZ(4,"ion-range",31),e.NdJ("ngModelChange",function(i){const r=e.CHM(l).$implicit;return e.KtG(r.score=i)}),e.qZA(),e.TgZ(5,"div",32)(6,"div",33),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"div",33),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",33),e._uU(13),e.ALo(14,"translate"),e.qZA()(),e.BQk()}if(2&n){const l=s.$implicit,t=e.oxw();e.xp6(3),e.hij(" ",l.name," "),e.xp6(1),e.Q6J("disabled",t.alreadyCompleted)("ngModel",l.score)("ticks",!0)("snaps",!0)("min",0)("max",10),e.xp6(3),e.Oqu(e.lcZ(8,10,"not_accomplished")),e.xp6(3),e.Oqu(e.lcZ(11,12,"to_improve")),e.xp6(3),e.Oqu(e.lcZ(14,14,"accomplished"))}}function Q(n,s){if(1&n){const l=e.EpF();e.ynx(0),e.TgZ(1,"div",34),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"div",29)(5,"div",35)(6,"label",36)(7,"input",37),e.NdJ("ngModelChange",function(i){e.CHM(l);const o=e.oxw();return e.KtG(o.completeLevel=i)}),e.qZA(),e._UZ(8,"div",38),e.qZA()(),e.TgZ(9,"div",39),e._uU(10),e.ALo(11,"translate"),e.qZA()(),e.BQk()}if(2&n){const l=e.oxw();e.xp6(2),e.hij(" ",e.lcZ(3,3,"level_confirmation")," "),e.xp6(5),e.Q6J("ngModel",l.completeLevel),e.xp6(3),e.hij(" ",e.lcZ(11,5,"confirm_completion")," ")}}function N(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"div",40)(1,"img",41),e.NdJ("click",function(){e.CHM(l);const i=e.oxw();return e.KtG(i.toggleMultimedia())}),e.qZA()()}}function B(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"img",46),e.NdJ("click",function(){e.CHM(l);const i=e.oxw().$implicit,o=e.oxw();return e.KtG(o.viewMultimedia(i.type,i.file))}),e.qZA()}if(2&n){const l=e.oxw().$implicit;e.Q6J("src",l.file,e.LSH)}}function Y(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"video",47),e.NdJ("click",function(){e.CHM(l);const i=e.oxw().$implicit,o=e.oxw();return e.KtG(o.viewMultimedia(i.type,i.file))}),e.qZA()}if(2&n){const l=e.oxw().$implicit;e.Q6J("src",l.file,e.LSH)}}function q(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"div",48),e.NdJ("click",function(){e.CHM(l);const i=e.oxw().$implicit,o=e.oxw();return e.KtG(o.viewMultimedia(i.type,i.file))}),e._UZ(1,"img",49),e.qZA()}}function V(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"div",50),e.NdJ("click",function(){e.CHM(l);const i=e.oxw().index,o=e.oxw();return e.KtG(o.deleteMultimedia(i))}),e._UZ(1,"img",51),e.qZA()}}function W(n,s){if(1&n&&(e.TgZ(0,"div",40),e.YNc(1,B,1,1,"img",42),e.YNc(2,Y,1,1,"video",43),e.YNc(3,q,2,0,"div",44),e.YNc(4,V,2,0,"div",45),e.qZA()),2&n){const l=s.$implicit,t=e.oxw();e.xp6(1),e.Q6J("ngIf","image"==l.type),e.xp6(1),e.Q6J("ngIf","video"==l.type),e.xp6(1),e.Q6J("ngIf","video"==l.type),e.xp6(1),e.Q6J("ngIf",!t.alreadyCompleted)}}function U(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"button",52),e.NdJ("click",function(){e.CHM(l);const i=e.oxw();return e.KtG(i.saveEvaluation())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"save_progress")," "))}function R(n,s){1&n&&(e.TgZ(0,"button",53),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&n&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"level_completed")," "))}function $(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"app-file-upload",54),e.NdJ("fileSelected",function(i){e.CHM(l);const o=e.oxw();return e.KtG(o.addMultimedia(i))})("close",function(){e.CHM(l);const i=e.oxw();return e.KtG(i.toggleMultimedia())}),e.ALo(1,"translate"),e.qZA()}2&n&&(e.s9C("title",e.lcZ(1,3,"add_multimedia")),e.Q6J("allowImage",!0)("allowVideo",!0))}function H(n,s){if(1&n){const l=e.EpF();e.TgZ(0,"app-file-view",55),e.NdJ("close",function(){e.CHM(l);const i=e.oxw();return e.KtG(i.toggleView())}),e.qZA()}if(2&n){const l=e.oxw();e.Q6J("type",l.viewTypeSelected)("file",l.viewFileSelected)}}const X=[{path:"",component:(()=>{var n;class s{constructor(t,i,o,r,c,d,a,u){this.router=t,this.activatedRoute=i,this.monitorDataService=o,this.sharedDataService=r,this.teachService=c,this.toastr=d,this.spinnerService=a,this.translate=u,this.showMultimedia=!1,this.showView=!1,this.completeLevel=!1,this.degrees=[],this.sportDegrees=[],this.sports=[],this.goals=[],this.filteredGoals=[],this.alreadyCompleted=!1,this.allGoalScores=[],this.allMultimedia=[],this.allMultimediaDelete=[]}ngOnInit(){var t=this;return(0,h.Z)(function*(){t.subscription=t.monitorDataService.getMonitorData().subscribe(function(){var i=(0,h.Z)(function*(o){if(o){t.monitorData=o;try{t.degrees=yield(0,b.z)(t.sharedDataService.fetchDegrees(t.monitorData.active_school)),t.sports=yield(0,b.z)(t.sharedDataService.fetchSports(t.monitorData.active_school))}catch(r){console.error("Error fetching data:",r),t.toastr.error(t.translate.instant("toast.error_loading_data"))}t.activatedRoute.params.subscribe(function(){var r=(0,h.Z)(function*(c){t.typeRoute=c.type,t.bookingId=+c.id,t.dateBooking=c.date,t.clientIdBooking=+c.client,t.sportIdBooking=+c.sport,t.typeRoute&&t.bookingId&&t.dateBooking&&t.clientIdBooking&&t.sportIdBooking?(t.spinnerService.show(),yield t.getClientEvaluations(),t.getClient(),t.getClientSports(),t.spinnerService.hide()):t.goTo("home")});return function(c){return r.apply(this,arguments)}}())}});return function(o){return i.apply(this,arguments)}}())})()}getClient(){this.teachService.getData(`teach/clients/${this.clientIdBooking}`).subscribe(t=>{const i=t.data;if(i){const o=v(i.birth_date),r=v().diff(o,"years");i.birth_years=r;let c=i.sports.find(d=>d.id===this.sportIdBooking);if(i.degree_sport=c&&c.pivot&&c.pivot.degree_id?c.pivot.degree_id:0,this.clientMonitor=i,this.clientMonitor.degree_sport){let d=this.sportDegrees.findIndex(a=>a.id===this.clientMonitor.degree_sport);-1===d?(this.newLevel=0,this.currentLevelMain=this.sportDegrees[0]):(this.clientLevel=d,this.newLevel=d,this.currentLevelMain=this.sportDegrees[d])}else this.newLevel=0,this.currentLevelMain=this.sportDegrees[0];this.getCurrentGoals(),this.filterEvaluationDegree()}else this.goTo("clients")},t=>{console.error("There was an error fetching clients!",t)})}getGoals(){var t=this;return(0,h.Z)(function*(){try{const i=yield t.teachService.getData("degrees-school-sport-goals").toPromise();t.goals=i.data,t.goals.forEach(o=>{const r=t.allGoalScores.find(c=>c.degrees_school_sport_goals_id===o.id);r?(o.score=r.score,o.update_id=r.id):(o.score=0,o.update_id=0)})}catch(i){console.error("There was an error!",i)}})()}getClientSports(){var t=this;return(0,h.Z)(function*(){t.teachService.getData("client-sports",null,{client_id:t.clientIdBooking}).subscribe(i=>{const o=i.data.filter(r=>r.client_id===t.clientIdBooking&&r.sport_id===t.sportIdBooking);t.currentClientSport=0===o.length?null:1===o.length?o[0]:o.sort((r,c)=>c.id-r.id)[0]},i=>{console.error("There was an error!",i)})})()}getClientEvaluations(){var t=this;return(0,h.Z)(function*(){try{t.sportDegrees=t.degrees.filter(a=>a.sport_id===t.sportIdBooking),t.sportEvaluation=t.sports.find(a=>a.id===t.sportIdBooking);const i=yield t.teachService.getData("evaluations",null,{client_id:t.clientIdBooking}).toPromise();t.clientEvaluations=i.data;const o=t.clientEvaluations.map(a=>t.teachService.getData("evaluation-fulfilled-goals",null,{evaluation_id:a.id}).toPromise()),r=yield Promise.all(o);let c=[];r.forEach(a=>{c.push(...a.data)});let d={};c.forEach(a=>{(!d[a.degrees_school_sport_goals_id]||d[a.degrees_school_sport_goals_id].id<a.id)&&(d[a.degrees_school_sport_goals_id]=a)}),t.allGoalScores=Object.values(d),yield t.getGoals()}catch(i){console.error("There was an error!",i)}})()}filterEvaluationDegree(){const t=this.clientEvaluations.filter(i=>i.degree_id===this.currentLevelMain.id);0===t.length?(this.clientDegreeEvaluation=null,this.observationsEvaluation="",this.allMultimedia=[]):1===t.length?(this.clientDegreeEvaluation=t[0],this.observationsEvaluation=this.clientDegreeEvaluation.observations,this.allMultimedia=this.clientDegreeEvaluation.files):(this.clientDegreeEvaluation=t.sort((i,o)=>o.id-i.id)[0],this.observationsEvaluation=this.clientDegreeEvaluation.observations,this.allMultimedia=this.clientDegreeEvaluation.files)}getBirthYears(t){const i=v(t);return v().diff(i,"years")}onCurrentLevelChange(t){this.alreadyCompleted=this.clientLevel>t,this.newLevel=t,this.currentLevelMain=this.sportDegrees[t],this.filterEvaluationDegree(),this.getCurrentGoals()}getCurrentGoals(){const t=this.goals.filter(i=>i.degree_id===this.currentLevelMain.id);this.filteredGoals=t.sort((i,o)=>i.id-o.id)}countGoalsCompleted(){return this.filteredGoals.filter(t=>10===t.score).length}allGoalsCompleted(){return this.filteredGoals.every(t=>10===t.score)}handleGoalsAndClientSport(t){const i=this.filteredGoals.map(o=>{let r={evaluation_id:t,degrees_school_sport_goals_id:o.id,score:o.score};return o.update_id?this.teachService.updateData("evaluation-fulfilled-goals",o.update_id,r).toPromise():this.teachService.postData("evaluation-fulfilled-goals",r).toPromise()});Promise.all(i).then(()=>this.processAllMultimedia(t)).then(()=>this.processAllMultimediaDelete()).then(()=>this.assignLevelToClient(t)).catch(o=>{console.error("Error in processing:",o),this.spinnerService.hide()})}processAllMultimedia(t){if(this.allMultimedia&&this.allMultimedia.length>0){const i=this.allMultimedia.map(o=>o.id?Promise.resolve(null):this.teachService.postData("evaluation-files",{evaluation_id:t,name:"",type:o.type,file:o.file}).toPromise());return Promise.all(i)}return Promise.resolve([])}processAllMultimediaDelete(){if(this.allMultimediaDelete&&this.allMultimediaDelete.length>0){const t=this.allMultimediaDelete.map(i=>this.teachService.deleteData("evaluation-files",i.id).toPromise());return Promise.all(t)}return Promise.resolve([])}assignLevelToClient(t){let i=this.currentLevelMain.id;this.allGoalsCompleted()&&this.completeLevel&&this.sportDegrees[this.newLevel+1]&&this.sportDegrees[this.newLevel+1].id&&(i=this.sportDegrees[this.newLevel+1].id);let o={client_id:this.clientIdBooking,sport_id:this.sportIdBooking,degree_id:i,school_id:this.monitorData.active_school};return this.currentClientSport?this.teachService.updateData("client-sports",this.currentClientSport.id,o).subscribe(r=>{this.spinnerService.hide(),this.goBackType(),this.toastr.success(this.translate.instant("toast.evaluation_registered"))},r=>{console.error("Error:",r),this.toastr.error(this.translate.instant("toast.error")),this.spinnerService.hide()}):this.teachService.postData("client-sports",o).subscribe(r=>{this.spinnerService.hide(),this.goBackType(),this.toastr.success(this.translate.instant("toast.evaluation_registered"))},r=>{console.error("Error:",r),this.toastr.error(this.translate.instant("toast.error")),this.spinnerService.hide()})}saveEvaluation(){this.spinnerService.show();const t={client_id:this.clientIdBooking,degree_id:this.currentLevelMain.id,observations:this.observationsEvaluation};this.clientDegreeEvaluation?this.teachService.updateData("evaluations",this.clientDegreeEvaluation.id,t).subscribe(i=>{this.handleGoalsAndClientSport(this.clientDegreeEvaluation.id)},i=>{console.error("Error in updating evaluation:",i),this.spinnerService.hide()}):this.teachService.postData("evaluations",t).subscribe(i=>{this.handleGoalsAndClientSport(i.data.id)},i=>{console.error("Error in posting evaluation:",i),this.spinnerService.hide()})}addMultimedia(t){t.base64&&this.allMultimedia.push({type:t.isVideo?"video":"image",file:t.base64})}deleteMultimedia(t){this.allMultimedia[t]&&(this.allMultimedia[t].id&&this.allMultimediaDelete.push(this.allMultimedia[t]),this.allMultimedia.splice(t,1))}viewMultimedia(t,i){t&&i&&(this.viewTypeSelected=t,this.viewFileSelected=i,this.toggleView())}toggleMultimedia(){this.showMultimedia=!this.showMultimedia}toggleView(){this.showView=!this.showView}goBackType(){"course"==this.typeRoute?this.goTo("course-detail-level",this.bookingId,this.dateBooking,this.clientIdBooking,this.sportIdBooking):this.goTo("client-detail",this.clientIdBooking)}goTo(...t){this.router.navigate(t)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(n=s).\u0275fac=function(t){return new(t||n)(e.Y36(m.F0),e.Y36(m.gz),e.Y36(P.q),e.Y36(w.g),e.Y36(O.b),e.Y36(y._W),e.Y36(L.V),e.Y36(x.sK))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-client-level"]],decls:36,vars:27,consts:[[1,"content-size","dark-background","status-bar-overlap"],[1,"padding-wrapper"],[1,"header-content","no-margin"],[1,"montserrat","level-back","color-light","cursor-pointer",3,"click"],["class","flex-sport",4,"ngIf"],[3,"allLevels","currentLevel","currentLevelChange",4,"ngIf"],["class","completed-banner background-color-dark mt-12 pt-24 pb-24",4,"ngIf"],[1,"padding-wrapper","mt-12","mb-12"],[1,"circle-list-title","mb-24"],[1,"color-light"],[1,"circle-list"],[4,"ngFor","ngForOf"],[1,"input-label","color-light","montserrat","mt-32"],["rows","5",1,"montserrat","textarea-form","background-color-dark",3,"disabled","ngModel","ngModelChange"],[4,"ngIf"],[1,"padding-wrapper","mt-12","pt-24","top-border-wrapper"],[1,"flex-title-selector-text","mb-12"],[1,"media-list"],["class","media-list-item",4,"ngIf"],["class","media-list-item",4,"ngFor","ngForOf"],["class","content-button btn-back-primary montserrat mt-32 mb-32",3,"click",4,"ngIf"],["class","content-button btn-back-grey montserrat mt-32 mb-32",4,"ngIf"],[3,"title","allowImage","allowVideo","fileSelected","close",4,"ngIf"],[3,"type","file","close",4,"ngIf"],[1,"flex-sport"],[3,"src"],[1,"montserrat"],[3,"allLevels","currentLevel","currentLevelChange"],[1,"completed-banner","background-color-dark","mt-12","pt-24","pb-24"],[1,"circle-list-item"],[1,"montserrat","circle-list-item-text"],["step","5",3,"disabled","ngModel","ticks","snaps","min","max","ngModelChange"],[1,"range-labels","mb-24"],[1,"montserrat","color-light"],[1,"input-label","color-light","montserrat","mt-12","uppercase"],[1,"custom-radio"],[1,"simple-check-option"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"custom-check"],[1,"montserrat","color-light","circle-list-item-text"],[1,"media-list-item"],["src","assets/icon/icon-camera-photo-box.png",1,"box-selector-image","cursor-pointer",3,"click"],["class","box-selector-image cursor-pointer",3,"src","click",4,"ngIf"],["class","box-selector-image cursor-pointer","muted","","playsinline","",3,"src","click",4,"ngIf"],["class","media-list-video cursor-pointer",3,"click",4,"ngIf"],["class","media-close-box cursor-pointer",3,"click",4,"ngIf"],[1,"box-selector-image","cursor-pointer",3,"src","click"],["muted","","playsinline","",1,"box-selector-image","cursor-pointer",3,"src","click"],[1,"media-list-video","cursor-pointer",3,"click"],["src","assets/icon/play.png"],[1,"media-close-box","cursor-pointer",3,"click"],["src","assets/icon/icon-close.png"],[1,"content-button","btn-back-primary","montserrat","mt-32","mb-32",3,"click"],[1,"content-button","btn-back-grey","montserrat","mt-32","mb-32"],[3,"title","allowImage","allowVideo","fileSelected","close"],[3,"type","file","close"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.NdJ("click",function(){return i.goBackType()}),e._uU(5),e.ALo(6,"translate"),e.qZA()()(),e.TgZ(7,"div",1),e.YNc(8,z,4,2,"div",4),e.qZA(),e.YNc(9,G,1,2,"app-level-wheel",5),e.YNc(10,j,3,3,"div",6),e.TgZ(11,"div",7)(12,"div",8)(13,"div"),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"span",9),e._uU(17),e.qZA()(),e.TgZ(18,"div",10),e.YNc(19,F,15,16,"ng-container",11),e.qZA(),e.TgZ(20,"div",12),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"textarea",13),e.NdJ("ngModelChange",function(r){return i.observationsEvaluation=r}),e.qZA(),e.YNc(24,Q,12,7,"ng-container",14),e.qZA(),e.TgZ(25,"div",15)(26,"div",16),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"div",17),e.YNc(30,N,2,0,"div",18),e.YNc(31,W,5,4,"div",19),e.qZA(),e.YNc(32,U,3,3,"button",20),e.YNc(33,R,3,3,"button",21),e.qZA()()(),e.YNc(34,$,2,5,"app-file-upload",22),e.YNc(35,H,1,2,"app-file-view",23)),2&t&&(e.xp6(5),e.hij(" ",e.lcZ(6,19,"cancel")," "),e.xp6(3),e.Q6J("ngIf",i.sportEvaluation),e.xp6(1),e.Q6J("ngIf",i.clientMonitor&&i.sportDegrees&&i.sportDegrees.length),e.xp6(1),e.Q6J("ngIf",i.alreadyCompleted),e.xp6(4),e.Oqu(e.lcZ(15,21,"goals")),e.xp6(3),e.AsE("",i.countGoalsCompleted(),"/",i.filteredGoals.length,""),e.xp6(2),e.Q6J("ngForOf",i.filteredGoals),e.xp6(2),e.hij(" ",e.lcZ(22,23,"observations"),": "),e.xp6(2),e.Q6J("disabled",i.alreadyCompleted)("ngModel",i.observationsEvaluation),e.xp6(1),e.Q6J("ngIf",i.allGoalsCompleted()&&!i.alreadyCompleted),e.xp6(3),e.hij(" ",e.lcZ(28,25,"multimedia")," "),e.xp6(3),e.Q6J("ngIf",!i.alreadyCompleted),e.xp6(1),e.Q6J("ngForOf",i.allMultimedia),e.xp6(1),e.Q6J("ngIf",!i.alreadyCompleted),e.xp6(1),e.Q6J("ngIf",i.alreadyCompleted),e.xp6(1),e.Q6J("ngIf",i.showMultimedia),e.xp6(1),e.Q6J("ngIf",i.showView))},dependencies:[g.sg,g.O5,f.Fj,f.Wl,f.JJ,f.On,_.W2,_.I_,_.QI,S,A.Y,J,x.X$],styles:['.content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.dark-background[_ngcontent-%COMP%]{width:100%;min-height:100vh;background:var(--ion-back-color-dark)}.header-content[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center;margin-bottom:60px}.header-content-icon[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.level-back[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);font-size:14px}.level-title[_ngcontent-%COMP%]{font-size:14px;color:#fff;font-weight:500}.flex-sport[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;justify-content:center}.flex-sport[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px}.flex-members[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between}.flex-members-left[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.flex-user-box[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;width:100%}.flex-user-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.flex-user-text-line[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.flex-user-title[_ngcontent-%COMP%]{font-size:15px;font-weight:500;color:#fff}.flex-user-back[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}.flex-user-back[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px;cursor:pointer}.flex-user-subtitle[_ngcontent-%COMP%]{font-size:14px;color:var(--ion-color-primary)}.flex-user-edit[_ngcontent-%COMP%]{width:22px}.box-arrow[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#2b303b}.box-arrow[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px}.user-image-wrapper[_ngcontent-%COMP%]{position:relative;width:60px;height:60px;border-radius:60px;display:block;margin:0 auto}.user-image[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%}.box-radius[_ngcontent-%COMP%]{width:100%;border-radius:8px}.box-top-no-flex[_ngcontent-%COMP%]{padding:10px 20px;border-bottom:1px solid #43494f;width:100%;white-space:nowrap;overflow-x:auto}.box-top-left[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:center}.opacity-light[_ngcontent-%COMP%]{opacity:.6}.box-top-icon[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;align-items:center;justify-content:center}.box-top-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px}.box-top-icon[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.flex-title-selector[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between}.flex-title-selector-interior[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.flex-title-selector-icon[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:40px;display:flex;align-items:center;justify-content:center}.flex-title-selector-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px}.flex-title-selector-text[_ngcontent-%COMP%]{color:#fff;font-size:20px;font-weight:500}.flex-title-selector-arrow[_ngcontent-%COMP%]{width:24px}.flex-title-add[_ngcontent-%COMP%]{display:flex;gap:6px;align-items:center}.flex-title-add[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px}.flex-title-add[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px}.list-box-selector[_ngcontent-%COMP%]{width:100%;overflow-x:auto;white-space:nowrap;display:flex;gap:16px;padding:8px 0}.box-selector[_ngcontent-%COMP%]{display:flex;white-space:normal;width:300px;min-width:300px;padding:12px;flex-direction:column;gap:14px;align-items:flex-start;border-radius:8px}.box-selector-top[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.box-selector-middle[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:space-between;width:100%}.box-selector-bottom[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.box-selector-date[_ngcontent-%COMP%]{color:#fff;font-size:14px;font-weight:500}.box-selector-price[_ngcontent-%COMP%]{font-size:13px}.box-selector-middle-interior[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}.box-selector-image-wrapper[_ngcontent-%COMP%]{width:46px;height:46px;border-radius:8px;position:relative}.box-selector-image[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:100%;border-radius:8px}.box-selector-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:5px}.box-selector-title[_ngcontent-%COMP%]{color:#fff;font-size:14px}.box-selector-subtitle[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px;font-size:13px}.box-selector-subtitle[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:20px}.box-selector-level[_ngcontent-%COMP%]{font-size:12px;color:#faafaf;background:#613136;padding:4px 6px;border-radius:20px}.box-selector-location[_ngcontent-%COMP%]{width:13px}.box-selector-user[_ngcontent-%COMP%]{display:flex;white-space:normal;width:120px;min-width:120px;max-width:120px;padding:8px;flex-direction:column;gap:12px;align-items:center;border-radius:8px;justify-content:flex-start}.box-selector-user-title[_ngcontent-%COMP%]{color:#fff;font-size:14px;line-height:1.3}.top-border-wrapper[_ngcontent-%COMP%]{border-top:1px solid #43494f}.media-list[_ngcontent-%COMP%]{display:flex;width:100%;gap:16px;flex-wrap:wrap;align-items:center}.media-list-item[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:8px;position:relative}.media-list-video[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;border-radius:8px;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center}.media-list-video[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:30px}.media-close-box[_ngcontent-%COMP%]{position:absolute;top:-8px;right:-8px;width:28px;height:28px;border-radius:28px;background:#41454e;display:flex;align-items:center;justify-content:center}.media-close-box[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:12px}.circle-list-title[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between;margin-top:40px;margin-bottom:12px}.circle-list-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:20px;font-weight:500}.circle-list-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:15px}.circle-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.circle-list-item[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.circle-list-check-empty[_ngcontent-%COMP%]{width:18px;min-width:18px;height:18px;background:transparent;border:1px solid #c8c8c8;border-radius:6px}.circle-list-item-text[_ngcontent-%COMP%]{font-size:13px}.input-label[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.textarea-form[_ngcontent-%COMP%]{width:100%;border-radius:12px;color:#fff;padding:12px 16px;margin-bottom:24px;font-size:15px;border:none;background:transparent;outline:0}.custom-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.simple-check-option[_ngcontent-%COMP%]{position:relative;display:inline-block;cursor:pointer;width:22px;height:22px}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.custom-check[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:22px;height:22px;background:transparent;border:1px solid #c8c8c8;border-radius:6px;display:block;align-items:center;justify-content:center}.custom-check[_ngcontent-%COMP%]:before{content:"";width:5px;height:10px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);position:absolute;top:4px;left:8px;display:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]{background:var(--ion-color-primary);border:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]:before{display:block}ion-range[_ngcontent-%COMP%]{padding-left:30px;padding-right:30px;margin-top:-4px}.range-labels[_ngcontent-%COMP%]{display:flex;width:100%;font-size:10px;align-items:center;justify-content:space-between;margin-top:-14px}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{flex:1}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(1){text-align:left}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(2){text-align:center}.range-labels[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:nth-child(3){text-align:right}.completed-banner[_ngcontent-%COMP%]{width:100%;text-align:center;font-weight:600;font-size:18px;margin-bottom:-32px}']}),s})()}];let K=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[m.Bz.forChild(X),m.Bz]}),s})();var ee=p(822);let te=(()=>{var n;class s{}return(n=s).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[g.ez,f.u5,_.Pc,K,ee.K,x.aw]}),s})()}}]);