"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7006],{7006:(me,C,h)=>{h.r(C),h.d(C,{CalendarAvailablePageModule:()=>he});var b=h(6814),v=h(6223),T=h(3582),M=h(5367),x=h(5861),g=h(6676),e=h(6689),w=h(2234),Z=h(3271),P=h(2425),Y=h(7364);function O(a,r){1&a&&(e.TgZ(0,"div"),e._uU(1,"Disponibilit\xe9"),e.qZA())}function S(a,r){1&a&&(e.TgZ(0,"div"),e._uU(1,"Editer Disponibilit\xe9"),e.qZA())}const A=function(a,r){return{"btn-back-primary":a,"btn-back-grey":r}};function H(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"div",10)(1,"div",11),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return i.showMonthAvailable=!0,e.KtG(i.showDayAvailable=!1)}),e._uU(2," Mois "),e.qZA(),e.TgZ(3,"div",11),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return i.showMonthAvailable=!1,e.KtG(i.showDayAvailable=!0)}),e._uU(4," Jour "),e.qZA()()}if(2&a){const n=e.oxw();e.xp6(1),e.Q6J("ngClass",e.WLB(2,A,n.showMonthAvailable,!n.showMonthAvailable)),e.xp6(2),e.Q6J("ngClass",e.WLB(5,A,n.showDayAvailable,!n.showDayAvailable))}}function E(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"div",12)(1,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.previousMonth())}),e._UZ(2,"img",14),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA(),e.TgZ(5,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.nextMonth())}),e._UZ(6,"img",16),e.qZA()()}if(2&a){const n=e.oxw();e.xp6(4),e.AsE(" ",n.monthNames[n.currentMonth]," ",n.currentYear," ")}}function J(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"div",12)(1,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.previousDay())}),e._UZ(2,"img",14),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA(),e.TgZ(5,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.nextDay())}),e._UZ(6,"img",16),e.qZA()()}if(2&a){const n=e.oxw(2);e.xp6(4),e.HOy(" ",n.getWeekdayName(n.selectedDate),", ",n.currentDay," ",n.monthNames[n.currentMonth]," ",n.currentYear," ")}}function N(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"div",12)(1,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.previousMonth())}),e._UZ(2,"img",14),e.qZA(),e.TgZ(3,"div",15),e._uU(4),e.qZA(),e.TgZ(5,"div",13),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.nextMonth())}),e._UZ(6,"img",16),e.qZA()()}if(2&a){const n=e.oxw(2);e.xp6(4),e.AsE(" ",n.monthNames[n.currentMonth]," ",n.currentYear," ")}}function q(a,r){1&a&&(e.TgZ(0,"div",20),e._uU(1,"Calendrier ouvert"),e.qZA())}function B(a,r){1&a&&(e.TgZ(0,"div",20),e._uU(1,"Fermer le calendrier"),e.qZA())}function Q(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.YNc(1,J,7,4,"div",8),e.YNc(2,N,7,2,"div",8),e.TgZ(3,"div",17),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.showDayCalendar=!i.showDayCalendar)}),e._UZ(4,"img",18),e.YNc(5,q,2,0,"div",19),e.YNc(6,B,2,0,"div",19),e.qZA(),e.BQk()}if(2&a){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",!n.showDayCalendar),e.xp6(1),e.Q6J("ngIf",n.showDayCalendar),e.xp6(3),e.Q6J("ngIf",!n.showDayCalendar),e.xp6(1),e.Q6J("ngIf",n.showDayCalendar)}}function U(a,r){if(1&a&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.xp6(1),e.Oqu(n)}}function F(a,r){1&a&&e._UZ(0,"span",49)}function $(a,r){1&a&&e._UZ(0,"span",50)}const k=function(a){return{"very-light-opacity":a}};function I(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"span",44),e.NdJ("click",function(){e.CHM(n);const i=e.oxw().$implicit,o=e.oxw(2);return e.KtG(o.selectDate(i))}),e.TgZ(1,"span",45)(2,"span",46),e._uU(3),e.qZA(),e.YNc(4,F,1,0,"span",47),e.YNc(5,$,1,0,"span",48),e.qZA()()}if(2&a){const n=e.oxw().$implicit;e.Q6J("ngClass",e.VKq(4,k,n.past)),e.xp6(3),e.Oqu(n.number),e.xp6(1),e.Q6J("ngIf",n.activeSelected),e.xp6(1),e.Q6J("ngIf",n.activeRange)}}function R(a,r){1&a&&e._UZ(0,"span",51)}function K(a,r){if(1&a&&(e.ynx(0),e.YNc(1,I,6,6,"span",42),e.YNc(2,R,1,0,"span",43),e.BQk()),2&a){const n=r.$implicit;e.xp6(1),e.Q6J("ngIf",null!==n.number),e.xp6(1),e.Q6J("ngIf",null===n.number)}}function G(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function z(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function j(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",30),e._uU(2," Heure de d\xe9but "),e.qZA(),e.TgZ(3,"div",31)(4,"select",52),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(2);return e.KtG(o.startTimeMonth=i)})("change",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.onStartTimeMonthChange())}),e.YNc(5,G,2,2,"option",53),e.qZA()(),e.TgZ(6,"div",30),e._uU(7," Heure de fin "),e.qZA(),e.TgZ(8,"div",31)(9,"select",54),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(2);return e.KtG(o.endTimeMonth=i)}),e.YNc(10,z,2,2,"option",53),e.qZA()(),e.BQk()}if(2&a){const n=e.oxw(2);e.xp6(4),e.Q6J("ngModel",n.startTimeMonth),e.xp6(1),e.Q6J("ngForOf",n.hoursRange),e.xp6(4),e.Q6J("ngModel",n.endTimeMonth),e.xp6(1),e.Q6J("ngForOf",n.filteredEndHoursMonth)}}function V(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"div",21)(1,"div",22),e._uU(2," Choisissez une plage de dates "),e.qZA(),e.TgZ(3,"div",23)(4,"div",24),e.YNc(5,U,2,1,"span",25),e.qZA(),e.TgZ(6,"div",26),e.YNc(7,K,3,2,"ng-container",27),e.qZA()(),e.TgZ(8,"div",28)(9,"div",29)(10,"div",30),e._uU(11," Date de d\xe9but "),e.qZA(),e.TgZ(12,"div",31),e._UZ(13,"img",18),e.TgZ(14,"input",32),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw();return e.KtG(o.firstDateSelectedFormat=i)}),e.qZA()()(),e.TgZ(15,"div",29)(16,"div",30),e._uU(17," Date de fin "),e.qZA(),e.TgZ(18,"div",31),e._UZ(19,"img",18),e.TgZ(20,"input",32),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw();return e.KtG(o.secondDateSelectedFormat=i)}),e.qZA()()()(),e.TgZ(21,"div",33)(22,"div",34)(23,"label",35)(24,"input",36),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw();return e.KtG(o.allHoursMonth=i)}),e.qZA(),e._UZ(25,"div",37),e.qZA()(),e.TgZ(26,"div",38),e._uU(27," Toute la journ\xe9e "),e.qZA()(),e.YNc(28,j,11,4,"ng-container",5),e.TgZ(29,"div",39),e._uU(30," Titre "),e.qZA(),e.TgZ(31,"div",31)(32,"input",40),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw();return e.KtG(o.nameBlockMonth=i)}),e.qZA()(),e.TgZ(33,"button",41),e.NdJ("click",function(){e.CHM(n);const i=e.oxw();return e.KtG(i.saveBlockMonth())}),e._uU(34," Sauvegarder "),e.qZA()()}if(2&a){const n=e.oxw();e.xp6(5),e.Q6J("ngForOf",n.weekdays),e.xp6(2),e.Q6J("ngForOf",n.days),e.xp6(7),e.Q6J("ngModel",n.firstDateSelectedFormat),e.xp6(6),e.Q6J("ngModel",n.secondDateSelectedFormat),e.xp6(4),e.Q6J("ngModel",n.allHoursMonth),e.xp6(4),e.Q6J("ngIf",!n.allHoursMonth),e.xp6(4),e.Q6J("ngModel",n.nameBlockMonth),e.xp6(1),e.Q6J("disabled",!n.isButtonMonthEnabled())}}function L(a,r){if(1&a&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.xp6(1),e.Oqu(n)}}function W(a,r){1&a&&e._UZ(0,"span",57)}function X(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"span",44),e.NdJ("click",function(){const o=e.CHM(n).$implicit,s=e.oxw(3);return e.KtG(s.selectDay(o))}),e.TgZ(2,"span",45)(3,"span",46),e._uU(4),e.qZA(),e.YNc(5,W,1,0,"span",56),e.qZA()(),e.BQk()}if(2&a){const n=r.$implicit;e.xp6(1),e.Q6J("ngClass",e.VKq(3,k,n.past)),e.xp6(3),e.Oqu(n.number),e.xp6(1),e.Q6J("ngIf",n.today)}}function ee(a,r){if(1&a&&(e.ynx(0),e.TgZ(1,"div",22),e._uU(2," Choisissez un jour "),e.qZA(),e.TgZ(3,"div",23)(4,"div",24),e.YNc(5,L,2,1,"span",25),e.qZA(),e.TgZ(6,"div",26),e.YNc(7,X,6,5,"ng-container",27),e.qZA()(),e.BQk()),2&a){const n=e.oxw(2);e.xp6(5),e.Q6J("ngForOf",n.weekdays),e.xp6(2),e.Q6J("ngForOf",n.days)}}function te(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function ne(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function ie(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",30),e._uU(2," Heure de d\xe9but "),e.qZA(),e.TgZ(3,"div",31)(4,"select",52),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(3);return e.KtG(o.startTimeDay=i)})("change",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.onStartTimeDayChange())}),e.YNc(5,te,2,2,"option",53),e.qZA()(),e.TgZ(6,"div",30),e._uU(7," Heure de fin "),e.qZA(),e.TgZ(8,"div",31)(9,"select",54),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(3);return e.KtG(o.endTimeDay=i)}),e.YNc(10,ne,2,2,"option",53),e.qZA()(),e.BQk()}if(2&a){const n=e.oxw(3);e.xp6(4),e.Q6J("ngModel",n.startTimeDay),e.xp6(1),e.Q6J("ngForOf",n.hoursRange),e.xp6(4),e.Q6J("ngModel",n.endTimeDay),e.xp6(1),e.Q6J("ngForOf",n.filteredEndHoursDay)}}function ae(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function oe(a,r){if(1&a&&(e.TgZ(0,"option",55),e._uU(1),e.qZA()),2&a){const n=r.$implicit;e.Q6J("value",n),e.xp6(1),e.Oqu(n)}}function re(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",28)(2,"div",29)(3,"div",30),e._uU(4," D\xe9but de division "),e.qZA(),e.TgZ(5,"div",31)(6,"select",52),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(4);return e.KtG(o.startTimeDivision=i)})("change",function(){e.CHM(n);const i=e.oxw(4);return e.KtG(i.onStartTimeDivisionChange())}),e.YNc(7,ae,2,2,"option",53),e.qZA()()(),e.TgZ(8,"div",29)(9,"div",30),e._uU(10," Fin de division "),e.qZA(),e.TgZ(11,"div",31)(12,"select",54),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(4);return e.KtG(o.endTimeDivision=i)}),e.YNc(13,oe,2,2,"option",53),e.qZA()()()(),e.BQk()}if(2&a){const n=e.oxw(4);e.xp6(6),e.Q6J("ngModel",n.startTimeDivision),e.xp6(1),e.Q6J("ngForOf",n.filteredStartHoursDivision),e.xp6(5),e.Q6J("ngModel",n.endTimeDivision),e.xp6(1),e.Q6J("ngForOf",n.filteredEndHoursDivision)}}function se(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",33)(2,"div",34)(3,"label",35)(4,"input",36),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(3);return e.KtG(o.divideDay=i)}),e.qZA(),e._UZ(5,"div",37),e.qZA()(),e.TgZ(6,"div",38),e._uU(7," Diviser "),e.qZA()(),e.YNc(8,re,14,4,"ng-container",5),e.BQk()}if(2&a){const n=e.oxw(3);e.xp6(4),e.Q6J("ngModel",n.divideDay),e.xp6(4),e.Q6J("ngIf",n.divideDay)}}function ce(a,r){if(1&a){const n=e.EpF();e.TgZ(0,"button",59),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(3);return e.KtG(i.deleteBlockDay())}),e._uU(1," \xc9liminer "),e.qZA()}}function le(a,r){if(1&a){const n=e.EpF();e.ynx(0),e.TgZ(1,"div",33)(2,"div",34)(3,"label",35)(4,"input",36),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(2);return e.KtG(o.allHoursDay=i)}),e.qZA(),e._UZ(5,"div",37),e.qZA()(),e.TgZ(6,"div",38),e._uU(7," Toute la journ\xe9e "),e.qZA()(),e.YNc(8,ie,11,4,"ng-container",5),e.TgZ(9,"div",39),e._uU(10," Titre "),e.qZA(),e.TgZ(11,"div",31)(12,"input",40),e.NdJ("ngModelChange",function(i){e.CHM(n);const o=e.oxw(2);return e.KtG(o.nameBlockDay=i)}),e.qZA()(),e.YNc(13,se,9,2,"ng-container",5),e.TgZ(14,"button",41),e.NdJ("click",function(){e.CHM(n);const i=e.oxw(2);return e.KtG(i.saveBlockDay())}),e._uU(15," Sauvegarder "),e.qZA(),e.YNc(16,ce,2,0,"button",58),e.BQk()}if(2&a){const n=e.oxw(2);e.xp6(4),e.Q6J("ngModel",n.allHoursDay),e.xp6(4),e.Q6J("ngIf",!n.allHoursDay),e.xp6(4),e.Q6J("ngModel",n.nameBlockDay),e.xp6(1),e.Q6J("ngIf",n.idEditBlock),e.xp6(1),e.Q6J("disabled",!n.isButtonDayEnabled()),e.xp6(2),e.Q6J("ngIf",n.idEditBlock)}}function de(a,r){if(1&a&&(e.TgZ(0,"div",21),e.YNc(1,ee,8,2,"ng-container",5),e.YNc(2,le,17,6,"ng-container",5),e.qZA()),2&a){const n=e.oxw();e.xp6(1),e.Q6J("ngIf",n.showDayCalendar),e.xp6(1),e.Q6J("ngIf",!n.showDayCalendar)}}const _e=[{path:"",component:(()=>{var a;class r{constructor(t,i,o,s,_,u){this.router=t,this.activatedRoute=i,this.monitorDataService=o,this.teachService=s,this.toastr=_,this.spinnerService=u,this.showMonthAvailable=!0,this.showDayAvailable=!1,this.today=new Date,this.monthNames=[],this.weekdays=["LUN","MAR","MER","JEU","VEN","SAM","DIM"],this.weekdaysShort=["L","M","X","J","V","S","D"],this.weekdayNames=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],this.days=[],this.hourStartDay="08:00",this.hourEndDay="18:00",this.hoursRange=[],this.firstDateSelected=null,this.secondDateSelected=null,this.firstDateSelectedFormat=null,this.secondDateSelectedFormat=null,this.showDayCalendar=!1,this.allHoursMonth=!1,this.allHoursDay=!1,this.divideDay=!1}ngOnInit(){var t=this;return(0,x.Z)(function*(){t.subscription=t.monitorDataService.getMonitorData().subscribe(function(){var i=(0,x.Z)(function*(o){o&&(t.monitorData=o,t.activatedRoute.params.subscribe(function(){var s=(0,x.Z)(function*(_){t.spinnerService.show(),t.typeVisual=_.type,t.dateVisual=_.date,t.idEditBlock=+_.id_edit,t.selectedDate=t.dateVisual?new Date(t.dateVisual):new Date,t.typeVisual&&("day"==t.typeVisual?(t.showMonthAvailable=!1,t.showDayAvailable=!0):(t.showMonthAvailable=!0,t.showDayAvailable=!1)),t.idEditBlock&&t.getEditBlock(),yield t.generateHoursRange(),t.initializeMonthNames(),t.currentMonth=t.selectedDate.getMonth(),t.currentYear=t.selectedDate.getFullYear(),t.currentDay=t.selectedDate.getDate(),t.renderCalendar()});return function(_){return s.apply(this,arguments)}}()))});return function(o){return i.apply(this,arguments)}}())})()}getEditBlock(){this.teachService.getData("monitor-nwds",this.idEditBlock).subscribe(t=>{console.log(t),this.editBlock=t.data,this.allHoursDay=this.editBlock.full_day,this.editBlock.start_time&&(this.startTimeDay=this.editBlock.start_time.substring(0,5)),this.editBlock.end_time&&(this.endTimeDay=this.editBlock.end_time.substring(0,5)),this.nameBlockDay=this.editBlock.description,this.allHoursDay=this.editBlock.full_day},t=>{console.error("There was an error!",t),this.idEditBlock=null})}generateHoursRange(){var t=this;return(0,x.Z)(function*(){const i=t.parseTime(t.hourStartDay),o=t.parseTime(t.hourEndDay);let s=new Date(i);for(;s<=o;)t.hoursRange.push(t.formatTime(s)),s=new Date(s.getTime()+9e5)})()}parseTime(t){const[i,o]=t.split(":").map(Number),s=new Date;return s.setHours(i,o,0,0),s}formatTime(t){return t.toTimeString().substring(0,5)}onStartTimeMonthChange(){const t=this.filteredEndHoursMonth;t.includes(this.endTimeMonth)||(this.endTimeMonth=t[0]||"")}get filteredEndHoursMonth(){const t=this.hoursRange.indexOf(this.startTimeMonth);return this.hoursRange.slice(t+1)}onStartTimeDayChange(){const t=this.filteredEndHoursDay;t.includes(this.endTimeDay)||(this.endTimeDay=t[0]||"")}get filteredEndHoursDay(){const t=this.hoursRange.indexOf(this.startTimeDay);return this.hoursRange.slice(t+1)}onStartTimeDivisionChange(){const t=this.filteredEndHoursDivision;t.includes(this.endTimeDivision)||(this.endTimeDivision=t[0]||"")}get filteredStartHoursDivision(){const t=this.hoursRange.indexOf(this.allHoursDay?this.hourStartDay:this.startTimeDay),i=this.hoursRange.indexOf(this.allHoursDay?this.hourEndDay:this.endTimeDay);return this.hoursRange.slice(t+1,i-1)}get filteredEndHoursDivision(){const t=this.calculateDefaultStartTimeDivisionIndex(),i=this.startTimeDivision?this.hoursRange.indexOf(this.startTimeDivision):t,o=this.hoursRange.indexOf(this.allHoursDay?this.hourEndDay:this.endTimeDay);return this.hoursRange.slice(i+1,o)}calculateDefaultStartTimeDivisionIndex(){return this.hoursRange.indexOf(this.allHoursDay?this.hourStartDay:this.startTimeDay)+1}initializeMonthNames(){this.monthNames=["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"]}previousMonth(){this.currentMonth--,this.currentMonth<0&&(this.currentMonth=11,this.currentYear--),this.renderCalendar()}nextMonth(){this.currentMonth++,this.currentMonth>11&&(this.currentMonth=0,this.currentYear++),this.renderCalendar()}previousDay(){this.selectedDate.setDate(this.selectedDate.getDate()-1),this.currentMonth=this.selectedDate.getMonth(),this.currentYear=this.selectedDate.getFullYear(),this.currentDay=this.selectedDate.getDate(),this.renderCalendar()}nextDay(){this.selectedDate.setDate(this.selectedDate.getDate()+1),this.currentMonth=this.selectedDate.getMonth(),this.currentYear=this.selectedDate.getFullYear(),this.currentDay=this.selectedDate.getDate(),this.renderCalendar()}renderCalendar(){this.spinnerService.show();const t=new Date(this.currentYear,this.currentMonth,1).getDay(),i=new Date(this.currentYear,this.currentMonth+1,0).getDate();this.days=[];let o=t-1;o<0&&(o=6);for(let l=0;l<o;l++)this.days.push({number:null,active:!1});const s=new Date;s.setHours(0,0,0,0);const _=s.getDate(),u=s.getMonth(),d=s.getFullYear();for(let l=1;l<=i;l++){const p=new Date(this.currentYear,this.currentMonth,l);p.setHours(0,0,0,0),this.days.push({number:l,selected:!1,past:p<s,today:l===_&&this.currentMonth===u&&this.currentYear===d,activeSelected:!1,activeRange:!1})}let c=new Date(this.currentYear,this.currentMonth,i).getDay();for(let l=c;l<=6&&6!==c;l++)this.days.push({number:null,selected:!1});this.applyRange(),this.spinnerService.hide()}getWeekdayName(t){return this.weekdayNames[t.getDay()]}selectDate(t){if(t.past)return;const i=new Date(this.currentYear,this.currentMonth,t.number);!this.firstDateSelected||this.secondDateSelected&&this.firstDateSelected?(this.resetSelection(),this.firstDateSelected=i,console.log(i),this.firstDateSelectedFormat=this.formatDate(i),t.activeSelected=!0):i<this.firstDateSelected?(this.resetSelection(),this.firstDateSelected=i,this.firstDateSelectedFormat=this.formatDate(i),t.activeSelected=!0):(this.secondDateSelected=i,this.secondDateSelectedFormat=this.formatDate(i),this.applyRange())}formatDate(t){return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`}applyRange(){!this.firstDateSelected||!this.secondDateSelected||this.days.forEach(t=>{if(null!==t.number){const i=new Date(this.currentYear,this.currentMonth,t.number);t.activeRange=i>=this.firstDateSelected&&i<=this.secondDateSelected,t.activeSelected=i.getTime()===this.firstDateSelected.getTime()||i.getTime()===this.secondDateSelected.getTime()}else t.activeSelected=!1,t.activeRange=!1})}resetSelection(){this.days.forEach(t=>{t.activeSelected=!1,t.activeRange=!1}),this.firstDateSelected=null,this.secondDateSelected=null,this.firstDateSelectedFormat=null,this.secondDateSelectedFormat=null}selectDay(t){t.number&&!t.past&&(this.selectedDate=new Date(this.currentYear,this.currentMonth,t.number),this.currentDay=t.number,this.showDayCalendar=!1)}isButtonMonthEnabled(){return this.nameBlockMonth&&this.firstDateSelected&&this.secondDateSelected&&(this.allHoursMonth||this.startTimeMonth&&this.endTimeMonth)}isButtonDayEnabled(){return this.divideDay?this.nameBlockDay&&this.selectedDate&&this.startTimeDivision&&this.endTimeDivision&&(this.allHoursDay||this.startTimeDay&&this.endTimeDay):this.nameBlockDay&&this.selectedDate&&(this.allHoursDay||this.startTimeDay&&this.endTimeDay)}saveBlockDay(){const t=g(this.selectedDate).format("YYYY-MM-DD");if(this.spinnerService.show(),this.idEditBlock){const i={monitor_id:this.monitorData.id,school_id:this.monitorData.active_school,station_id:this.monitorData.active_station,description:this.nameBlockDay,color:"#89add1",user_nwd_subtype_id:1};let s,o={...i,start_date:t,end_date:t};o.start_time=this.allHoursDay?`${this.hourStartDay}:00`:`${this.startTimeDay}:00`,o.end_time=this.divideDay?`${this.startTimeDivision}:00`:this.allHoursDay?`${this.hourEndDay}:00`:`${this.endTimeDay}:00`,o.full_day=this.allHoursDay&&!this.divideDay;let _=g(`${t} ${o.start_time}`,"YYYY-MM-DD HH:mm:ss"),u=g(`${t} ${o.end_time}`,"YYYY-MM-DD HH:mm:ss");const d=()=>{this.teachService.updateData("monitor-nwds",this.idEditBlock,o).subscribe(c=>{console.log("First block updated:",c),this.spinnerService.hide(),this.toastr.success("Enregistr\xe9 correctement"),this.goTo("calendar")},c=>{console.error("Error updating first block:",c),this.spinnerService.hide(),this.toastr.error("Erreur")})};this.checkOverlap(_,u,t,this.idEditBlock).then(c=>{if(c)return this.spinnerService.hide(),void this.toastr.error("Un chevauchement a \xe9t\xe9 d\xe9tect\xe9. Le blocage n'a pas \xe9t\xe9 cr\xe9\xe9.");if(this.divideDay){s={...i,start_date:t,end_date:t,start_time:`${this.endTimeDivision}:00`,end_time:`${this.endTimeDay}:00`,full_day:!1};let l=g(`${t} ${s.start_time}`,"YYYY-MM-DD HH:mm:ss"),p=g(`${t} ${s.end_time}`,"YYYY-MM-DD HH:mm:ss");this.checkOverlap(l,p,t,this.idEditBlock).then(m=>{if(m)return this.spinnerService.hide(),void this.toastr.error("Un chevauchement a \xe9t\xe9 d\xe9tect\xe9. Le blocage n'a pas \xe9t\xe9 cr\xe9\xe9.");this.teachService.postData("monitor-nwds",s).subscribe(f=>{console.log("Second block created:",f),d()},f=>{console.error("Error creating second block:",f),this.spinnerService.hide(),this.toastr.error("Erreur")})}).catch(m=>{console.error("Error checking overlap for second block:",m),this.spinnerService.hide(),this.toastr.error("Erreur")})}else d()}).catch(c=>{console.error("Error checking overlap for first block:",c),this.spinnerService.hide(),this.toastr.error("Erreur")})}else{const i={monitor_id:this.monitorData.id,school_id:this.monitorData.active_school,station_id:this.monitorData.active_station,start_date:t,end_date:t,start_time:this.allHoursDay?`${this.hourStartDay}:00`:`${this.startTimeDay}:00`,end_time:this.allHoursDay?`${this.hourEndDay}:00`:`${this.endTimeDay}:00`,full_day:this.allHoursDay,description:this.nameBlockDay,color:"#89add1",user_nwd_subtype_id:1},s=this.allHoursDay?this.hourEndDay:this.endTimeDay,_=g(`${t} ${this.allHoursDay?this.hourStartDay:this.startTimeDay}:00`,"YYYY-MM-DD HH:mm:ss"),u=g(`${t} ${s}:00`,"YYYY-MM-DD HH:mm:ss");this.checkOverlap(_,u,t).then(d=>{d?(this.spinnerService.hide(),this.toastr.error("Un chevauchement a \xe9t\xe9 d\xe9tect\xe9. Le blocage n'a pas \xe9t\xe9 cr\xe9\xe9.")):this.teachService.postData("monitor-nwds",i).subscribe(c=>{console.log("Response:",c),this.spinnerService.hide(),this.toastr.success("Enregistr\xe9 correctement"),this.goTo("calendar")},c=>{console.error("Error:",c),this.spinnerService.hide(),this.toastr.error("Erreur")})}).catch(d=>{console.error("Overlap check error:",d),this.spinnerService.hide(),this.toastr.error("Erreur lors de la v\xe9rification des chevauchements")})}}saveBlockMonth(){var t=this;const i=g(this.firstDateSelected),o=g(this.secondDateSelected),s=[],_=[];this.spinnerService.show();for(let d=g(i);d.diff(o,"days")<=0;d.add(1,"days"))s.push(g(d));Promise.all(s.map(function(){var d=(0,x.Z)(function*(c){const l=c.format("YYYY-MM-DD"),p=g(`${l} ${t.allHoursMonth?t.hourStartDay:t.startTimeMonth}:00`,"YYYY-MM-DD HH:mm:ss"),m=g(`${l} ${t.allHoursMonth?t.hourEndDay:t.endTimeMonth}:00`,"YYYY-MM-DD HH:mm:ss");return t.checkOverlap(p,m,l).then(f=>{if(f){const y=g(l).format("DD-MM-YYYY");return _.push(y),null}{const y={monitor_id:t.monitorData.id,school_id:t.monitorData.active_school,station_id:t.monitorData.active_station,start_date:l,end_date:l,start_time:t.allHoursMonth?`${t.hourStartDay}:00`:`${t.startTimeMonth}:00`,end_time:t.allHoursMonth?`${t.hourEndDay}:00`:`${t.endTimeMonth}:00`,full_day:t.allHoursMonth,description:t.nameBlockMonth,color:"#89add1",user_nwd_subtype_id:1};return new Promise((ue,pe)=>{t.teachService.postData("monitor-nwds",y).subscribe(D=>{console.log("Data posted successfully:",D),ue(D)},D=>{console.error("Error posting data:",D),pe(D)})})}}).catch(f=>(console.error("Error checking overlap:",f),_.push(l),null))});return function(c){return d.apply(this,arguments)}}())).then(d=>{this.spinnerService.hide();const c=d.filter(l=>null!=l);c.length>0&&this.toastr.success(_.length>0?"Certains blocages ont \xe9t\xe9 enregistr\xe9s correctement":"Enregistr\xe9 correctement"),_.length>0?this.toastr.error(`Un chevauchement a \xe9t\xe9 d\xe9tect\xe9. Les dates suivantes n'ont pas \xe9t\xe9 cr\xe9\xe9es : ${_.join(", ")}`):0===c.length&&this.toastr.error("Un chevauchement a \xe9t\xe9 d\xe9tect\xe9. Le blocage n'a pas \xe9t\xe9 cr\xe9\xe9."),this.goTo("calendar")}).catch(d=>{console.error("An error occurred:",d),this.spinnerService.hide(),this.toastr.error("Erreur")})}checkOverlap(t,i,o,s){return new Promise((_,u)=>{this.teachService.getData("teach/getAgenda",null,{date_start:o,date_end:o,school_id:this.monitorData.active_school}).subscribe(d=>{for(const c of d.data.bookings){const l=g(`${o} ${c.hour_start}`,"YYYY-MM-DD HH:mm:ss"),p=g(`${o} ${c.hour_end}`,"YYYY-MM-DD HH:mm:ss");if(l.isBefore(i)&&p.isAfter(t))return console.log(c),void _(!0)}for(const c of d.data.nwd){let l=!1;if(s&&c.id==s&&(l=!0),!s||!l){if(c.full_day)return void _(!0);{const p=g(`${o} ${c.start_time}`,"YYYY-MM-DD HH:mm:ss"),m=g(`${o} ${c.end_time}`,"YYYY-MM-DD HH:mm:ss");if(p.isBefore(i)&&m.isAfter(t))return console.log(c),void _(!0)}}}_(!1)},d=>{console.error("Error in checkOverlap:",d),u(d)})})}deleteBlockDay(){this.idEditBlock&&confirm("\xcates-vous s\xfbr de vouloir supprimer le blocage?")&&(this.spinnerService.show(),this.teachService.deleteData("monitor-nwds",this.idEditBlock).subscribe(i=>{console.log("Response:",i),this.spinnerService.hide(),this.toastr.success("Supprim\xe9 correctement"),this.goTo("calendar")},i=>{console.error("Error:",i),this.spinnerService.hide(),this.toastr.error("Erreur")}))}goTo(...t){this.router.navigate(t)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(a=r).\u0275fac=function(t){return new(t||a)(e.Y36(M.F0),e.Y36(M.gz),e.Y36(w.q),e.Y36(Z.b),e.Y36(P._W),e.Y36(Y.V))},a.\u0275cmp=e.Xpm({type:a,selectors:[["app-calendar-available"]],decls:14,vars:8,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-section-content",3,"ngClass"],["src","assets/icon/arrow-left.svg",1,"cursor-pointer","header-content-icon",3,"click"],[1,"header-section-title"],[4,"ngIf"],["src","assets/icon/icon-clock.png",1,"header-section-menu"],["class","mt-24 mb-32 flex-buttons",4,"ngIf"],["class","flex-members",4,"ngIf"],["class","padding-wrapper",4,"ngIf"],[1,"mt-24","mb-32","flex-buttons"],[1,"montserrat","flex-buttons-button","cursor-pointer",3,"ngClass","click"],[1,"flex-members"],[1,"box-arrow","cursor-pointer",3,"click"],["src","assets/icon/arrow-left.svg"],[1,"montserrat","month-title"],["src","assets/icon/icons-outline-arrow-right-3-white.svg"],[1,"mt-12","flex-select-date","cursor-pointer",3,"click"],["src","assets/icon/icons-outline-calendar-1-white.svg"],["class","montserrat",4,"ngIf"],[1,"montserrat"],[1,"padding-wrapper"],[1,"mb-24","montserrat","align-center"],[1,"calendar","mb-24","background-color-dark"],[1,"weekdays"],["class","montserrat",4,"ngFor","ngForOf"],[1,"days"],[4,"ngFor","ngForOf"],[1,"inputs-flex"],[1,"flex-1"],[1,"input-label","color-light","montserrat"],[1,"input-form-icon","background-color-dark"],["type","text","disabled","true",1,"montserrat",3,"ngModel","ngModelChange"],[1,"circle-list-item","mb-24"],[1,"custom-radio"],[1,"simple-check-option"],["type","checkbox",3,"ngModel","ngModelChange"],[1,"custom-check"],[1,"montserrat","color-light","circle-list-item-text"],[1,"input-label","color-light","montserrat","mt-24"],["type","text",1,"montserrat",3,"ngModel","ngModelChange"],[1,"content-button","btn-back-primary","montserrat","mb-32","mt-32",3,"disabled","click"],["class","montserrat day-span-a",3,"ngClass","click",4,"ngIf"],["class","montserrat day-span-a",4,"ngIf"],[1,"montserrat","day-span-a",3,"ngClass","click"],[1,"day-span-b","cursor-pointer","position-relative"],[1,"day-on-top"],["class","active-selected",4,"ngIf"],["class","active-range",4,"ngIf"],[1,"active-selected"],[1,"active-range"],[1,"montserrat","day-span-a"],[1,"montserrat",3,"ngModel","ngModelChange","change"],[3,"value",4,"ngFor","ngForOf"],[1,"montserrat",3,"ngModel","ngModelChange"],[3,"value"],["class","active-today",4,"ngIf"],[1,"active-today"],["class","content-button reduce-top btn-back-grey montserrat mb-32",3,"click",4,"ngIf"],[1,"content-button","reduce-top","btn-back-grey","montserrat","mb-32",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),e.NdJ("click",function(){return i.goTo("calendar")}),e.qZA(),e.TgZ(5,"div",4),e.YNc(6,O,2,0,"div",5),e.YNc(7,S,2,0,"div",5),e.qZA(),e._UZ(8,"img",6),e.qZA(),e.YNc(9,H,5,8,"div",7),e.YNc(10,E,7,2,"div",8),e.YNc(11,Q,7,4,"ng-container",5),e.qZA(),e.YNc(12,V,35,8,"div",9),e.YNc(13,de,3,2,"div",9),e.qZA()()),2&t&&(e.xp6(3),e.Q6J("ngClass",i.idEditBlock?"mb-32":"mb-12"),e.xp6(3),e.Q6J("ngIf",!i.idEditBlock),e.xp6(1),e.Q6J("ngIf",i.idEditBlock),e.xp6(2),e.Q6J("ngIf",!i.idEditBlock),e.xp6(1),e.Q6J("ngIf",i.showMonthAvailable),e.xp6(1),e.Q6J("ngIf",i.showDayAvailable),e.xp6(1),e.Q6J("ngIf",i.showMonthAvailable),e.xp6(1),e.Q6J("ngIf",i.showDayAvailable))},dependencies:[b.mk,b.sg,b.O5,v.YN,v.Kr,v.Fj,v.Wl,v.EJ,v.JJ,v.On,T.W2],styles:['.content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-section-content[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-content-icon[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:16px;font-weight:600}.header-section-menu[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:22px;display:flex;align-items:center;justify-content:center}.month-title[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:500}.flex-members[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;justify-content:space-between}.box-arrow[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:#2b303b}.box-arrow[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:22px}.filter-floating[_ngcontent-%COMP%]{width:54px;position:fixed;right:12px;bottom:102px;cursor:pointer}.button-floating[_ngcontent-%COMP%]{position:fixed;right:12px;bottom:102px;cursor:pointer;display:flex;align-items:center;justify-content:center;padding:12px 24px;border-radius:40px;width:-moz-fit-content;width:fit-content;font-weight:600;font-size:14px}.flex-buttons[_ngcontent-%COMP%]{display:flex;width:100%;align-items:center;gap:4px}.flex-buttons-button[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-size:14px;width:100%;padding:6px 0;border-radius:4px}.input-label[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.input-form-icon[_ngcontent-%COMP%]{width:100%;height:48px;border-radius:12px;color:#fff;padding:0 16px;display:flex;align-items:center;gap:9px;margin-bottom:24px}.input-form-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px;position:relative;top:-1px}.input-form-icon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:15px;width:100%;border:none;background:transparent;outline:0}.inputs-flex[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.calendar[_ngcontent-%COMP%]{color:#fff;width:100%;box-sizing:border-box;padding:16px;border-radius:8px}.header-calendar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}.header-calendar[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:18px;font-weight:500}.header-calendar-arrows[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.header-calendar-arrows[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{cursor:pointer;width:24px}.weekdays[_ngcontent-%COMP%], .days[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between}.weekdays[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1 0 calc(14.28% - 6px);height:40px;line-height:4px;text-align:center;margin:3px;font-size:11px;box-sizing:border-box}.days[_ngcontent-%COMP%]   .day-span-a[_ngcontent-%COMP%]{flex:1 0 calc(14.28% - 6px);height:40px;line-height:40px;text-align:center;margin:3px;font-size:16px!important;font-weight:500;box-sizing:border-box}.days[_ngcontent-%COMP%]   .day-span-b[_ngcontent-%COMP%]{display:flex;justify-content:center;width:32px;height:32px;align-items:center}.light-opacity[_ngcontent-%COMP%]{opacity:.6}.very-light-opacity[_ngcontent-%COMP%]{opacity:.4}.day-on-top[_ngcontent-%COMP%]{z-index:2}.active-selected[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:28px;background:var(--ion-color-primary);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:0}.active-range[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:28px;background:rgba(51,153,255,.5);position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:0}.align-center[_ngcontent-%COMP%]{text-align:center}.flex-select-date[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;justify-content:center}.flex-select-date[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.flex-select-date[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px}.circle-list-item[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.circle-list-item-text[_ngcontent-%COMP%]{font-size:13px}.custom-radio[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px}.simple-check-option[_ngcontent-%COMP%]{position:relative;display:inline-block;cursor:pointer;width:22px;height:22px}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{display:none}.custom-check[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:22px;height:22px;background:transparent;border:1px solid #c8c8c8;border-radius:6px;display:block;align-items:center;justify-content:center}.custom-check[_ngcontent-%COMP%]:before{content:"";width:5px;height:10px;border:solid white;border-width:0 2px 2px 0;transform:rotate(45deg);position:absolute;top:4px;left:8px;display:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]{background:var(--ion-color-primary);border:none}.simple-check-option[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + .custom-check[_ngcontent-%COMP%]:before{display:block}.flex-1[_ngcontent-%COMP%]{flex:1}.reduce-top[_ngcontent-%COMP%]{margin-top:-16px}button[disabled][_ngcontent-%COMP%]{opacity:.4;pointer-events:none}']}),r})()}];let ge=(()=>{var a;class r{}return(a=r).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[M.Bz.forChild(_e),M.Bz]}),r})(),he=(()=>{var a;class r{}return(a=r).\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[b.ez,v.u5,T.Pc,ge]}),r})()}}]);