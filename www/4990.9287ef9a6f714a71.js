"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4990],{4990:(G,M,s)=>{s.r(M),s.d(M,{StatsPageModule:()=>z});var f=s(177),$=s(9417),P=s(8974),D=s(3314),y=s(467),b=s(9403),m=s(7586),t=s(6996),j=s(5663),N=s(918),T=s(4387),A=s(5794),U=s(8551),v=s(1547);const I=function(o){return{"color-selected":o}};function H(o,h){if(1&o&&(t.j41(0,"div",27)(1,"div",28)(2,"div",29),t.EFF(3),t.k0s(),t.j41(4,"span",29),t.EFF(5),t.k0s()(),t.j41(6,"div",24),t.EFF(7),t.k0s(),t.j41(8,"div",24),t.EFF(9),t.k0s(),t.j41(10,"div",24),t.EFF(11),t.k0s()()),2&o){const c=h.$implicit,a=h.index,e=t.XpG();t.R7$(2),t.Y8G("ngClass",t.eq3(7,I,a>=e.currentEndIndex&&a<e.currentStartIndex)),t.R7$(1),t.JRh(c.name),t.R7$(1),t.Y8G("ngClass",t.eq3(9,I,a>=e.currentEndIndex&&a<e.currentStartIndex)),t.R7$(1),t.JRh(c.year),t.R7$(2),t.SpI(" ",c.collectiveCourses," "),t.R7$(2),t.SpI(" ",c.privateCourses," "),t.R7$(2),t.SpI(" ",c.blockPayed," ")}}const B=[{path:"",component:(()=>{var o;class h{constructor(a,e,i,d,p,u,r){this.router=a,this.monitorDataService=e,this.sharedDataService=i,this.teachService=d,this.toastr=p,this.spinnerService=u,this.translate=r,this.lineChartData={datasets:[{data:[80,72,39,37,35,31,36,46,39,37,35,31],label:"Heures",yAxisID:"y",backgroundColor:"rgba(51,153,255,0.4)",borderColor:"rgba(51,153,255,1)",pointBackgroundColor:"rgba(51,153,255,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(51,153,255,0.8)",fill:"origin"}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.lineChartOptions={elements:{line:{tension:.3}},scales:{y:{beginAtZero:!0,position:"left",min:0,grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"#c8c8c8"}},x:{ticks:{color:"#c8c8c8"},grid:{display:!1}}},plugins:{legend:{display:!0}}},this.lineChartType="line",this.selectedYear="year",this.currentStartIndex=3,this.currentEndIndex=0,this.hourStartDay="08:00",this.hourEndDay="18:00"}ngOnInit(){var a=this;return(0,y.A)(function*(){a.subscription=a.monitorDataService.getMonitorData().subscribe(function(){var e=(0,y.A)(function*(i){i&&(a.spinnerService.show(),a.monitorData=i,a.loadBookings(),a.spinnerService.hide())});return function(i){return e.apply(this,arguments)}}())})()}loadBookings(){const e=this.initializeMonthsData()[0],p={date_start:m(`${e.year}-${e.name}-01`,"YYYY-MMM-DD").startOf("month").format("YYYY-MM-DD"),date_end:m().format("YYYY-MM-DD")};this.monitorData.active_school&&(p.school_id=this.monitorData.active_school),this.teachService.getData("teach/getAgenda",null,p).subscribe(u=>{this.monthsData=this.initializeMonthsData();let k={totalDuration:0},x={totalDuration:0},O={totalDuration:0},F={totalDuration:0},S={totalDuration:0};u.data.bookings.forEach(n=>{const C=m(n.date).format("MMM YYYY").toUpperCase(),g=this.monthsData.find(l=>`${l.name} ${l.year}`===C);if(g){const l=this.calculateDuration(n.hour_start,n.hour_end);1===n.course.course_type?g.collectiveCourses+=l:2===n.course.course_type&&(g.privateCourses+=l)}}),u.data.nwd.forEach(n=>{const C=m(n.start_date).format("MMM YYYY").toUpperCase(),g=this.monthsData.find(l=>`${l.name} ${l.year}`===C);if(g){let l;l=n.full_day?this.calculateDuration(this.hourStartDay,this.hourEndDay):this.calculateDuration(n.start_time,n.end_time),1===n.user_nwd_subtype_id?g.blockNwd+=l:2===n.user_nwd_subtype_id?g.blockPayed+=l:3===n.user_nwd_subtype_id&&(g.blockNotPayed+=l)}}),k.totalDuration=this.formatDuration(k.totalDuration),x.totalDuration=this.formatDuration(x.totalDuration),F.totalDuration=this.formatDuration(F.totalDuration),O.totalDuration=this.formatDuration(O.totalDuration),S.totalDuration=this.formatDuration(S.totalDuration),Object.keys(this.monthsData).forEach(n=>{this.monthsData[n].collectiveCourses=this.formatDuration(this.monthsData[n].collectiveCourses),this.monthsData[n].privateCourses=this.formatDuration(this.monthsData[n].privateCourses),this.monthsData[n].blockNwd=this.formatDuration(this.monthsData[n].blockNwd),this.monthsData[n].blockPayed=this.formatDuration(this.monthsData[n].blockPayed),this.monthsData[n].blockNotPayed=this.formatDuration(this.monthsData[n].blockNotPayed)}),this.monthsData.map(n=>this.durationInHours(n.collectiveCourses)),this.monthsData.map(n=>this.durationInHours(n.privateCourses)),this.monthsData.map(n=>this.durationInHours(n.blockNwd)),this.monthsData.map(n=>this.durationInHours(n.blockPayed)),this.monthsData.map(n=>this.durationInHours(n.blockNotPayed));let _=0,E=0,w=0,R=0,Y=0;this.monthsData.forEach(n=>{_+=this.hoursToMinutes(this.durationInHours(n.collectiveCourses)),E+=this.hoursToMinutes(this.durationInHours(n.privateCourses)),w+=this.hoursToMinutes(this.durationInHours(n.blockNwd)),R+=this.hoursToMinutes(this.durationInHours(n.blockPayed)),Y+=this.hoursToMinutes(this.durationInHours(n.blockNotPayed))}),this.totalCollectiveDurationFormatted=this.formatDuration(_),this.totalPrivateDurationFormatted=this.formatDuration(E),this.totalNwdDurationFormatted=this.formatDuration(w),this.totalPayedDurationFormatted=this.formatDuration(R),this.totalNotPayedDurationFormatted=this.formatDuration(Y),this.reversedMonthsData=this.monthsData.slice().reverse(),this.updateChartData()},u=>{this.spinnerService.hide(),console.error("There was an error!",u)})}hoursToMinutes(a){return 60*a}durationInHours(a){const[e,i]=a.split("h").map(d=>parseInt(d,10));return e+i/60}changeMonths(a){this.currentEndIndex+a>=0&&this.currentStartIndex+a<=24&&(this.currentStartIndex+=a,this.currentEndIndex+=a,this.updateChartData())}updateChartData(){const a=this.monthsData.length-this.currentStartIndex,e=this.monthsData.length-this.currentEndIndex,i=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.collectiveCourses)),d=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.privateCourses)),p=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.blockPayed)),u=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.collectiveCourses)+this.durationInHours(r.privateCourses)+this.durationInHours(r.blockPayed));this.lineChartData.datasets=[{data:i,label:this.translate.instant("collective_courses"),yAxisID:"y",borderColor:"rgba(252,196,47,1)"},{data:d,label:this.translate.instant("private_courses"),yAxisID:"y",borderColor:"rgba(56,199,77,1)"},{data:p,label:this.translate.instant("paid_blocks"),yAxisID:"y",borderColor:"rgba(100,100,100,1)"},{data:u,label:this.translate.instant("total"),yAxisID:"y",borderColor:"rgba(51,153,255,1)"}],this.lineChartData.labels=this.monthsData.slice(a,e).map(r=>r.name),this.chart&&this.chart.update()}navigateToPreviousMonths(){this.currentStartIndex>0&&(this.currentStartIndex-=3,this.currentEndIndex-=3,this.updateChartData())}navigateToNextMonths(){this.currentEndIndex<this.monthsData.length&&(this.currentStartIndex+=3,this.currentEndIndex+=3,this.updateChartData())}initializeMonthsData(){const a=[];let e=m();for(let i=0;i<24;i++){const d=e.format("MMM YYYY").toUpperCase();a.unshift({name:d.split(" ")[0],year:d.split(" ")[1],collectiveCourses:0,privateCourses:0,blockNwd:0,blockPayed:0,blockNotPayed:0}),e.subtract(1,"months")}return a}calculateDuration(a,e){const[i,d]=a.split(":").map(Number),[p,u]=e.split(":").map(Number);return 60*(p-i)+(u-d)}formatDuration(a){return`${Math.floor(a/60)}h${a%60}m`}updateChartDataB(){this.lineChartData="all"===this.selectedYear?{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31,80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC","JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]}:{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.chart&&this.chart.update()}goTo(...a){this.router.navigate(a)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(o=h).\u0275fac=function(a){return new(a||o)(t.rXU(D.Ix),t.rXU(j.O),t.rXU(N.H),t.rXU(T.R),t.rXU(A.tw),t.rXU(U.D),t.rXU(v.c$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-stats"]],viewQuery:function(a,e){if(1&a&&t.GBs(b.j9,5),2&a){let i;t.mGM(i=t.lsd())&&(e.chart=i.first)}},decls:61,vars:37,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-top"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/statistiques.png"],[1,"background-color-dark","padding-wrapper","mt-24","mb-24"],[1,"stats-titles","mb-24"],[1,"input-form-icon-b","background-grey-translucent"],[1,"montserrat"],[1,"stats-icons"],["src","assets/icon/icons-outline-arrow-left-2.svg",1,"cursor-pointer",3,"click"],["src","assets/icon/icons-outline-arrow-right-3-white.svg",1,"cursor-pointer",3,"click"],[1,"chart-scroll-wrapper"],["baseChart","",1,"chart-container",3,"data","options","type"],[1,"padding-wrapper"],[1,"cursor-pointer","menu-section-content","mb-12"],[1,"menu-section-title"],[1,"table-line","no-border","padding-wrapper","pb-8"],[1,"width-big"],[1,"width-small"],[1,"background-color-dark","padding-wrapper","table-wrapper"],[1,"table-line","table-line-total","pb-8","mb-8"],[1,"width-big","uppercase"],[1,"montserrat","width-small"],["class","table-line pb-8 mb-8",4,"ngFor","ngForOf"],[1,"table-line","table-line-total","pb-8","no-border"],[1,"table-line","pb-8","mb-8"],[1,"montserrat","width-big","table-line-text"],[3,"ngClass"]],template:function(a,e){1&a&&(t.j41(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),t.bIt("click",function(){return e.goTo("home")}),t.k0s(),t.j41(5,"div",4),t.nrm(6,"img",5),t.j41(7,"div"),t.EFF(8),t.nI1(9,"translate"),t.k0s()()()(),t.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.j41(16,"div",10)(17,"img",11),t.bIt("click",function(){return e.changeMonths(3)}),t.k0s(),t.j41(18,"img",12),t.bIt("click",function(){return e.changeMonths(-3)}),t.k0s()()(),t.j41(19,"div",13),t.nrm(20,"canvas",14),t.k0s()(),t.j41(21,"div",15)(22,"div",16)(23,"div",17),t.EFF(24),t.nI1(25,"translate"),t.k0s()(),t.j41(26,"div",18)(27,"div",19),t.EFF(28),t.nI1(29,"translate"),t.k0s(),t.j41(30,"div",20),t.EFF(31),t.nI1(32,"translate"),t.k0s(),t.j41(33,"div",20),t.EFF(34),t.nI1(35,"translate"),t.k0s(),t.j41(36,"div",20),t.EFF(37),t.nI1(38,"translate"),t.k0s()(),t.j41(39,"div",21)(40,"div",22)(41,"div",23),t.EFF(42),t.nI1(43,"translate"),t.k0s(),t.j41(44,"div",24),t.EFF(45),t.k0s(),t.j41(46,"div",24),t.EFF(47),t.k0s(),t.j41(48,"div",24),t.EFF(49),t.k0s()(),t.DNE(50,H,12,11,"div",25),t.j41(51,"div",26)(52,"div",23),t.EFF(53),t.nI1(54,"translate"),t.k0s(),t.j41(55,"div",24),t.EFF(56),t.k0s(),t.j41(57,"div",24),t.EFF(58),t.k0s(),t.j41(59,"div",24),t.EFF(60),t.k0s()()()()()()),2&a&&(t.R7$(8),t.JRh(t.bMT(9,19,"statistics")),t.R7$(6),t.SpI(" ",t.bMT(15,21,"total_hours")," "),t.R7$(6),t.Y8G("data",e.lineChartData)("options",e.lineChartOptions)("type",e.lineChartType),t.R7$(4),t.JRh(t.bMT(25,23,"activity_report")),t.R7$(4),t.SpI(" ",t.bMT(29,25,"month")," "),t.R7$(3),t.SpI(" ",t.bMT(32,27,"collective")," "),t.R7$(3),t.SpI(" ",t.bMT(35,29,"private")," "),t.R7$(3),t.SpI(" ",t.bMT(38,31,"block_paid_abbrev")," "),t.R7$(5),t.SpI(" ",t.bMT(43,33,"total")," "),t.R7$(3),t.SpI(" ",e.totalCollectiveDurationFormatted," "),t.R7$(2),t.SpI(" ",e.totalPrivateDurationFormatted," "),t.R7$(2),t.SpI(" ",e.totalPayedDurationFormatted," "),t.R7$(1),t.Y8G("ngForOf",e.reversedMonthsData),t.R7$(3),t.SpI(" ",t.bMT(54,35,"total")," "),t.R7$(3),t.SpI(" ",e.totalCollectiveDurationFormatted," "),t.R7$(2),t.SpI(" ",e.totalPrivateDurationFormatted," "),t.R7$(2),t.SpI(" ",e.totalPayedDurationFormatted," "))},dependencies:[f.YU,f.Sq,P.W9,b.j9,v.D9],styles:[".content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-side-img-b[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:20px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.menu-section-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.menu-section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.menu-section-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-primary);padding:5px 8px;border-radius:40px;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center}.menu-section-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.menu-section-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.menu-section-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.table-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;border-radius:8px}.table-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;border-bottom:1px solid #444953}.table-line-total[_ngcontent-%COMP%]{font-weight:500}.table-line[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;color:#fff}.table-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.table-line-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.width-big[_ngcontent-%COMP%]{width:40%}.width-small[_ngcontent-%COMP%]{width:30%}.no-border[_ngcontent-%COMP%]{border:none!important}.input-form-icon-b[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:36px;border-radius:12px;color:#fff;padding:0 12px;display:flex;align-items:center;gap:9px}.input-form-icon-b[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon-b[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:100%;border:none;background:transparent;outline:0}.background-grey-translucent[_ngcontent-%COMP%]{background:rgba(65,69,78,.4)}.margin-auto[_ngcontent-%COMP%]{margin:auto}.remove-bottom[_ngcontent-%COMP%]{margin-bottom:-12px!important}.stats-titles[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-between;align-items:center}.stats-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.stats-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px}.color-selected[_ngcontent-%COMP%]{color:var(--ion-color-primary)!important}.chart-container[_ngcontent-%COMP%]{display:block;width:100%!important}"]}),h})()}];let J=(()=>{var o;class h{}return(o=h).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[D.iI.forChild(B),D.iI]}),h})(),z=(()=>{var o;class h{}return(o=h).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[f.MD,$.YN,P.bv,J,b.FR,v.h]}),h})()}}]);