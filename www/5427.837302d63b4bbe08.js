(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5427],{5961:(j,L,H)=>{"use strict";H.d(L,{GW:()=>t,dk:()=>C,oK:()=>W});var W=function(F){return F.Prompt="PROMPT",F.Camera="CAMERA",F.Photos="PHOTOS",F}(W||{}),t=function(F){return F.Rear="REAR",F.Front="FRONT",F}(t||{}),C=function(F){return F.Uri="uri",F.Base64="base64",F.DataUrl="dataUrl",F}(C||{})},1211:(j,L,H)=>{"use strict";H.d(L,{Y:()=>d});var W=H(5861),t=H(2029),C=H(2726),F=H(5961);const w=(0,C.fo)("Camera",{web:()=>H.e(6468).then(H.bind(H,6468)).then(a=>new a.CameraWeb)});var m=H(8963),A=H(6814),n=H(3911);function o(a,u){if(1&a){const l=t.EpF();t.TgZ(0,"button",7),t.NdJ("click",function(){t.CHM(l),t.oxw();const s=t.MAs(17);return t.KtG(s.click())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&a&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"record_video")))}function f(a,u){if(1&a&&t._UZ(0,"img",18),2&a){const l=t.oxw(2);t.Q6J("src",l.filePreview,t.LSH)}}function e(a,u){if(1&a&&t._UZ(0,"video",19),2&a){const l=t.oxw(2);t.Q6J("src",l.filePreview,t.LSH)}}function r(a,u){if(1&a){const l=t.EpF();t.TgZ(0,"div",14),t.YNc(1,f,1,1,"img",15),t.YNc(2,e,1,1,"video",16),t.TgZ(3,"button",17),t.NdJ("click",function(){t.CHM(l);const s=t.oxw();return t.KtG(s.saveFile())}),t._uU(4),t.ALo(5,"translate"),t.qZA()()}if(2&a){const l=t.oxw();t.xp6(1),t.Q6J("ngIf",!l.isVideo),t.xp6(1),t.Q6J("ngIf",l.isVideo),t.xp6(2),t.Oqu(t.lcZ(5,3,"save"))}}let d=(()=>{var a;class u{constructor(){this.title="T\xe9l\xe9verser un fichier",this.allowImage=!0,this.allowVideo=!0,this.isVideo=!1,this.close=new t.vpe,this.fileSelected=new t.vpe}onFileSelected(c){const s=c.target;if(s.files&&s.files.length>0){const g=s.files[0];this.isVideo=g.type.startsWith("video"),this.isVideo?this.previewVideo(g):this.resizeAndPreviewImage(g)}}onVideoSelected(c){const s=c.target;if(s.files&&s.files.length>0){const g=s.files[0];this.isVideo=!0,this.previewVideo(g)}}openCamera(){var c=this;return(0,W.Z)(function*(){try{const s=yield w.getPhoto({quality:90,allowEditing:!1,resultType:F.dk.Uri,source:F.oK.Camera});if(c.isVideo="video"===s.format,c.isVideo)c.filePreview=s.webPath,c.fileResult={base64:s.webPath,isVideo:!0};else{const g=yield fetch(s.webPath).then(p=>p.blob());c.resizeAndPreviewImage(g)}}catch(s){console.error("Error accessing camera or gallery",s)}})()}resizeAndPreviewImage(c){this.resizeImage(c,600).then(g=>{this.filePreview=g,this.fileResult={base64:g,isVideo:!1}}).catch(g=>{console.error("Error resizing image:",g)})}previewVideo(c){const s=new FileReader;s.onload=()=>{this.filePreview=s.result,this.fileResult={base64:s.result,isVideo:!0}},s.readAsDataURL(c)}saveFile(){this.fileResult&&(this.fileSelected.emit(this.fileResult),this.close.emit())}doCloseModal(){this.close.emit()}get acceptTypes(){let c="";return this.allowImage&&(c+="image/*"),this.allowVideo&&(c+=this.allowImage?",video/*":"video/*"),c}resizeImage(c,s){return new Promise((g,p)=>{const b="image/png"===c.type,R=["image/png","image/gif","image/avif","image/bmp","image/tiff","image/ico","image/heic"].includes(c.type)?"image/jpeg":c.type||"image/jpeg",E=new FileReader;E.onload=Q=>{const x=new Image;x.src=Q.target.result,x.onload=()=>{let B=x.width,D=x.height;if(B>s||D>s)if(B>D){const U=s/B;B=s,D*=U}else{const U=s/D;D=s,B*=U}const y=document.createElement("canvas");if(y.width=B,y.height=D,b){const U=y.getContext("2d");U.fillStyle="white",U.fillRect(0,0,y.width,y.height)}const O=document.createElement("canvas");O.width=B,O.height=D,m().resize(x,O).then(U=>(y.getContext("2d").drawImage(O,0,0,B,D),m().toBlob(y,R,.6))).then(U=>{const i=new FileReader;i.onloadend=()=>g(i.result),i.readAsDataURL(U)}).catch(p)}},E.readAsDataURL(c)})}}return(a=u).\u0275fac=function(c){return new(c||a)},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-file-upload"]],inputs:{title:"title",allowImage:"allowImage",allowVideo:"allowVideo"},outputs:{close:"close",fileSelected:"fileSelected"},decls:20,vars:10,consts:[[1,"modal"],[1,"modal-content","content-background-image"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","modal-close",3,"click"],[1,"title-upload","mt-24","mb-24"],[1,"file-upload"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],[1,"content-button","btn-back-grey","montserrat",3,"click"],[1,"camera-upload","mt-12"],[1,"file-upload","mt-12"],["type","file","accept","video/*","capture","user",2,"display","none",3,"change"],["videoInput",""],["class","content-button btn-back-grey montserrat",3,"click",4,"ngIf"],["class","mt-24 mb-32",4,"ngIf"],[1,"mt-24","mb-32"],["class","preview",3,"src",4,"ngIf"],["class","preview","muted","","playsinline","",3,"src",4,"ngIf"],[1,"content-button","btn-back-primary","montserrat","mt-24",3,"click"],[1,"preview",3,"src"],["muted","","playsinline","",1,"preview",3,"src"]],template:function(c,s){if(1&c){const g=t.EpF();t.TgZ(0,"div",0)(1,"div",1)(2,"img",2),t.NdJ("click",function(){return s.doCloseModal()}),t.qZA(),t.TgZ(3,"div",3),t._uU(4),t.qZA(),t.TgZ(5,"div",4)(6,"input",5,6),t.NdJ("change",function(b){return s.onFileSelected(b)}),t.qZA(),t.TgZ(8,"button",7),t.NdJ("click",function(){t.CHM(g);const b=t.MAs(7);return t.KtG(b.click())}),t._uU(9),t.ALo(10,"translate"),t.qZA()(),t.TgZ(11,"div",8)(12,"button",7),t.NdJ("click",function(){return s.openCamera()}),t._uU(13),t.ALo(14,"translate"),t.qZA()(),t.TgZ(15,"div",9)(16,"input",10,11),t.NdJ("change",function(b){return s.onVideoSelected(b)}),t.qZA(),t.YNc(18,o,3,3,"button",12),t.qZA(),t.YNc(19,r,6,5,"div",13),t.qZA()()}2&c&&(t.xp6(4),t.Oqu(s.title),t.xp6(2),t.Q6J("accept",s.acceptTypes),t.xp6(3),t.Oqu(t.lcZ(10,6,"choose_file")),t.xp6(4),t.Oqu(t.lcZ(14,8,"use_camera")),t.xp6(5),t.Q6J("ngIf",s.allowVideo),t.xp6(1),t.Q6J("ngIf",s.filePreview))},dependencies:[A.O5,n.X$],styles:[".modal[_ngcontent-%COMP%]{width:100%;height:100vh;min-height:100vh;max-height:100vh;z-index:999;background:rgba(0,0,0,.7);position:fixed;top:0;left:0}.modal-content[_ngcontent-%COMP%]{width:80%;max-width:300px;padding:20px 16px;position:relative;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:8px;text-align:center}.modal-close[_ngcontent-%COMP%]{width:28px;position:absolute;top:8px;right:8px}.title-upload[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.preview[_ngcontent-%COMP%]{max-width:100%;max-height:300px}"]}),u})()},8963:j=>{j.exports=function t(C,F,w){function m(o,f){if(!F[o]){if(!C[o]){if(A)return A(o,!0);var r=new Error("Cannot find module '"+o+"'");throw r.code="MODULE_NOT_FOUND",r}var d=F[o]={exports:{}};C[o][0].call(d.exports,function(a){return m(C[o][1][a]||a)},d,d.exports,t,C,F,w)}return F[o].exports}for(var A=void 0,n=0;n<w.length;n++)m(w[n]);return m}({1:[function(t,C,F){"use strict";var w=t("multimath"),m=t("./mm_unsharp_mask"),A=t("./mm_resize");function n(o){var f=o||[],e={js:f.indexOf("js")>=0,wasm:f.indexOf("wasm")>=0};w.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(m),this.use(A)}(n.prototype=Object.create(w.prototype)).constructor=n,n.prototype.resizeAndUnsharp=function(f,e){var r=this.resize(f,e);return f.unsharpAmount&&this.unsharp_mask(r,f.toWidth,f.toHeight,f.unsharpAmount,f.unsharpRadius,f.unsharpThreshold),r},C.exports=n},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(t,C,F){"use strict";function w(e){return e<0?0:e>255?255:e}function m(e){return e>=0?e:0}C.exports={convolveHor:function A(e,r,d,a,u,l){var c,s,g,p,b,M,R,E,Q,x,B,D=0,y=0;for(Q=0;Q<a;Q++){for(b=0,x=0;x<u;x++){for(M=l[b++],R=l[b++],E=D+4*M|0,c=s=g=p=0;R>0;R--)p=p+(B=l[b++])*e[E+3]|0,g=g+B*e[E+2]|0,s=s+B*e[E+1]|0,c=c+B*e[E]|0,E=E+4|0;r[y+3]=m(p>>7),r[y+2]=m(g>>7),r[y+1]=m(s>>7),r[y]=m(c>>7),y=y+4*a|0}y=4*(Q+1)|0,D=(Q+1)*d*4|0}},convolveVert:function n(e,r,d,a,u,l){var c,s,g,p,b,M,R,E,Q,x,B,D=0,y=0;for(Q=0;Q<a;Q++){for(b=0,x=0;x<u;x++){for(M=l[b++],R=l[b++],E=D+4*M|0,c=s=g=p=0;R>0;R--)p=p+(B=l[b++])*e[E+3]|0,g=g+B*e[E+2]|0,s=s+B*e[E+1]|0,c=c+B*e[E]|0,E=E+4|0;c>>=7,s>>=7,g>>=7,r[y+3]=w(8192+(p>>=7)>>14),r[y+2]=w(g+8192>>14),r[y+1]=w(s+8192>>14),r[y]=w(c+8192>>14),y=y+4*a|0}y=4*(Q+1)|0,D=(Q+1)*d*4|0}},convolveHorWithPre:function o(e,r,d,a,u,l){var c,s,g,p,b,M,R,E,Q,x,B,D,y=0,O=0;for(x=0;x<a;x++){for(M=0,B=0;B<u;B++){for(R=l[M++],E=l[M++],Q=y+4*R|0,c=s=g=p=0;E>0;E--)p=p+(D=l[M++])*(b=e[Q+3])|0,g=g+D*e[Q+2]*b|0,s=s+D*e[Q+1]*b|0,c=c+D*e[Q]*b|0,Q=Q+4|0;g=g/255|0,s=s/255|0,c=c/255|0,r[O+3]=m(p>>7),r[O+2]=m(g>>7),r[O+1]=m(s>>7),r[O]=m(c>>7),O=O+4*a|0}O=4*(x+1)|0,y=(x+1)*d*4|0}},convolveVertWithPre:function f(e,r,d,a,u,l){var c,s,g,p,b,M,R,E,Q,x,B,D=0,y=0;for(Q=0;Q<a;Q++){for(b=0,x=0;x<u;x++){for(M=l[b++],R=l[b++],E=D+4*M|0,c=s=g=p=0;R>0;R--)p=p+(B=l[b++])*e[E+3]|0,g=g+B*e[E+2]|0,s=s+B*e[E+1]|0,c=c+B*e[E]|0,E=E+4|0;c>>=7,s>>=7,g>>=7,(p=w(8192+(p>>=7)>>14))>0&&(c=255*c/p|0,s=255*s/p|0,g=255*g/p|0),r[y+3]=p,r[y+2]=w(g+8192>>14),r[y+1]=w(s+8192>>14),r[y]=w(c+8192>>14),y=y+4*a|0}y=4*(Q+1)|0,D=(Q+1)*d*4|0}}}},{}],3:[function(t,C,F){"use strict";C.exports="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"},{}],4:[function(t,C,F){"use strict";C.exports={name:"resize",fn:t("./resize"),wasm_fn:t("./resize_wasm"),wasm_src:t("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(t,C,F){"use strict";var w=t("./resize_filter_gen"),m=t("./convolve"),A=m.convolveHor,n=m.convolveVert,o=m.convolveHorWithPre,f=m.convolveVertWithPre;C.exports=function(a){var u=a.src,l=a.width,c=a.height,s=a.toWidth,g=a.toHeight,p=a.scaleX||a.toWidth/a.width,b=a.scaleY||a.toHeight/a.height,M=a.offsetX||0,R=a.offsetY||0,E=a.dest||new Uint8Array(s*g*4),Q=typeof a.filter>"u"?"mks2013":a.filter,x=w(Q,l,s,p,M),B=w(Q,c,g,b,R),D=new Uint16Array(s*c*4);return function e(d,a,u){for(var l=3,c=a*u*4|0;l<c;){if(255!==d[l])return!0;l=l+4|0}return!1}(u,l,c)?(o(u,D,l,c,s,x),f(D,E,c,s,g,B)):(A(u,D,l,c,s,x),n(D,E,c,s,g,B),function r(d,a,u){for(var l=3,c=a*u*4|0;l<c;)d[l]=255,l=l+4|0}(E,s,g)),E}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(t,C,F){"use strict";var w=t("./resize_filter_info");function A(n){return Math.round(16383*n)}C.exports=function(o,f,e,r,d){var s,g,p,b,M,R,E,Q,x,B,D,y,O,U,i,h,a=w.filter[o].fn,u=1/r,l=Math.min(1,r),c=w.filter[o].win/l,_=Math.floor(2*(c+1)),v=new Int16Array((_+2)*e),P=0,k=!v.subarray||!v.set;for(s=0;s<e;s++){for(g=(s+.5)*u+d,p=Math.max(0,Math.floor(g-c)),M=(b=Math.min(f-1,Math.ceil(g+c)))-p+1,R=new Float32Array(M),E=new Int16Array(M),Q=0,x=p,B=0;x<=b;x++,B++)Q+=D=a((x+.5-g)*l),R[B]=D;for(y=0,B=0;B<R.length;B++)y+=O=R[B]/Q,E[B]=A(O);for(E[e>>1]+=A(1-y),U=0;U<E.length&&0===E[U];)U++;if(U<E.length){for(i=E.length-1;i>0&&0===E[i];)i--;if(h=i-U+1,v[P++]=p+U,v[P++]=h,k)for(B=U;B<=i;B++)v[P++]=E[B];else v.set(E.subarray(U,i+1),P),P+=h}else v[P++]=0,v[P++]=0}return v}},{"./resize_filter_info":7}],7:[function(t,C,F){"use strict";C.exports={filter:{box:{win:.5,fn:function(A){return A<0&&(A=-A),A<.5?1:0}},hamming:{win:1,fn:function(A){if(A<0&&(A=-A),A>=1)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*(.54+.46*Math.cos(n/1))}},lanczos2:{win:2,fn:function(A){if(A<0&&(A=-A),A>=2)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*Math.sin(n/2)/(n/2)}},lanczos3:{win:3,fn:function(A){if(A<0&&(A=-A),A>=3)return 0;if(A<1.1920929e-7)return 1;var n=A*Math.PI;return Math.sin(n)/n*Math.sin(n/3)/(n/3)}},mks2013:{win:2.5,fn:function(A){return A<0&&(A=-A),A>=2.5?0:A>=1.5?-.125*(A-2.5)*(A-2.5):A>=.5?.25*(4*A*A-11*A+7):1.0625-1.75*A*A}}},f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(t,C,F){"use strict";var w=t("./resize_filter_gen");var o=!0;try{o=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch{}function f(e,r,d){if(o)r.set(function n(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),d);else for(var a=d,u=0;u<e.length;u++){var l=e[u];r[a++]=255&l,r[a++]=l>>8&255}}C.exports=function(r){var d=r.src,a=r.width,u=r.height,l=r.toWidth,c=r.toHeight,s=r.scaleX||r.toWidth/r.width,g=r.scaleY||r.toHeight/r.height,p=r.offsetX||0,b=r.offsetY||0,M=r.dest||new Uint8Array(l*c*4),R=typeof r.filter>"u"?"mks2013":r.filter,E=w(R,a,l,s,p),Q=w(R,u,c,g,b),B=Math.max(d.byteLength,M.byteLength),D=this.__align(0+B),O=this.__align(D+u*l*4*2),U=this.__align(O+E.byteLength),I=this.__instance("resize",U+Q.byteLength),h=new Uint8Array(this.__memory.buffer),_=new Uint32Array(this.__memory.buffer),v=new Uint32Array(d.buffer);_.set(v),f(E,h,O),f(Q,h,U);var P=I.exports.convolveHV||I.exports._convolveHV;return function m(e,r,d){for(var a=3,u=r*d*4|0;a<u;){if(255!==e[a])return!0;a=a+4|0}return!1}(d,a,u)?P(O,U,D,a,u,l,c,1):(P(O,U,D,a,u,l,c,0),function A(e,r,d){for(var a=3,u=r*d*4|0;a<u;)e[a]=255,a=a+4|0}(M,l,c)),new Uint32Array(M.buffer).set(new Uint32Array(this.__memory.buffer,0,c*l)),M}},{"./resize_filter_gen":6}],9:[function(t,C,F){"use strict";C.exports={name:"unsharp_mask",fn:t("./unsharp_mask"),wasm_fn:t("./unsharp_mask_wasm"),wasm_src:t("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(t,C,F){"use strict";var w=t("glur/mono16");C.exports=function(n,o,f,e,r,d){var a,u,l,c,s;if(!(0===e||r<.5)){r>2&&(r=2);var g=function m(A,n,o){for(var r,d,a,f=n*o,e=new Uint16Array(f),l=0;l<f;l++)a=A[4*l+2],e[l]=((r=A[4*l])>=(d=A[4*l+1])&&r>=a?r:d>=a&&d>=r?d:a)<<8;return e}(n,o,f),p=new Uint16Array(g);w(p,o,f,r);for(var b=e/100*4096+.5|0,M=d<<8,R=o*f,E=0;E<R;E++)c=(a=g[E])-p[E],Math.abs(c)>=M&&(n[s=4*E]=n[s]*(l=((u=(u=(u=a+(b*c+2048>>12))>65280?65280:u)<0?0:u)<<12)/(a=0!==a?a:1)|0)+2048>>12,n[s+1]=n[s+1]*l+2048>>12,n[s+2]=n[s+2]*l+2048>>12)}}},{"glur/mono16":18}],11:[function(t,C,F){"use strict";C.exports=function(m,A,n,o,f,e){if(!(0===o||f<.5)){f>2&&(f=2);var r=A*n,d=4*r,a=2*r,u=2*r,l=4*Math.max(A,n),g=d,p=g+a,b=p+u,M=b+u,R=M+l,E=this.__instance("unsharp_mask",d+a+2*u+l+32,{exp:Math.exp}),Q=new Uint32Array(m.buffer);new Uint32Array(this.__memory.buffer).set(Q);var B=E.exports.hsv_v16||E.exports._hsv_v16;B(0,g,A,n),(B=E.exports.blurMono16||E.exports._blurMono16)(g,p,b,M,R,A,n,f),(B=E.exports.unsharp||E.exports._unsharp)(0,0,g,p,A,n,o,e),Q.set(new Uint32Array(this.__memory.buffer,0,r))}}},{}],12:[function(t,C,F){"use strict";C.exports="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"},{}],13:[function(t,C,F){"use strict";function m(A,n){this.create=A,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=n||2e3}m.prototype.acquire=function(){var n,A=this;return 0!==this.available.length?n=this.available.pop():((n=this.create()).id=this.lastId++,n.release=function(){return A.release(n)}),this.acquired[n.id]=n,n},m.prototype.release=function(A){var n=this;delete this.acquired[A.id],A.lastUsed=Date.now(),this.available.push(A),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return n.gc()},100))},m.prototype.gc=function(){var A=this,n=Date.now();this.available=this.available.filter(function(o){return!(n-o.lastUsed>A.idle&&(o.destroy(),1))}),this.timeoutId=0!==this.available.length?setTimeout(function(){return A.gc()},100):0},C.exports=m},{}],14:[function(t,C,F){"use strict";C.exports=function(A,n,o,f,e,r){var u=(2*r+2+1)/e;if(u>.5)return[[o,f]];var l=Math.ceil(Math.log(Math.min(o/A,f/n))/Math.log(u));if(l<=1)return[[o,f]];for(var c=[],s=0;s<l;s++){var g=Math.round(Math.pow(Math.pow(A,l-s-1)*Math.pow(o,s+1),1/l)),p=Math.round(Math.pow(Math.pow(n,l-s-1)*Math.pow(f,s+1),1/l));c.push([g,p])}return c}},{}],15:[function(t,C,F){"use strict";var w=1e-5;function m(n){var o=Math.round(n);return Math.abs(n-o)<w?o:Math.floor(n)}function A(n){var o=Math.round(n);return Math.abs(n-o)<w?o:Math.ceil(n)}C.exports=function(o){var f=o.toWidth/o.width,e=o.toHeight/o.height,r=m(o.srcTileSize*f)-2*o.destTileBorder,d=m(o.srcTileSize*e)-2*o.destTileBorder;if(r<1||d<1)throw new Error("Internal error in pica: target tile width/height is too small.");var a,u,l,c,s,g,b,p=[];for(c=0;c<o.toHeight;c+=d)for(l=0;l<o.toWidth;l+=r)(a=l-o.destTileBorder)<0&&(a=0),a+(s=l+r+o.destTileBorder-a)>=o.toWidth&&(s=o.toWidth-a),(u=c-o.destTileBorder)<0&&(u=0),u+(g=c+d+o.destTileBorder-u)>=o.toHeight&&(g=o.toHeight-u),b={toX:a,toY:u,toWidth:s,toHeight:g,toInnerX:l,toInnerY:c,toInnerWidth:r,toInnerHeight:d,offsetX:a/f-m(a/f),offsetY:u/e-m(u/e),scaleX:f,scaleY:e,x:m(a/f),y:m(u/e),width:A(s/f),height:A(g/e)},p.push(b);return p}},{}],16:[function(t,C,F){"use strict";function w(m){return Object.prototype.toString.call(m)}C.exports.isCanvas=function(A){var n=w(A);return"[object HTMLCanvasElement]"===n||"[object OffscreenCanvas]"===n||"[object Canvas]"===n},C.exports.isImage=function(A){return"[object HTMLImageElement]"===w(A)},C.exports.isImageBitmap=function(A){return"[object ImageBitmap]"===w(A)},C.exports.limiter=function(A){var n=0,o=[];function f(){n<A&&o.length&&(n++,o.shift()())}return function(r){return new Promise(function(d,a){o.push(function(){r().then(function(u){d(u),n--,f()},function(u){a(u),n--,f()})}),f()})}},C.exports.cib_quality_name=function(A){switch(A){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},C.exports.cib_support=function(A){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var n=A(100,100);return createImageBitmap(n,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(o){var f=10===o.width;return o.close(),n=null,f})}).catch(function(){return!1})},C.exports.worker_offscreen_canvas_support=function(){return new Promise(function(A,n){if(typeof OffscreenCanvas>"u")A(!1);else{var f=btoa("(".concat(function o(r){typeof createImageBitmap>"u"?r.postMessage(!1):Promise.resolve().then(function(){var d=new OffscreenCanvas(10,10);return d.getContext("2d").rect(0,0,1,1),createImageBitmap(d,0,0,1,1)}).then(function(){return r.postMessage(!0)},function(){return r.postMessage(!1)})}.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(f));e.onmessage=function(r){return A(r.data)},e.onerror=n}}).then(function(A){return A},function(){return!1})},C.exports.can_use_canvas=function(A){var n=!1;try{var f=A(2,1).getContext("2d"),e=f.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,f.putImageData(e,0,0),e=null,12===(e=f.getImageData(0,0,2,1)).data[0]&&23===e.data[1]&&34===e.data[2]&&255===e.data[3]&&45===e.data[4]&&56===e.data[5]&&67===e.data[6]&&255===e.data[7]&&(n=!0)}catch{}return n},C.exports.cib_can_use_region=function(){return new Promise(function(A){if(typeof Image>"u"||typeof createImageBitmap>"u")A(!1);else{var n=new Image;n.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",n.onload=function(){createImageBitmap(n,0,0,n.width,n.height).then(function(o){A(o.width===n.width&&o.height===n.height)},function(){return A(!1)})},n.onerror=function(){return A(!1)}}})}},{}],17:[function(t,C,F){"use strict";C.exports=function(){var m,w=t("./mathlib");onmessage=function(n){var o=n.data.opts;if(!o.src&&o.srcBitmap){var e=new OffscreenCanvas(o.width,o.height),r=e.getContext("2d");r.drawImage(o.srcBitmap,0,0),o.src=r.getImageData(0,0,o.width,o.height).data,e.width=e.height=0,e=null,o.srcBitmap.close(),o.srcBitmap=null}m||(m=new w(n.data.features));var d=m.resizeAndUnsharp(o);postMessage({data:d},[d.buffer])}}},{"./mathlib":1}],18:[function(t,C,F){var w,m,A,n,o,f;function a(l,c,s,g,p,b){var M,R,E,Q,x,B,D,y,O,U,i,I,h,_;for(O=0;O<b;O++){for(D=O,y=0,Q=x=(M=l[B=O*p])*g[6],i=g[0],I=g[1],h=g[4],_=g[5],U=0;U<p;U++)E=(R=l[B])*i+M*I+Q*h+x*_,x=Q,M=R,s[y]=Q=E,y++,B++;for(y--,D+=b*(p-1),Q=x=(M=l[--B])*g[7],R=M,i=g[2],I=g[3],U=p-1;U>=0;U--)E=R*i+M*I+Q*h+x*_,x=Q,M=R,R=l[B],c[D]=s[y]+(Q=E),B--,y--,D-=b}}C.exports=function u(l,c,s,g){if(g){var p=new Uint16Array(l.length),b=new Float32Array(Math.max(c,s)),M=function d(l){l<.5&&(l=.5);var c=Math.exp(.527076)/l,s=Math.exp(-c),g=Math.exp(-2*c),p=(1-s)*(1-s)/(1+2*c*s-g);return w=p,m=p*(c-1)*s,A=p*(c+1)*s,n=-p*g,o=2*s,f=-g,new Float32Array([w,m,A,n,o,f,(w+m)/(1-o-f),(A+n)/(1-o-f)])}(g);a(l,p,b,M,c,s),a(p,l,b,M,s,c)}}},{}],19:[function(t,C,F){"use strict";var w=t("object-assign"),m=t("./lib/base64decode"),A=t("./lib/wa_detect"),n={js:!0,wasm:!0};function o(f){if(!(this instanceof o))return new o(f);var e=w({},n,f||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}o.prototype.has_wasm=A,o.prototype.use=function(f){return this.__modules[f.name]=f,this[f.name]=this.options.wasm&&this.has_wasm()&&f.wasm_fn?f.wasm_fn:f.fn,this},o.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var f=this;return this.__init_promise=Promise.all(Object.keys(f.__modules).map(function(e){var r=f.__modules[e];return f.options.wasm&&f.has_wasm()&&r.wasm_fn&&!f.__wasm[e]?WebAssembly.compile(f.__base64decode(r.wasm_src)).then(function(d){f.__wasm[e]=d}):null})).then(function(){return f}),this.__init_promise},o.prototype.__base64decode=m,o.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var r=this.__memory.buffer.byteLength;return r<e&&this.__memory.grow(Math.ceil((e-r)/65536)),this.__memory},o.prototype.__instance=function(e,r,d){if(r&&this.__reallocate(r),this.__wasm[e]||(this.__wasm[e]=new WebAssembly.Module(this.__base64decode(this.__modules[e].wasm_src))),!this.__cache[e]){var u={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:w(u,d||{})})}return this.__cache[e]},o.prototype.__align=function(e,r){var d=e%(r=r||8);return e+(d?r-d:0)},C.exports=o},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(t,C,F){"use strict";C.exports=function(A){for(var n=A.replace(/[\r\n=]/g,""),o=n.length,f=new Uint8Array(3*o>>2),e=0,r=0,d=0;d<o;d++)d%4==0&&d&&(f[r++]=e>>16&255,f[r++]=e>>8&255,f[r++]=255&e),e=e<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(n.charAt(d));var a=o%4*6;return 0===a?(f[r++]=e>>16&255,f[r++]=e>>8&255,f[r++]=255&e):18===a?(f[r++]=e>>10&255,f[r++]=e>>2&255):12===a&&(f[r++]=e>>4&255),f}},{}],21:[function(t,C,F){"use strict";var w;C.exports=function(){if(typeof w<"u"||(w=!1,typeof WebAssembly>"u"))return w;try{var A=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),n=new WebAssembly.Module(A);return 0!==new WebAssembly.Instance(n,{}).exports.test(4)&&(w=!0),w}catch{}return w}},{}],22:[function(t,C,F){"use strict";var w=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;C.exports=function o(){try{if(!Object.assign)return!1;var f=new String("abc");if(f[5]="de","5"===Object.getOwnPropertyNames(f)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(u){return e[u]}).join(""))return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(u){a[u]=u}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},a)).join("")}catch{return!1}}()?Object.assign:function(f,e){for(var r,a,d=function n(f){if(null==f)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(f)}(f),u=1;u<arguments.length;u++){for(var l in r=Object(arguments[u]))m.call(r,l)&&(d[l]=r[l]);if(w){a=w(r);for(var c=0;c<a.length;c++)A.call(r,a[c])&&(d[a[c]]=r[a[c]])}}return d}},{}],23:[function(t,C,F){var w=arguments[3],m=arguments[4],A=arguments[5],n=JSON.stringify;C.exports=function(o,f){for(var e,r=Object.keys(A),d=0,a=r.length;d<a;d++){var l=A[u=r[d]].exports;if(l===o||l&&l.default===o){e=u;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var c={};for(d=0,a=r.length;d<a;d++){var u;c[u=r[d]]=u}m[e]=["function(require,module,exports){"+o+"(self); }",c]}var s=Math.floor(Math.pow(16,8)*Math.random()).toString(16),g={};g[e]=e,m[s]=["function(require,module,exports){var f = require("+n(e)+");(f.default ? f.default : f)(self);}",g];var p={};!function b(B){for(var D in p[B]=!0,m[B][1]){var y=m[B][1][D];p[y]||b(y)}}(s);var M="("+w+")({"+Object.keys(p).map(function(B){return n(B)+":["+m[B][0]+","+n(m[B][1])+"]"}).join(",")+"},{},["+n(s)+"])",R=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([M],{type:"text/javascript"});if(f&&f.bare)return E;var Q=R.createObjectURL(E),x=new Worker(Q);return x.objectURL=Q,x}},{}],"/index.js":[function(t,C,F){"use strict";function w(i,I){return function f(i){if(Array.isArray(i))return i}(i)||function o(i,I){var h=null==i?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(null!=h){var k,G,_=[],v=!0,P=!1;try{for(h=h.call(i);!(v=(k=h.next()).done)&&(_.push(k.value),!I||_.length!==I);v=!0);}catch(S){P=!0,G=S}finally{try{!v&&null!=h.return&&h.return()}finally{if(P)throw G}}return _}}(i,I)||function A(i,I){if(i){if("string"==typeof i)return n(i,I);var h=Object.prototype.toString.call(i).slice(8,-1);if("Object"===h&&i.constructor&&(h=i.constructor.name),"Map"===h||"Set"===h)return Array.from(i);if("Arguments"===h||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(h))return n(i,I)}}(i,I)||function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(i,I){(null==I||I>i.length)&&(I=i.length);for(var h=0,_=new Array(I);h<I;h++)_[h]=i[h];return _}var e=t("object-assign"),r=t("webworkify"),d=t("./lib/mathlib"),a=t("./lib/pool"),u=t("./lib/utils"),l=t("./lib/worker"),c=t("./lib/stepper"),s=t("./lib/tiler"),g=t("./lib/mm_resize/resize_filter_info"),p={},b=!1;try{typeof navigator<"u"&&navigator.userAgent&&(b=navigator.userAgent.indexOf("Safari")>=0)}catch{}var M=1;typeof navigator<"u"&&(M=Math.min(navigator.hardwareConcurrency||1,4));var R={tile:1024,concurrency:M,features:["js","wasm","ww"],idle:2e3,createCanvas:function(I,h){var _=document.createElement("canvas");return _.width=I,_.height=h,_}},E={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},Q=!1,x=!1,B=!1,D=!1,y=!1;function O(){return{value:r(l),destroy:function(){if(this.value.terminate(),typeof window<"u"){var I=window.URL||window.webkitURL||window.mozURL||window.msURL;I&&I.revokeObjectURL&&this.value.objectURL&&I.revokeObjectURL(this.value.objectURL)}}}}function U(i){if(!(this instanceof U))return new U(i);this.options=e({},R,i||{});var I="lk_".concat(this.options.concurrency);this.__limit=p[I]||u.limiter(this.options.concurrency),p[I]||(p[I]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}U.prototype.init=function(){var i=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),Q=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?x=!0:this.debug("ImageBitmap does not support .close(), disabled"));var I=this.options.features.slice();if(I.indexOf("all")>=0&&(I=["cib","wasm","js","ww"]),this.__requested_features=I,this.__mathlib=new d(I),I.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{t("webworkify")(function(){}).terminate(),this.features.ww=!0;var _="wp_".concat(JSON.stringify(this.options));p[_]?this.__workersPool=p[_]:(this.__workersPool=new a(O,this.options.idle),p[_]=this.__workersPool)}catch{}var P,k,v=this.__mathlib.init().then(function(S){e(i.features,S.features)});P=x?u.cib_support(this.options.createCanvas).then(function(S){i.features.cib&&I.indexOf("cib")<0?i.debug("createImageBitmap() resize supported, but disabled by config"):I.indexOf("cib")>=0&&(i.features.cib=S)}):Promise.resolve(!1),B=u.can_use_canvas(this.options.createCanvas),k=(k=x&&Q&&-1!==I.indexOf("ww")?u.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(S){D=S});var G=u.cib_can_use_region().then(function(S){y=S});return this.__initPromise=Promise.all([v,P,k,G]).then(function(){return i}),this.__initPromise},U.prototype.__invokeResize=function(i,I){var h=this;return I.__mathCache=I.__mathCache||{},Promise.resolve().then(function(){return h.features.ww?new Promise(function(_,v){var P=h.__workersPool.acquire();I.cancelToken&&I.cancelToken.catch(function(G){return v(G)}),P.value.onmessage=function(G){P.release(),G.data.err?v(G.data.err):_(G.data)};var k=[];i.src&&k.push(i.src.buffer),i.srcBitmap&&k.push(i.srcBitmap),P.value.postMessage({opts:i,features:h.__requested_features,preload:{wasm_nodule:h.__mathlib.__}},k)}):{data:h.__mathlib.resizeAndUnsharp(i,I.__mathCache)}})},U.prototype.__extractTileData=function(i,I,h,_,v){if(this.features.ww&&D&&(u.isCanvas(I)||y))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(_.srcImageBitmap||I,i.x,i.y,i.width,i.height).then(function(G){return v.srcBitmap=G,v});if(u.isCanvas(I))return _.srcCtx||(_.srcCtx=I.getContext("2d")),this.debug("Get tile pixel data"),v.src=_.srcCtx.getImageData(i.x,i.y,i.width,i.height).data,v;this.debug("Draw tile imageBitmap/image to temporary canvas");var P=this.options.createCanvas(i.width,i.height),k=P.getContext("2d");return k.globalCompositeOperation="copy",k.drawImage(_.srcImageBitmap||I,i.x,i.y,i.width,i.height,0,0,i.width,i.height),this.debug("Get tile pixel data"),v.src=k.getImageData(0,0,i.width,i.height).data,P.width=P.height=0,v},U.prototype.__landTileData=function(i,I,h){var _;if(this.debug("Convert raw rgba tile result to ImageData"),I.bitmap)return h.toCtx.drawImage(I.bitmap,i.toX,i.toY),null;if(Q)_=new ImageData(new Uint8ClampedArray(I.data),i.toWidth,i.toHeight);else if((_=h.toCtx.createImageData(i.toWidth,i.toHeight)).data.set)_.data.set(I.data);else for(var v=_.data.length-1;v>=0;v--)_.data[v]=I.data[v];return this.debug("Draw tile"),b?h.toCtx.putImageData(_,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth+1e-5,i.toInnerHeight+1e-5):h.toCtx.putImageData(_,i.toX,i.toY,i.toInnerX-i.toX,i.toInnerY-i.toY,i.toInnerWidth,i.toInnerHeight),null},U.prototype.__tileAndResize=function(i,I,h){var _=this,v={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(function(){if(v.toCtx=I.getContext("2d"),u.isCanvas(i))return null;if(u.isImageBitmap(i))return v.srcImageBitmap=i,v.isImageBitmapReused=!0,null;if(u.isImage(i))return x?(_.debug("Decode image via createImageBitmap"),createImageBitmap(i).then(function(k){v.srcImageBitmap=k}).catch(function(k){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(h.canceled)return h.cancelToken;_.debug("Calculate tiles");var G=s({width:h.width,height:h.height,srcTileSize:_.options.tile,toWidth:h.toWidth,toHeight:h.toHeight,destTileBorder:h.__destTileBorder}).map(function(T){return function(G){return _.__limit(function(){if(h.canceled)return h.cancelToken;var S={width:G.width,height:G.height,toWidth:G.toWidth,toHeight:G.toHeight,scaleX:G.scaleX,scaleY:G.scaleY,offsetX:G.offsetX,offsetY:G.offsetY,filter:h.filter,unsharpAmount:h.unsharpAmount,unsharpRadius:h.unsharpRadius,unsharpThreshold:h.unsharpThreshold};return _.debug("Invoke resize math"),Promise.resolve(S).then(function(T){return _.__extractTileData(G,i,h,v,T)}).then(function(T){return _.debug("Invoke resize math"),_.__invokeResize(T,h)}).then(function(T){return h.canceled?h.cancelToken:(v.srcImageData=null,_.__landTileData(G,T,v))})})}(T)});function S(T){T.srcImageBitmap&&(T.isImageBitmapReused||T.srcImageBitmap.close(),T.srcImageBitmap=null)}return _.debug("Process tiles"),Promise.all(G).then(function(){return _.debug("Finished!"),S(v),I},function(T){throw S(v),T})})},U.prototype.__processStages=function(i,I,h,_){var v=this;if(_.canceled)return _.cancelToken;var Y,N,k=w(i.shift(),2),G=k[0],S=k[1],T=0===i.length;return Y=T||g.q2f.indexOf(_.filter)<0?_.filter:"box"===_.filter?"box":"hamming",_=e({},_,{toWidth:G,toHeight:S,filter:Y}),T||(N=this.options.createCanvas(G,S)),this.__tileAndResize(I,T?h:N,_).then(function(){return T?h:(_.width=G,_.height=S,v.__processStages(i,N,h,_))}).then(function(q){return N&&(N.width=N.height=0),q})},U.prototype.__resizeViaCreateImageBitmap=function(i,I,h){var _=this,v=I.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(i,{resizeWidth:h.toWidth,resizeHeight:h.toHeight,resizeQuality:u.cib_quality_name(g.f2q[h.filter])}).then(function(P){if(h.canceled)return h.cancelToken;if(!h.unsharpAmount)return v.drawImage(P,0,0),P.close(),v=null,_.debug("Finished!"),I;_.debug("Unsharp result");var k=_.options.createCanvas(h.toWidth,h.toHeight),G=k.getContext("2d");G.drawImage(P,0,0),P.close();var S=G.getImageData(0,0,h.toWidth,h.toHeight);return _.__mathlib.unsharp_mask(S.data,h.toWidth,h.toHeight,h.unsharpAmount,h.unsharpRadius,h.unsharpThreshold),v.putImageData(S,0,0),k.width=k.height=0,S=G=k=v=null,_.debug("Finished!"),I})},U.prototype.resize=function(i,I,h){var _=this;this.debug("Start resize...");var v=e({},E);if(isNaN(h)?h&&(v=e(v,h)):v=e(v,{quality:h}),v.toWidth=I.width,v.toHeight=I.height,v.width=i.naturalWidth||i.width,v.height=i.naturalHeight||i.height,Object.prototype.hasOwnProperty.call(v,"quality")){if(v.quality<0||v.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(v.quality));v.filter=g.q2f[v.quality]}return 0===I.width||0===I.height?Promise.reject(new Error("Invalid output size: ".concat(I.width,"x").concat(I.height))):(v.unsharpRadius>2&&(v.unsharpRadius=2),v.canceled=!1,v.cancelToken&&(v.cancelToken=v.cancelToken.then(function(k){throw v.canceled=!0,k},function(k){throw v.canceled=!0,k})),v.__destTileBorder=Math.ceil(Math.max(3,2.5*v.unsharpRadius|0)),this.init().then(function(){if(v.canceled)return v.cancelToken;if(_.features.cib){if(g.q2f.indexOf(v.filter)>=0)return _.__resizeViaCreateImageBitmap(i,I,v);_.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!B){var k=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw k.code="ERR_GET_IMAGE_DATA",k}var G=c(v.width,v.height,v.toWidth,v.toHeight,_.options.tile,v.__destTileBorder);return _.__processStages(G,i,I,v)}))},U.prototype.resizeBuffer=function(i){var I=this,h=e({},E,i);if(Object.prototype.hasOwnProperty.call(h,"quality")){if(h.quality<0||h.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(h.quality));h.filter=g.q2f[h.quality]}return this.init().then(function(){return I.__mathlib.resizeAndUnsharp(h)})},U.prototype.toBlob=function(i,I,h){return I=I||"image/png",new Promise(function(_){if(i.toBlob)i.toBlob(function(S){return _(S)},I,h);else if(i.convertToBlob)_(i.convertToBlob({type:I,quality:h}));else{for(var v=atob(i.toDataURL(I,h).split(",")[1]),P=v.length,k=new Uint8Array(P),G=0;G<P;G++)k[G]=v.charCodeAt(G);_(new Blob([k],{type:I}))}})},U.prototype.debug=function(){},C.exports=U},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")},4036:(j,L,H)=>{"use strict";H.d(L,{z:()=>C});var W=H(6973),t=H(305);function C(F,w){const m="object"==typeof w;return new Promise((A,n)=>{const o=new t.Hp({next:f=>{A(f),o.unsubscribe()},error:n,complete:()=>{m?A(w.defaultValue):n(new W.K)}});F.subscribe(o)})}}}]);