(self.webpackChunkapp=self.webpackChunkapp||[]).push([[273],{273:(q,j,L)=>{"use strict";L.d(j,{Y:()=>i});var M=L(6689),Q=L(8963),O=L(6814);function E(r,s){if(1&r&&M._UZ(0,"img",13),2&r){const e=M.oxw(2);M.Q6J("src",e.filePreview,M.LSH)}}function v(r,s){if(1&r&&M._UZ(0,"video",14),2&r){const e=M.oxw(2);M.Q6J("src",e.filePreview,M.LSH)}}function n(r,s){if(1&r){const e=M.EpF();M.TgZ(0,"div",9),M.YNc(1,E,1,1,"img",10),M.YNc(2,v,1,1,"video",11),M.TgZ(3,"button",12),M.NdJ("click",function(){M.CHM(e);const c=M.oxw();return M.KtG(c.saveFile())}),M._uU(4,"Sauvegarder"),M.qZA()()}if(2&r){const e=M.oxw();M.xp6(1),M.Q6J("ngIf",!e.isVideo),M.xp6(1),M.Q6J("ngIf",e.isVideo)}}let i=(()=>{var r;class s{constructor(){this.title="T\xe9l\xe9verser un fichier",this.allowImage=!0,this.allowVideo=!0,this.filePreview=null,this.isVideo=!1,this.close=new M.vpe,this.fileSelected=new M.vpe}onFileSelected(t){const c=t.target;if(c.files&&c.files.length>0){const A=c.files[0];if(this.isVideo=A.type.startsWith("video"),this.isVideo){const o=new FileReader;o.onload=()=>{this.filePreview=o.result,this.fileResult={base64:o.result,isVideo:!0}},o.readAsDataURL(A)}else this.resizeImage(A,600).then(f=>{this.filePreview=f,this.fileResult={base64:f,isVideo:!1}}).catch(f=>{console.error("Error resizing image:",f)})}}saveFile(){this.fileResult&&(this.fileSelected.emit(this.fileResult),this.close.emit())}doCloseModal(){this.close.emit()}get acceptTypes(){let t="";return this.allowImage&&(t+="image/*"),this.allowVideo&&(t+=this.allowImage?",video/*":"video/*"),t}resizeImage(t,c){return new Promise((A,o)=>{const f="image/png"===t.type,g=["image/png","image/gif","image/avif","image/bmp","image/tiff","image/ico","image/heic"].includes(t.type)?"image/jpeg":t.type||"image/jpeg",d=new FileReader;d.onload=p=>{const x=new Image;x.src=p.target.result,x.onload=()=>{let b=x.width,D=x.height;if(b>c||D>c)if(b>D){const y=c/b;b=c,D*=y}else{const y=c/D;D=c,b*=y}const _=document.createElement("canvas");if(_.width=b,_.height=D,f){const y=_.getContext("2d");y.fillStyle="white",y.fillRect(0,0,_.width,_.height)}const C=document.createElement("canvas");C.width=b,C.height=D,Q().resize(x,C).then(y=>(_.getContext("2d").drawImage(C,0,0,b,D),Q().toBlob(_,g,.6))).then(y=>{const B=new FileReader;B.onloadend=()=>A(B.result),B.readAsDataURL(y)}).catch(o)}},d.readAsDataURL(t)})}}return(r=s).\u0275fac=function(t){return new(t||r)},r.\u0275cmp=M.Xpm({type:r,selectors:[["app-file-upload"]],inputs:{title:"title",allowImage:"allowImage",allowVideo:"allowVideo"},outputs:{close:"close",fileSelected:"fileSelected"},decls:11,vars:3,consts:[[1,"modal"],[1,"modal-content","content-background-image"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","modal-close",3,"click"],[1,"title-upload","mt-24","mb-24"],[1,"file-upload"],["type","file",2,"display","none",3,"accept","change"],["fileInput",""],[1,"content-button","btn-back-grey","montserrat",3,"click"],["class","mt-24 mb-32",4,"ngIf"],[1,"mt-24","mb-32"],["class","preview",3,"src",4,"ngIf"],["class","preview","muted","","playsinline","",3,"src",4,"ngIf"],[1,"content-button","btn-back-primary","montserrat","mt-24",3,"click"],[1,"preview",3,"src"],["muted","","playsinline","",1,"preview",3,"src"]],template:function(t,c){if(1&t){const A=M.EpF();M.TgZ(0,"div",0)(1,"div",1)(2,"img",2),M.NdJ("click",function(){return c.doCloseModal()}),M.qZA(),M.TgZ(3,"div",3),M._uU(4),M.qZA(),M.TgZ(5,"div",4)(6,"input",5,6),M.NdJ("change",function(f){return c.onFileSelected(f)}),M.qZA(),M.TgZ(8,"button",7),M.NdJ("click",function(){M.CHM(A);const f=M.MAs(7);return M.KtG(f.click())}),M._uU(9,"Choisir le fichier"),M.qZA()(),M.YNc(10,n,5,2,"div",8),M.qZA()()}2&t&&(M.xp6(4),M.Oqu(c.title),M.xp6(2),M.Q6J("accept",c.acceptTypes),M.xp6(4),M.Q6J("ngIf",c.filePreview))},dependencies:[O.O5],styles:[".modal[_ngcontent-%COMP%]{width:100%;height:100vh;min-height:100vh;max-height:100vh;z-index:999;background:rgba(0,0,0,.7);position:fixed;top:0;left:0}.modal-content[_ngcontent-%COMP%]{width:80%;max-width:300px;padding:20px 16px;position:relative;z-index:1000;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:8px;text-align:center}.modal-close[_ngcontent-%COMP%]{width:28px;position:absolute;top:8px;right:8px}.title-upload[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.preview[_ngcontent-%COMP%]{max-width:100%;width:100%}"]}),s})()},8963:q=>{q.exports=function Q(w,O,E){function v(r,s){if(!O[r]){if(!w[r]){if(n)return n(r,!0);var t=new Error("Cannot find module '"+r+"'");throw t.code="MODULE_NOT_FOUND",t}var c=O[r]={exports:{}};w[r][0].call(c.exports,function(A){return v(w[r][1][A]||A)},c,c.exports,Q,w,O,E)}return O[r].exports}for(var n=void 0,i=0;i<E.length;i++)v(E[i]);return v}({1:[function(Q,w,O){"use strict";var E=Q("multimath"),v=Q("./mm_unsharp_mask"),n=Q("./mm_resize");function i(r){var s=r||[],e={js:s.indexOf("js")>=0,wasm:s.indexOf("wasm")>=0};E.call(this,e),this.features={js:e.js,wasm:e.wasm&&this.has_wasm()},this.use(v),this.use(n)}(i.prototype=Object.create(E.prototype)).constructor=i,i.prototype.resizeAndUnsharp=function(s,e){var t=this.resize(s,e);return s.unsharpAmount&&this.unsharp_mask(t,s.toWidth,s.toHeight,s.unsharpAmount,s.unsharpRadius,s.unsharpThreshold),t},w.exports=i},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(Q,w,O){"use strict";function E(e){return e<0?0:e>255?255:e}function v(e){return e>=0?e:0}w.exports={convolveHor:function n(e,t,c,A,o,f){var l,g,d,p,x,b,D,_,C,y,B,G=0,F=0;for(C=0;C<A;C++){for(x=0,y=0;y<o;y++){for(b=f[x++],D=f[x++],_=G+4*b|0,l=g=d=p=0;D>0;D--)p=p+(B=f[x++])*e[_+3]|0,d=d+B*e[_+2]|0,g=g+B*e[_+1]|0,l=l+B*e[_]|0,_=_+4|0;t[F+3]=v(p>>7),t[F+2]=v(d>>7),t[F+1]=v(g>>7),t[F]=v(l>>7),F=F+4*A|0}F=4*(C+1)|0,G=(C+1)*c*4|0}},convolveVert:function i(e,t,c,A,o,f){var l,g,d,p,x,b,D,_,C,y,B,G=0,F=0;for(C=0;C<A;C++){for(x=0,y=0;y<o;y++){for(b=f[x++],D=f[x++],_=G+4*b|0,l=g=d=p=0;D>0;D--)p=p+(B=f[x++])*e[_+3]|0,d=d+B*e[_+2]|0,g=g+B*e[_+1]|0,l=l+B*e[_]|0,_=_+4|0;l>>=7,g>>=7,d>>=7,t[F+3]=E(8192+(p>>=7)>>14),t[F+2]=E(d+8192>>14),t[F+1]=E(g+8192>>14),t[F]=E(l+8192>>14),F=F+4*A|0}F=4*(C+1)|0,G=(C+1)*c*4|0}},convolveHorWithPre:function r(e,t,c,A,o,f){var l,g,d,p,x,b,D,_,C,y,B,G,F=0,H=0;for(y=0;y<A;y++){for(b=0,B=0;B<o;B++){for(D=f[b++],_=f[b++],C=F+4*D|0,l=g=d=p=0;_>0;_--)p=p+(G=f[b++])*(x=e[C+3])|0,d=d+G*e[C+2]*x|0,g=g+G*e[C+1]*x|0,l=l+G*e[C]*x|0,C=C+4|0;d=d/255|0,g=g/255|0,l=l/255|0,t[H+3]=v(p>>7),t[H+2]=v(d>>7),t[H+1]=v(g>>7),t[H]=v(l>>7),H=H+4*A|0}H=4*(y+1)|0,F=(y+1)*c*4|0}},convolveVertWithPre:function s(e,t,c,A,o,f){var l,g,d,p,x,b,D,_,C,y,B,G=0,F=0;for(C=0;C<A;C++){for(x=0,y=0;y<o;y++){for(b=f[x++],D=f[x++],_=G+4*b|0,l=g=d=p=0;D>0;D--)p=p+(B=f[x++])*e[_+3]|0,d=d+B*e[_+2]|0,g=g+B*e[_+1]|0,l=l+B*e[_]|0,_=_+4|0;l>>=7,g>>=7,d>>=7,(p=E(8192+(p>>=7)>>14))>0&&(l=255*l/p|0,g=255*g/p|0,d=255*d/p|0),t[F+3]=p,t[F+2]=E(d+8192>>14),t[F+1]=E(g+8192>>14),t[F]=E(l+8192>>14),F=F+4*A|0}F=4*(C+1)|0,G=(C+1)*c*4|0}}}},{}],3:[function(Q,w,O){"use strict";w.exports="AGFzbQEAAAAADAZkeWxpbmsAAAAAAAEYA2AGf39/f39/AGAAAGAIf39/f39/f38AAg8BA2VudgZtZW1vcnkCAAADBwYBAAAAAAIGBgF/AEEACweUAQgRX193YXNtX2NhbGxfY3RvcnMAAAtjb252b2x2ZUhvcgABDGNvbnZvbHZlVmVydAACEmNvbnZvbHZlSG9yV2l0aFByZQADE2NvbnZvbHZlVmVydFdpdGhQcmUABApjb252b2x2ZUhWAAUMX19kc29faGFuZGxlAwAYX193YXNtX2FwcGx5X2RhdGFfcmVsb2NzAAAKyA4GAwABC4wDARB/AkAgA0UNACAERQ0AIANBAnQhFQNAQQAhE0EAIQsDQCALQQJqIQcCfyALQQF0IAVqIgYuAQIiC0UEQEEAIQhBACEGQQAhCUEAIQogBwwBCyASIAYuAQBqIQhBACEJQQAhCiALIRRBACEOIAchBkEAIQ8DQCAFIAZBAXRqLgEAIhAgACAIQQJ0aigCACIRQRh2bCAPaiEPIBFB/wFxIBBsIAlqIQkgEUEQdkH/AXEgEGwgDmohDiARQQh2Qf8BcSAQbCAKaiEKIAhBAWohCCAGQQFqIQYgFEEBayIUDQALIAlBB3UhCCAKQQd1IQYgDkEHdSEJIA9BB3UhCiAHIAtqCyELIAEgDEEBdCIHaiAIQQAgCEEAShs7AQAgASAHQQJyaiAGQQAgBkEAShs7AQAgASAHQQRyaiAJQQAgCUEAShs7AQAgASAHQQZyaiAKQQAgCkEAShs7AQAgDCAVaiEMIBNBAWoiEyAERw0ACyANQQFqIg0gAmwhEiANQQJ0IQwgAyANRw0ACwsL2gMBD38CQCADRQ0AIARFDQAgAkECdCEUA0AgCyEMQQAhE0EAIQIDQCACQQJqIQYCfyACQQF0IAVqIgcuAQIiAkUEQEEAIQhBACEHQQAhCkEAIQkgBgwBCyAHLgEAQQJ0IBJqIQhBACEJIAIhCkEAIQ0gBiEHQQAhDkEAIQ8DQCAFIAdBAXRqLgEAIhAgACAIQQF0IhFqLwEAbCAJaiEJIAAgEUEGcmovAQAgEGwgDmohDiAAIBFBBHJqLwEAIBBsIA9qIQ8gACARQQJyai8BACAQbCANaiENIAhBBGohCCAHQQFqIQcgCkEBayIKDQALIAlBB3UhCCANQQd1IQcgDkEHdSEKIA9BB3UhCSACIAZqCyECIAEgDEECdGogB0GAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQQh0QYD+A3EgCUGAQGtBDnUiBkH/ASAGQf8BSBsiBkEAIAZBAEobQRB0QYCA/AdxIApBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG0EYdHJyIAhBgEBrQQ51IgZB/wEgBkH/AUgbIgZBACAGQQBKG3I2AgAgAyAMaiEMIBNBAWoiEyAERw0ACyAUIAtBAWoiC2whEiADIAtHDQALCwuSAwEQfwJAIANFDQAgBEUNACADQQJ0IRUDQEEAIRNBACEGA0AgBkECaiEIAn8gBkEBdCAFaiIGLgECIgdFBEBBACEJQQAhDEEAIQ1BACEOIAgMAQsgEiAGLgEAaiEJQQAhDkEAIQ1BACEMIAchFEEAIQ8gCCEGA0AgBSAGQQF0ai4BACAAIAlBAnRqKAIAIhBBGHZsIhEgD2ohDyARIBBBEHZB/wFxbCAMaiEMIBEgEEEIdkH/AXFsIA1qIQ0gESAQQf8BcWwgDmohDiAJQQFqIQkgBkEBaiEGIBRBAWsiFA0ACyAPQQd1IQkgByAIagshBiABIApBAXQiCGogDkH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEECcmogDUH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEEcmogDEH/AW1BB3UiB0EAIAdBAEobOwEAIAEgCEEGcmogCUEAIAlBAEobOwEAIAogFWohCiATQQFqIhMgBEcNAAsgC0EBaiILIAJsIRIgC0ECdCEKIAMgC0cNAAsLC4IEAQ9/AkAgA0UNACAERQ0AIAJBAnQhFANAIAshDEEAIRJBACEHA0AgB0ECaiEKAn8gB0EBdCAFaiICLgECIhNFBEBBACEIQQAhCUEAIQYgCiEHQQAMAQsgAi4BAEECdCARaiEJQQAhByATIQJBACENIAohBkEAIQ5BACEPA0AgBSAGQQF0ai4BACIIIAAgCUEBdCIQai8BAGwgB2ohByAAIBBBBnJqLwEAIAhsIA5qIQ4gACAQQQRyai8BACAIbCAPaiEPIAAgEEECcmovAQAgCGwgDWohDSAJQQRqIQkgBkEBaiEGIAJBAWsiAg0ACyAHQQd1IQggDUEHdSEJIA9BB3UhBiAKIBNqIQcgDkEHdQtBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKGyIKQf8BcQRAIAlB/wFsIAJtIQkgCEH/AWwgAm0hCCAGQf8BbCACbSEGCyABIAxBAnRqIAlBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EIdEGA/gNxIAZBgEBrQQ51IgJB/wEgAkH/AUgbIgJBACACQQBKG0EQdEGAgPwHcSAKQRh0ciAIQYBAa0EOdSICQf8BIAJB/wFIGyICQQAgAkEAShtycjYCACADIAxqIQwgEkEBaiISIARHDQALIBQgC0EBaiILbCERIAMgC0cNAAsLC0AAIAcEQEEAIAIgAyAEIAUgABADIAJBACAEIAUgBiABEAQPC0EAIAIgAyAEIAUgABABIAJBACAEIAUgBiABEAIL"},{}],4:[function(Q,w,O){"use strict";w.exports={name:"resize",fn:Q("./resize"),wasm_fn:Q("./resize_wasm"),wasm_src:Q("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(Q,w,O){"use strict";var E=Q("./resize_filter_gen"),v=Q("./convolve"),n=v.convolveHor,i=v.convolveVert,r=v.convolveHorWithPre,s=v.convolveVertWithPre;w.exports=function(A){var o=A.src,f=A.width,l=A.height,g=A.toWidth,d=A.toHeight,p=A.scaleX||A.toWidth/A.width,x=A.scaleY||A.toHeight/A.height,b=A.offsetX||0,D=A.offsetY||0,_=A.dest||new Uint8Array(g*d*4),C=typeof A.filter>"u"?"mks2013":A.filter,y=E(C,f,g,p,b),B=E(C,l,d,x,D),G=new Uint16Array(g*l*4);return function e(c,A,o){for(var f=3,l=A*o*4|0;f<l;){if(255!==c[f])return!0;f=f+4|0}return!1}(o,f,l)?(r(o,G,f,l,g,y),s(G,_,l,g,d,B)):(n(o,G,f,l,g,y),i(G,_,l,g,d,B),function t(c,A,o){for(var f=3,l=A*o*4|0;f<l;)c[f]=255,f=f+4|0}(_,g,d)),_}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(Q,w,O){"use strict";var E=Q("./resize_filter_info");function n(i){return Math.round(16383*i)}w.exports=function(r,s,e,t,c){var g,d,p,x,b,D,_,C,y,B,G,F,H,P,a,u,A=E.filter[r].fn,o=1/t,f=Math.min(1,t),l=E.filter[r].win/f,m=Math.floor(2*(l+1)),I=new Int16Array((m+2)*e),R=0,U=!I.subarray||!I.set;for(g=0;g<e;g++){for(d=(g+.5)*o+c,p=Math.max(0,Math.floor(d-l)),b=(x=Math.min(s-1,Math.ceil(d+l)))-p+1,D=new Float32Array(b),_=new Int16Array(b),C=0,y=p,B=0;y<=x;y++,B++)C+=G=A((y+.5-d)*f),D[B]=G;for(F=0,B=0;B<D.length;B++)F+=H=D[B]/C,_[B]=n(H);for(_[e>>1]+=n(1-F),P=0;P<_.length&&0===_[P];)P++;if(P<_.length){for(a=_.length-1;a>0&&0===_[a];)a--;if(u=a-P+1,I[R++]=p+P,I[R++]=u,U)for(B=P;B<=a;B++)I[R++]=_[B];else I.set(_.subarray(P,a+1),R),R+=u}else I[R++]=0,I[R++]=0}return I}},{"./resize_filter_info":7}],7:[function(Q,w,O){"use strict";w.exports={filter:{box:{win:.5,fn:function(n){return n<0&&(n=-n),n<.5?1:0}},hamming:{win:1,fn:function(n){if(n<0&&(n=-n),n>=1)return 0;if(n<1.1920929e-7)return 1;var i=n*Math.PI;return Math.sin(i)/i*(.54+.46*Math.cos(i/1))}},lanczos2:{win:2,fn:function(n){if(n<0&&(n=-n),n>=2)return 0;if(n<1.1920929e-7)return 1;var i=n*Math.PI;return Math.sin(i)/i*Math.sin(i/2)/(i/2)}},lanczos3:{win:3,fn:function(n){if(n<0&&(n=-n),n>=3)return 0;if(n<1.1920929e-7)return 1;var i=n*Math.PI;return Math.sin(i)/i*Math.sin(i/3)/(i/3)}},mks2013:{win:2.5,fn:function(n){return n<0&&(n=-n),n>=2.5?0:n>=1.5?-.125*(n-2.5)*(n-2.5):n>=.5?.25*(4*n*n-11*n+7):1.0625-1.75*n*n}}},f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(Q,w,O){"use strict";var E=Q("./resize_filter_gen");var r=!0;try{r=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch{}function s(e,t,c){if(r)t.set(function i(e){return new Uint8Array(e.buffer,0,e.byteLength)}(e),c);else for(var A=c,o=0;o<e.length;o++){var f=e[o];t[A++]=255&f,t[A++]=f>>8&255}}w.exports=function(t){var c=t.src,A=t.width,o=t.height,f=t.toWidth,l=t.toHeight,g=t.scaleX||t.toWidth/t.width,d=t.scaleY||t.toHeight/t.height,p=t.offsetX||0,x=t.offsetY||0,b=t.dest||new Uint8Array(f*l*4),D=typeof t.filter>"u"?"mks2013":t.filter,_=E(D,A,f,g,p),C=E(D,o,l,d,x),B=Math.max(c.byteLength,b.byteLength),G=this.__align(0+B),H=this.__align(G+o*f*4*2),P=this.__align(H+_.byteLength),h=this.__instance("resize",P+C.byteLength),u=new Uint8Array(this.__memory.buffer),m=new Uint32Array(this.__memory.buffer),I=new Uint32Array(c.buffer);m.set(I),s(_,u,H),s(C,u,P);var R=h.exports.convolveHV||h.exports._convolveHV;return function v(e,t,c){for(var A=3,o=t*c*4|0;A<o;){if(255!==e[A])return!0;A=A+4|0}return!1}(c,A,o)?R(H,P,G,A,o,f,l,1):(R(H,P,G,A,o,f,l,0),function n(e,t,c){for(var A=3,o=t*c*4|0;A<o;)e[A]=255,A=A+4|0}(b,f,l)),new Uint32Array(b.buffer).set(new Uint32Array(this.__memory.buffer,0,l*f)),b}},{"./resize_filter_gen":6}],9:[function(Q,w,O){"use strict";w.exports={name:"unsharp_mask",fn:Q("./unsharp_mask"),wasm_fn:Q("./unsharp_mask_wasm"),wasm_src:Q("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(Q,w,O){"use strict";var E=Q("glur/mono16");w.exports=function(i,r,s,e,t,c){var A,o,f,l,g;if(!(0===e||t<.5)){t>2&&(t=2);var d=function v(n,i,r){for(var t,c,A,s=i*r,e=new Uint16Array(s),f=0;f<s;f++)A=n[4*f+2],e[f]=((t=n[4*f])>=(c=n[4*f+1])&&t>=A?t:c>=A&&c>=t?c:A)<<8;return e}(i,r,s),p=new Uint16Array(d);E(p,r,s,t);for(var x=e/100*4096+.5|0,b=c<<8,D=r*s,_=0;_<D;_++)l=(A=d[_])-p[_],Math.abs(l)>=b&&(i[g=4*_]=i[g]*(f=((o=(o=(o=A+(x*l+2048>>12))>65280?65280:o)<0?0:o)<<12)/(A=0!==A?A:1)|0)+2048>>12,i[g+1]=i[g+1]*f+2048>>12,i[g+2]=i[g+2]*f+2048>>12)}}},{"glur/mono16":18}],11:[function(Q,w,O){"use strict";w.exports=function(v,n,i,r,s,e){if(!(0===r||s<.5)){s>2&&(s=2);var t=n*i,c=4*t,A=2*t,o=2*t,f=4*Math.max(n,i),d=c,p=d+A,x=p+o,b=x+o,D=b+f,_=this.__instance("unsharp_mask",c+A+2*o+f+32,{exp:Math.exp}),C=new Uint32Array(v.buffer);new Uint32Array(this.__memory.buffer).set(C);var B=_.exports.hsv_v16||_.exports._hsv_v16;B(0,d,n,i),(B=_.exports.blurMono16||_.exports._blurMono16)(d,p,x,b,D,n,i,s),(B=_.exports.unsharp||_.exports._unsharp)(0,0,d,p,n,i,r,e),C.set(new Uint32Array(this.__memory.buffer,0,t))}}},{}],12:[function(Q,w,O){"use strict";w.exports="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"},{}],13:[function(Q,w,O){"use strict";function v(n,i){this.create=n,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=i||2e3}v.prototype.acquire=function(){var i,n=this;return 0!==this.available.length?i=this.available.pop():((i=this.create()).id=this.lastId++,i.release=function(){return n.release(i)}),this.acquired[i.id]=i,i},v.prototype.release=function(n){var i=this;delete this.acquired[n.id],n.lastUsed=Date.now(),this.available.push(n),0===this.timeoutId&&(this.timeoutId=setTimeout(function(){return i.gc()},100))},v.prototype.gc=function(){var n=this,i=Date.now();this.available=this.available.filter(function(r){return!(i-r.lastUsed>n.idle&&(r.destroy(),1))}),this.timeoutId=0!==this.available.length?setTimeout(function(){return n.gc()},100):0},w.exports=v},{}],14:[function(Q,w,O){"use strict";w.exports=function(n,i,r,s,e,t){var o=(2*t+2+1)/e;if(o>.5)return[[r,s]];var f=Math.ceil(Math.log(Math.min(r/n,s/i))/Math.log(o));if(f<=1)return[[r,s]];for(var l=[],g=0;g<f;g++){var d=Math.round(Math.pow(Math.pow(n,f-g-1)*Math.pow(r,g+1),1/f)),p=Math.round(Math.pow(Math.pow(i,f-g-1)*Math.pow(s,g+1),1/f));l.push([d,p])}return l}},{}],15:[function(Q,w,O){"use strict";var E=1e-5;function v(i){var r=Math.round(i);return Math.abs(i-r)<E?r:Math.floor(i)}function n(i){var r=Math.round(i);return Math.abs(i-r)<E?r:Math.ceil(i)}w.exports=function(r){var s=r.toWidth/r.width,e=r.toHeight/r.height,t=v(r.srcTileSize*s)-2*r.destTileBorder,c=v(r.srcTileSize*e)-2*r.destTileBorder;if(t<1||c<1)throw new Error("Internal error in pica: target tile width/height is too small.");var A,o,f,l,g,d,x,p=[];for(l=0;l<r.toHeight;l+=c)for(f=0;f<r.toWidth;f+=t)(A=f-r.destTileBorder)<0&&(A=0),A+(g=f+t+r.destTileBorder-A)>=r.toWidth&&(g=r.toWidth-A),(o=l-r.destTileBorder)<0&&(o=0),o+(d=l+c+r.destTileBorder-o)>=r.toHeight&&(d=r.toHeight-o),x={toX:A,toY:o,toWidth:g,toHeight:d,toInnerX:f,toInnerY:l,toInnerWidth:t,toInnerHeight:c,offsetX:A/s-v(A/s),offsetY:o/e-v(o/e),scaleX:s,scaleY:e,x:v(A/s),y:v(o/e),width:n(g/s),height:n(d/e)},p.push(x);return p}},{}],16:[function(Q,w,O){"use strict";function E(v){return Object.prototype.toString.call(v)}w.exports.isCanvas=function(n){var i=E(n);return"[object HTMLCanvasElement]"===i||"[object OffscreenCanvas]"===i||"[object Canvas]"===i},w.exports.isImage=function(n){return"[object HTMLImageElement]"===E(n)},w.exports.isImageBitmap=function(n){return"[object ImageBitmap]"===E(n)},w.exports.limiter=function(n){var i=0,r=[];function s(){i<n&&r.length&&(i++,r.shift()())}return function(t){return new Promise(function(c,A){r.push(function(){t().then(function(o){c(o),i--,s()},function(o){A(o),i--,s()})}),s()})}},w.exports.cib_quality_name=function(n){switch(n){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},w.exports.cib_support=function(n){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var i=n(100,100);return createImageBitmap(i,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(r){var s=10===r.width;return r.close(),i=null,s})}).catch(function(){return!1})},w.exports.worker_offscreen_canvas_support=function(){return new Promise(function(n,i){if(typeof OffscreenCanvas>"u")n(!1);else{var s=btoa("(".concat(function r(t){typeof createImageBitmap>"u"?t.postMessage(!1):Promise.resolve().then(function(){var c=new OffscreenCanvas(10,10);return c.getContext("2d").rect(0,0,1,1),createImageBitmap(c,0,0,1,1)}).then(function(){return t.postMessage(!0)},function(){return t.postMessage(!1)})}.toString(),")(self);")),e=new Worker("data:text/javascript;base64,".concat(s));e.onmessage=function(t){return n(t.data)},e.onerror=i}}).then(function(n){return n},function(){return!1})},w.exports.can_use_canvas=function(n){var i=!1;try{var s=n(2,1).getContext("2d"),e=s.createImageData(2,1);e.data[0]=12,e.data[1]=23,e.data[2]=34,e.data[3]=255,e.data[4]=45,e.data[5]=56,e.data[6]=67,e.data[7]=255,s.putImageData(e,0,0),e=null,12===(e=s.getImageData(0,0,2,1)).data[0]&&23===e.data[1]&&34===e.data[2]&&255===e.data[3]&&45===e.data[4]&&56===e.data[5]&&67===e.data[6]&&255===e.data[7]&&(i=!0)}catch{}return i},w.exports.cib_can_use_region=function(){return new Promise(function(n){if(typeof Image>"u"||typeof createImageBitmap>"u")n(!1);else{var i=new Image;i.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",i.onload=function(){createImageBitmap(i,0,0,i.width,i.height).then(function(r){n(r.width===i.width&&r.height===i.height)},function(){return n(!1)})},i.onerror=function(){return n(!1)}}})}},{}],17:[function(Q,w,O){"use strict";w.exports=function(){var v,E=Q("./mathlib");onmessage=function(i){var r=i.data.opts;if(!r.src&&r.srcBitmap){var e=new OffscreenCanvas(r.width,r.height),t=e.getContext("2d");t.drawImage(r.srcBitmap,0,0),r.src=t.getImageData(0,0,r.width,r.height).data,e.width=e.height=0,e=null,r.srcBitmap.close(),r.srcBitmap=null}v||(v=new E(i.data.features));var c=v.resizeAndUnsharp(r);postMessage({data:c},[c.buffer])}}},{"./mathlib":1}],18:[function(Q,w,O){var E,v,n,i,r,s;function A(f,l,g,d,p,x){var b,D,_,C,y,B,G,F,H,P,a,h,u,m;for(H=0;H<x;H++){for(G=H,F=0,C=y=(b=f[B=H*p])*d[6],a=d[0],h=d[1],u=d[4],m=d[5],P=0;P<p;P++)_=(D=f[B])*a+b*h+C*u+y*m,y=C,b=D,g[F]=C=_,F++,B++;for(F--,G+=x*(p-1),C=y=(b=f[--B])*d[7],D=b,a=d[2],h=d[3],P=p-1;P>=0;P--)_=D*a+b*h+C*u+y*m,y=C,b=D,D=f[B],l[G]=g[F]+(C=_),B--,F--,G-=x}}w.exports=function o(f,l,g,d){if(d){var p=new Uint16Array(f.length),x=new Float32Array(Math.max(l,g)),b=function c(f){f<.5&&(f=.5);var l=Math.exp(.527076)/f,g=Math.exp(-l),d=Math.exp(-2*l),p=(1-g)*(1-g)/(1+2*l*g-d);return E=p,v=p*(l-1)*g,n=p*(l+1)*g,i=-p*d,r=2*g,s=-d,new Float32Array([E,v,n,i,r,s,(E+v)/(1-r-s),(n+i)/(1-r-s)])}(d);A(f,p,x,b,l,g),A(p,f,x,b,g,l)}}},{}],19:[function(Q,w,O){"use strict";var E=Q("object-assign"),v=Q("./lib/base64decode"),n=Q("./lib/wa_detect"),i={js:!0,wasm:!0};function r(s){if(!(this instanceof r))return new r(s);var e=E({},i,s||{});if(this.options=e,this.__cache={},this.__init_promise=null,this.__modules=e.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}r.prototype.has_wasm=n,r.prototype.use=function(s){return this.__modules[s.name]=s,this[s.name]=this.options.wasm&&this.has_wasm()&&s.wasm_fn?s.wasm_fn:s.fn,this},r.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var s=this;return this.__init_promise=Promise.all(Object.keys(s.__modules).map(function(e){var t=s.__modules[e];return s.options.wasm&&s.has_wasm()&&t.wasm_fn&&!s.__wasm[e]?WebAssembly.compile(s.__base64decode(t.wasm_src)).then(function(c){s.__wasm[e]=c}):null})).then(function(){return s}),this.__init_promise},r.prototype.__base64decode=v,r.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var t=this.__memory.buffer.byteLength;return t<e&&this.__memory.grow(Math.ceil((e-t)/65536)),this.__memory},r.prototype.__instance=function(e,t,c){if(t&&this.__reallocate(t),this.__wasm[e]||(this.__wasm[e]=new WebAssembly.Module(this.__base64decode(this.__modules[e].wasm_src))),!this.__cache[e]){var o={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[e]=new WebAssembly.Instance(this.__wasm[e],{env:E(o,c||{})})}return this.__cache[e]},r.prototype.__align=function(e,t){var c=e%(t=t||8);return e+(c?t-c:0)},w.exports=r},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(Q,w,O){"use strict";w.exports=function(n){for(var i=n.replace(/[\r\n=]/g,""),r=i.length,s=new Uint8Array(3*r>>2),e=0,t=0,c=0;c<r;c++)c%4==0&&c&&(s[t++]=e>>16&255,s[t++]=e>>8&255,s[t++]=255&e),e=e<<6|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(i.charAt(c));var A=r%4*6;return 0===A?(s[t++]=e>>16&255,s[t++]=e>>8&255,s[t++]=255&e):18===A?(s[t++]=e>>10&255,s[t++]=e>>2&255):12===A&&(s[t++]=e>>4&255),s}},{}],21:[function(Q,w,O){"use strict";var E;w.exports=function(){if(typeof E<"u"||(E=!1,typeof WebAssembly>"u"))return E;try{var n=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),i=new WebAssembly.Module(n);return 0!==new WebAssembly.Instance(i,{}).exports.test(4)&&(E=!0),E}catch{}return E}},{}],22:[function(Q,w,O){"use strict";var E=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;w.exports=function r(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de","5"===Object.getOwnPropertyNames(s)[0])return!1;for(var e={},t=0;t<10;t++)e["_"+String.fromCharCode(t)]=t;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(o){return e[o]}).join(""))return!1;var A={};return"abcdefghijklmnopqrst".split("").forEach(function(o){A[o]=o}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},A)).join("")}catch{return!1}}()?Object.assign:function(s,e){for(var t,A,c=function i(s){if(null==s)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}(s),o=1;o<arguments.length;o++){for(var f in t=Object(arguments[o]))v.call(t,f)&&(c[f]=t[f]);if(E){A=E(t);for(var l=0;l<A.length;l++)n.call(t,A[l])&&(c[A[l]]=t[A[l]])}}return c}},{}],23:[function(Q,w,O){var E=arguments[3],v=arguments[4],n=arguments[5],i=JSON.stringify;w.exports=function(r,s){for(var e,t=Object.keys(n),c=0,A=t.length;c<A;c++){var f=n[o=t[c]].exports;if(f===r||f&&f.default===r){e=o;break}}if(!e){e=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var l={};for(c=0,A=t.length;c<A;c++){var o;l[o=t[c]]=o}v[e]=["function(require,module,exports){"+r+"(self); }",l]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),d={};d[e]=e,v[g]=["function(require,module,exports){var f = require("+i(e)+");(f.default ? f.default : f)(self);}",d];var p={};!function x(B){for(var G in p[B]=!0,v[B][1]){var F=v[B][1][G];p[F]||x(F)}}(g);var b="("+E+")({"+Object.keys(p).map(function(B){return i(B)+":["+v[B][0]+","+i(v[B][1])+"]"}).join(",")+"},{},["+i(g)+"])",D=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([b],{type:"text/javascript"});if(s&&s.bare)return _;var C=D.createObjectURL(_),y=new Worker(C);return y.objectURL=C,y}},{}],"/index.js":[function(Q,w,O){"use strict";function E(a,h){return function s(a){if(Array.isArray(a))return a}(a)||function r(a,h){var u=null==a?null:typeof Symbol<"u"&&a[Symbol.iterator]||a["@@iterator"];if(null!=u){var U,k,m=[],I=!0,R=!1;try{for(u=u.call(a);!(I=(U=u.next()).done)&&(m.push(U.value),!h||m.length!==h);I=!0);}catch(S){R=!0,k=S}finally{try{!I&&null!=u.return&&u.return()}finally{if(R)throw k}}return m}}(a,h)||function n(a,h){if(a){if("string"==typeof a)return i(a,h);var u=Object.prototype.toString.call(a).slice(8,-1);if("Object"===u&&a.constructor&&(u=a.constructor.name),"Map"===u||"Set"===u)return Array.from(a);if("Arguments"===u||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u))return i(a,h)}}(a,h)||function v(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(a,h){(null==h||h>a.length)&&(h=a.length);for(var u=0,m=new Array(h);u<h;u++)m[u]=a[u];return m}var e=Q("object-assign"),t=Q("webworkify"),c=Q("./lib/mathlib"),A=Q("./lib/pool"),o=Q("./lib/utils"),f=Q("./lib/worker"),l=Q("./lib/stepper"),g=Q("./lib/tiler"),d=Q("./lib/mm_resize/resize_filter_info"),p={},x=!1;try{typeof navigator<"u"&&navigator.userAgent&&(x=navigator.userAgent.indexOf("Safari")>=0)}catch{}var b=1;typeof navigator<"u"&&(b=Math.min(navigator.hardwareConcurrency||1,4));var D={tile:1024,concurrency:b,features:["js","wasm","ww"],idle:2e3,createCanvas:function(h,u){var m=document.createElement("canvas");return m.width=h,m.height=u,m}},_={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},C=!1,y=!1,B=!1,G=!1,F=!1;function H(){return{value:t(f),destroy:function(){if(this.value.terminate(),typeof window<"u"){var h=window.URL||window.webkitURL||window.mozURL||window.msURL;h&&h.revokeObjectURL&&this.value.objectURL&&h.revokeObjectURL(this.value.objectURL)}}}}function P(a){if(!(this instanceof P))return new P(a);this.options=e({},D,a||{});var h="lk_".concat(this.options.concurrency);this.__limit=p[h]||o.limiter(this.options.concurrency),p[h]||(p[h]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}P.prototype.init=function(){var a=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),C=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?y=!0:this.debug("ImageBitmap does not support .close(), disabled"));var h=this.options.features.slice();if(h.indexOf("all")>=0&&(h=["cib","wasm","js","ww"]),this.__requested_features=h,this.__mathlib=new c(h),h.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{Q("webworkify")(function(){}).terminate(),this.features.ww=!0;var m="wp_".concat(JSON.stringify(this.options));p[m]?this.__workersPool=p[m]:(this.__workersPool=new A(H,this.options.idle),p[m]=this.__workersPool)}catch{}var R,U,I=this.__mathlib.init().then(function(S){e(a.features,S.features)});R=y?o.cib_support(this.options.createCanvas).then(function(S){a.features.cib&&h.indexOf("cib")<0?a.debug("createImageBitmap() resize supported, but disabled by config"):h.indexOf("cib")>=0&&(a.features.cib=S)}):Promise.resolve(!1),B=o.can_use_canvas(this.options.createCanvas),U=(U=y&&C&&-1!==h.indexOf("ww")?o.worker_offscreen_canvas_support():Promise.resolve(!1)).then(function(S){G=S});var k=o.cib_can_use_region().then(function(S){F=S});return this.__initPromise=Promise.all([I,R,U,k]).then(function(){return a}),this.__initPromise},P.prototype.__invokeResize=function(a,h){var u=this;return h.__mathCache=h.__mathCache||{},Promise.resolve().then(function(){return u.features.ww?new Promise(function(m,I){var R=u.__workersPool.acquire();h.cancelToken&&h.cancelToken.catch(function(k){return I(k)}),R.value.onmessage=function(k){R.release(),k.data.err?I(k.data.err):m(k.data)};var U=[];a.src&&U.push(a.src.buffer),a.srcBitmap&&U.push(a.srcBitmap),R.value.postMessage({opts:a,features:u.__requested_features,preload:{wasm_nodule:u.__mathlib.__}},U)}):{data:u.__mathlib.resizeAndUnsharp(a,h.__mathCache)}})},P.prototype.__extractTileData=function(a,h,u,m,I){if(this.features.ww&&G&&(o.isCanvas(h)||F))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(m.srcImageBitmap||h,a.x,a.y,a.width,a.height).then(function(k){return I.srcBitmap=k,I});if(o.isCanvas(h))return m.srcCtx||(m.srcCtx=h.getContext("2d")),this.debug("Get tile pixel data"),I.src=m.srcCtx.getImageData(a.x,a.y,a.width,a.height).data,I;this.debug("Draw tile imageBitmap/image to temporary canvas");var R=this.options.createCanvas(a.width,a.height),U=R.getContext("2d");return U.globalCompositeOperation="copy",U.drawImage(m.srcImageBitmap||h,a.x,a.y,a.width,a.height,0,0,a.width,a.height),this.debug("Get tile pixel data"),I.src=U.getImageData(0,0,a.width,a.height).data,R.width=R.height=0,I},P.prototype.__landTileData=function(a,h,u){var m;if(this.debug("Convert raw rgba tile result to ImageData"),h.bitmap)return u.toCtx.drawImage(h.bitmap,a.toX,a.toY),null;if(C)m=new ImageData(new Uint8ClampedArray(h.data),a.toWidth,a.toHeight);else if((m=u.toCtx.createImageData(a.toWidth,a.toHeight)).data.set)m.data.set(h.data);else for(var I=m.data.length-1;I>=0;I--)m.data[I]=h.data[I];return this.debug("Draw tile"),x?u.toCtx.putImageData(m,a.toX,a.toY,a.toInnerX-a.toX,a.toInnerY-a.toY,a.toInnerWidth+1e-5,a.toInnerHeight+1e-5):u.toCtx.putImageData(m,a.toX,a.toY,a.toInnerX-a.toX,a.toInnerY-a.toY,a.toInnerWidth,a.toInnerHeight),null},P.prototype.__tileAndResize=function(a,h,u){var m=this,I={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null};return Promise.resolve().then(function(){if(I.toCtx=h.getContext("2d"),o.isCanvas(a))return null;if(o.isImageBitmap(a))return I.srcImageBitmap=a,I.isImageBitmapReused=!0,null;if(o.isImage(a))return y?(m.debug("Decode image via createImageBitmap"),createImageBitmap(a).then(function(U){I.srcImageBitmap=U}).catch(function(U){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(u.canceled)return u.cancelToken;m.debug("Calculate tiles");var k=g({width:u.width,height:u.height,srcTileSize:m.options.tile,toWidth:u.toWidth,toHeight:u.toHeight,destTileBorder:u.__destTileBorder}).map(function(T){return function(k){return m.__limit(function(){if(u.canceled)return u.cancelToken;var S={width:k.width,height:k.height,toWidth:k.toWidth,toHeight:k.toHeight,scaleX:k.scaleX,scaleY:k.scaleY,offsetX:k.offsetX,offsetY:k.offsetY,filter:u.filter,unsharpAmount:u.unsharpAmount,unsharpRadius:u.unsharpRadius,unsharpThreshold:u.unsharpThreshold};return m.debug("Invoke resize math"),Promise.resolve(S).then(function(T){return m.__extractTileData(k,a,u,I,T)}).then(function(T){return m.debug("Invoke resize math"),m.__invokeResize(T,u)}).then(function(T){return u.canceled?u.cancelToken:(I.srcImageData=null,m.__landTileData(k,T,I))})})}(T)});function S(T){T.srcImageBitmap&&(T.isImageBitmapReused||T.srcImageBitmap.close(),T.srcImageBitmap=null)}return m.debug("Process tiles"),Promise.all(k).then(function(){return m.debug("Finished!"),S(I),h},function(T){throw S(I),T})})},P.prototype.__processStages=function(a,h,u,m){var I=this;if(m.canceled)return m.cancelToken;var Y,W,U=E(a.shift(),2),k=U[0],S=U[1],T=0===a.length;return Y=T||d.q2f.indexOf(m.filter)<0?m.filter:"box"===m.filter?"box":"hamming",m=e({},m,{toWidth:k,toHeight:S,filter:Y}),T||(W=this.options.createCanvas(k,S)),this.__tileAndResize(h,T?u:W,m).then(function(){return T?u:(m.width=k,m.height=S,I.__processStages(a,W,u,m))}).then(function(N){return W&&(W.width=W.height=0),N})},P.prototype.__resizeViaCreateImageBitmap=function(a,h,u){var m=this,I=h.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(a,{resizeWidth:u.toWidth,resizeHeight:u.toHeight,resizeQuality:o.cib_quality_name(d.f2q[u.filter])}).then(function(R){if(u.canceled)return u.cancelToken;if(!u.unsharpAmount)return I.drawImage(R,0,0),R.close(),I=null,m.debug("Finished!"),h;m.debug("Unsharp result");var U=m.options.createCanvas(u.toWidth,u.toHeight),k=U.getContext("2d");k.drawImage(R,0,0),R.close();var S=k.getImageData(0,0,u.toWidth,u.toHeight);return m.__mathlib.unsharp_mask(S.data,u.toWidth,u.toHeight,u.unsharpAmount,u.unsharpRadius,u.unsharpThreshold),I.putImageData(S,0,0),U.width=U.height=0,S=k=U=I=null,m.debug("Finished!"),h})},P.prototype.resize=function(a,h,u){var m=this;this.debug("Start resize...");var I=e({},_);if(isNaN(u)?u&&(I=e(I,u)):I=e(I,{quality:u}),I.toWidth=h.width,I.toHeight=h.height,I.width=a.naturalWidth||a.width,I.height=a.naturalHeight||a.height,Object.prototype.hasOwnProperty.call(I,"quality")){if(I.quality<0||I.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(I.quality));I.filter=d.q2f[I.quality]}return 0===h.width||0===h.height?Promise.reject(new Error("Invalid output size: ".concat(h.width,"x").concat(h.height))):(I.unsharpRadius>2&&(I.unsharpRadius=2),I.canceled=!1,I.cancelToken&&(I.cancelToken=I.cancelToken.then(function(U){throw I.canceled=!0,U},function(U){throw I.canceled=!0,U})),I.__destTileBorder=Math.ceil(Math.max(3,2.5*I.unsharpRadius|0)),this.init().then(function(){if(I.canceled)return I.cancelToken;if(m.features.cib){if(d.q2f.indexOf(I.filter)>=0)return m.__resizeViaCreateImageBitmap(a,h,I);m.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!B){var U=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw U.code="ERR_GET_IMAGE_DATA",U}var k=l(I.width,I.height,I.toWidth,I.toHeight,m.options.tile,I.__destTileBorder);return m.__processStages(k,a,h,I)}))},P.prototype.resizeBuffer=function(a){var h=this,u=e({},_,a);if(Object.prototype.hasOwnProperty.call(u,"quality")){if(u.quality<0||u.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(u.quality));u.filter=d.q2f[u.quality]}return this.init().then(function(){return h.__mathlib.resizeAndUnsharp(u)})},P.prototype.toBlob=function(a,h,u){return h=h||"image/png",new Promise(function(m){if(a.toBlob)a.toBlob(function(S){return m(S)},h,u);else if(a.convertToBlob)m(a.convertToBlob({type:h,quality:u}));else{for(var I=atob(a.toDataURL(h,u).split(",")[1]),R=I.length,U=new Uint8Array(R),k=0;k<R;k++)U[k]=I.charCodeAt(k);m(new Blob([U],{type:h}))}})},P.prototype.debug=function(){},w.exports=P},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")}}]);