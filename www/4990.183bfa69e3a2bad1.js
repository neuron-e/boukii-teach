"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4990],{4990:(U,C,o)=>{o.r(C),o.d(C,{StatsPageModule:()=>A});var m=o(177),k=o(9417),M=o(8974),f=o(3314),D=o(467),v=o(9403),p=o(7586),t=o(6996),E=o(5663),R=o(918),w=o(4387),_=o(5794),j=o(8551),b=o(1547);const P=function(i){return{"color-selected":i}};function $(i,l){if(1&i&&(t.j41(0,"div",27)(1,"div",28)(2,"div",29),t.EFF(3),t.k0s(),t.j41(4,"span",29),t.EFF(5),t.k0s()(),t.j41(6,"div",24),t.EFF(7),t.k0s(),t.j41(8,"div",24),t.EFF(9),t.k0s(),t.j41(10,"div",24),t.EFF(11),t.k0s()()),2&i){const c=l.$implicit,e=l.index,n=t.XpG();t.R7$(2),t.Y8G("ngClass",t.eq3(7,P,e>=n.currentEndIndex&&e<n.currentStartIndex)),t.R7$(1),t.JRh(c.name),t.R7$(1),t.Y8G("ngClass",t.eq3(9,P,e>=n.currentEndIndex&&e<n.currentStartIndex)),t.R7$(1),t.JRh(c.year),t.R7$(2),t.SpI(" ",c.collectiveCourses," "),t.R7$(2),t.SpI(" ",c.privateCourses," "),t.R7$(2),t.SpI(" ",c.blockPayed," ")}}const T=[{path:"",component:(()=>{var i;class l{constructor(e,n,a,r,u,h,s){this.router=e,this.monitorDataService=n,this.sharedDataService=a,this.teachService=r,this.toastr=u,this.spinnerService=h,this.translate=s,this.lineChartData={datasets:[{data:[80,72,39,37,35,31,36,46,39,37,35,31],label:"Heures",yAxisID:"y",backgroundColor:"rgba(51,153,255,0.4)",borderColor:"rgba(51,153,255,1)",pointBackgroundColor:"rgba(51,153,255,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(51,153,255,0.8)",fill:"origin"}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.lineChartOptions={elements:{line:{tension:.3}},scales:{y:{beginAtZero:!0,position:"left",min:0,grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"#c8c8c8"}},x:{ticks:{color:"#c8c8c8"},grid:{display:!1}}},plugins:{legend:{display:!0}}},this.lineChartType="line",this.selectedYear="year",this.currentStartIndex=3,this.currentEndIndex=0,this.hourStartDay="08:00",this.hourEndDay="18:00"}ngOnInit(){var e=this;return(0,D.A)(function*(){e.subscription=e.monitorDataService.getMonitorData().subscribe(function(){var n=(0,D.A)(function*(a){a&&(e.spinnerService.show(),e.monitorData=a,e.loadBookings(),e.spinnerService.hide())});return function(a){return n.apply(this,arguments)}}())})()}loadBookings(){const n=this.initializeMonthsData()[0],u={start_date:p(`${n.year}-${n.name}-01`,"YYYY-MMM-DD").startOf("month").format("YYYY-MM-DD"),end_date:p().format("YYYY-MM-DD")};this.monitorData.active_school&&(u.school_id=this.monitorData.active_school),this.teachService.getData("teach/statistics/monitors/daily",null,u).subscribe(h=>{this.monthsData=this.initializeMonthsData();let s=0,y=0,I=0;h.data.forEach(d=>{const N=p(d.date).format("MMM YYYY").toUpperCase(),g=this.monthsData.find(S=>`${S.name} ${S.year}`===N);if(!g)return;const x=this.parseDurationToMinutes(d.hours_collective),O=this.parseDurationToMinutes(d.hours_private),F=this.parseDurationToMinutes(d.hours_nwd_payed);g.collectiveCourses+=x,g.privateCourses+=O,g.blockPayed+=F,s+=x,y+=O,I+=F}),Object.keys(this.monthsData).forEach(d=>{this.monthsData[d].collectiveCourses=this.formatDuration(this.monthsData[d].collectiveCourses),this.monthsData[d].privateCourses=this.formatDuration(this.monthsData[d].privateCourses),this.monthsData[d].blockPayed=this.formatDuration(this.monthsData[d].blockPayed)}),this.totalCollectiveDurationFormatted=this.formatDuration(s),this.totalPrivateDurationFormatted=this.formatDuration(y),this.totalPayedDurationFormatted=this.formatDuration(I),this.totalNwdDurationFormatted=this.formatDuration(0),this.totalNotPayedDurationFormatted=this.formatDuration(0),this.reversedMonthsData=this.monthsData.slice().reverse(),this.updateChartData()},h=>{this.spinnerService.hide(),console.error("There was an error!",h)})}hoursToMinutes(e){return 60*e}durationInHours(e){const[n,a]=e.split("h").map(r=>parseInt(r,10));return n+a/60}changeMonths(e){this.currentEndIndex+e>=0&&this.currentStartIndex+e<=24&&(this.currentStartIndex+=e,this.currentEndIndex+=e,this.updateChartData())}updateChartData(){const e=this.monthsData.length-this.currentStartIndex,n=this.monthsData.length-this.currentEndIndex,a=this.monthsData.slice(e,n).map(s=>this.durationInHours(s.collectiveCourses)),r=this.monthsData.slice(e,n).map(s=>this.durationInHours(s.privateCourses)),u=this.monthsData.slice(e,n).map(s=>this.durationInHours(s.blockPayed)),h=this.monthsData.slice(e,n).map(s=>this.durationInHours(s.collectiveCourses)+this.durationInHours(s.privateCourses)+this.durationInHours(s.blockPayed));this.lineChartData.datasets=[{data:a,label:this.translate.instant("collective_courses"),yAxisID:"y",borderColor:"rgba(252,196,47,1)"},{data:r,label:this.translate.instant("private_courses"),yAxisID:"y",borderColor:"rgba(56,199,77,1)"},{data:u,label:this.translate.instant("paid_blocks"),yAxisID:"y",borderColor:"rgba(100,100,100,1)"},{data:h,label:this.translate.instant("total"),yAxisID:"y",borderColor:"rgba(51,153,255,1)"}],this.lineChartData.labels=this.monthsData.slice(e,n).map(s=>s.name),this.chart&&this.chart.update()}navigateToPreviousMonths(){this.currentStartIndex>0&&(this.currentStartIndex-=3,this.currentEndIndex-=3,this.updateChartData())}navigateToNextMonths(){this.currentEndIndex<this.monthsData.length&&(this.currentStartIndex+=3,this.currentEndIndex+=3,this.updateChartData())}initializeMonthsData(){const e=[];let n=p();for(let a=0;a<24;a++){const r=n.format("MMM YYYY").toUpperCase();e.unshift({name:r.split(" ")[0],year:r.split(" ")[1],collectiveCourses:0,privateCourses:0,blockNwd:0,blockPayed:0,blockNotPayed:0}),n.subtract(1,"months")}return e}calculateDuration(e,n){const[a,r]=e.split(":").map(Number),[u,h]=n.split(":").map(Number);return 60*(u-a)+(h-r)}parseDurationToMinutes(e){if(!e)return 0;const n=e.match(/(\d+)\s*h\s*(\d+)\s*m/i);if(!n)return 0;const a=Number(n[1]),r=Number(n[2]);return Number.isNaN(a)||Number.isNaN(r)?0:60*a+r}formatDuration(e){return`${Math.floor(e/60)}h${e%60}m`}updateChartDataB(){this.lineChartData="all"===this.selectedYear?{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31,80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC","JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]}:{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.chart&&this.chart.update()}goTo(...e){this.router.navigate(e)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(i=l).\u0275fac=function(e){return new(e||i)(t.rXU(f.Ix),t.rXU(E.O),t.rXU(R.H),t.rXU(w.R),t.rXU(_.tw),t.rXU(j.D),t.rXU(b.c$))},i.\u0275cmp=t.VBU({type:i,selectors:[["app-stats"]],viewQuery:function(e,n){if(1&e&&t.GBs(v.j9,5),2&e){let a;t.mGM(a=t.lsd())&&(n.chart=a.first)}},decls:61,vars:37,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-top"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/statistiques.png"],[1,"background-color-dark","padding-wrapper","mt-24","mb-24"],[1,"stats-titles","mb-24"],[1,"input-form-icon-b","background-grey-translucent"],[1,"montserrat"],[1,"stats-icons"],["src","assets/icon/icons-outline-arrow-left-2.svg",1,"cursor-pointer",3,"click"],["src","assets/icon/icons-outline-arrow-right-3-white.svg",1,"cursor-pointer",3,"click"],[1,"chart-scroll-wrapper"],["baseChart","",1,"chart-container",3,"data","options","type"],[1,"padding-wrapper"],[1,"cursor-pointer","menu-section-content","mb-12"],[1,"menu-section-title"],[1,"table-line","no-border","padding-wrapper","pb-8"],[1,"width-big"],[1,"width-small"],[1,"background-color-dark","padding-wrapper","table-wrapper"],[1,"table-line","table-line-total","pb-8","mb-8"],[1,"width-big","uppercase"],[1,"montserrat","width-small"],["class","table-line pb-8 mb-8",4,"ngFor","ngForOf"],[1,"table-line","table-line-total","pb-8","no-border"],[1,"table-line","pb-8","mb-8"],[1,"montserrat","width-big","table-line-text"],[3,"ngClass"]],template:function(e,n){1&e&&(t.j41(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),t.bIt("click",function(){return n.goTo("home")}),t.k0s(),t.j41(5,"div",4),t.nrm(6,"img",5),t.j41(7,"div"),t.EFF(8),t.nI1(9,"translate"),t.k0s()()()(),t.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9),t.EFF(14),t.nI1(15,"translate"),t.k0s()(),t.j41(16,"div",10)(17,"img",11),t.bIt("click",function(){return n.changeMonths(3)}),t.k0s(),t.j41(18,"img",12),t.bIt("click",function(){return n.changeMonths(-3)}),t.k0s()()(),t.j41(19,"div",13),t.nrm(20,"canvas",14),t.k0s()(),t.j41(21,"div",15)(22,"div",16)(23,"div",17),t.EFF(24),t.nI1(25,"translate"),t.k0s()(),t.j41(26,"div",18)(27,"div",19),t.EFF(28),t.nI1(29,"translate"),t.k0s(),t.j41(30,"div",20),t.EFF(31),t.nI1(32,"translate"),t.k0s(),t.j41(33,"div",20),t.EFF(34),t.nI1(35,"translate"),t.k0s(),t.j41(36,"div",20),t.EFF(37),t.nI1(38,"translate"),t.k0s()(),t.j41(39,"div",21)(40,"div",22)(41,"div",23),t.EFF(42),t.nI1(43,"translate"),t.k0s(),t.j41(44,"div",24),t.EFF(45),t.k0s(),t.j41(46,"div",24),t.EFF(47),t.k0s(),t.j41(48,"div",24),t.EFF(49),t.k0s()(),t.DNE(50,$,12,11,"div",25),t.j41(51,"div",26)(52,"div",23),t.EFF(53),t.nI1(54,"translate"),t.k0s(),t.j41(55,"div",24),t.EFF(56),t.k0s(),t.j41(57,"div",24),t.EFF(58),t.k0s(),t.j41(59,"div",24),t.EFF(60),t.k0s()()()()()()),2&e&&(t.R7$(8),t.JRh(t.bMT(9,19,"statistics")),t.R7$(6),t.SpI(" ",t.bMT(15,21,"total_hours")," "),t.R7$(6),t.Y8G("data",n.lineChartData)("options",n.lineChartOptions)("type",n.lineChartType),t.R7$(4),t.JRh(t.bMT(25,23,"activity_report")),t.R7$(4),t.SpI(" ",t.bMT(29,25,"month")," "),t.R7$(3),t.SpI(" ",t.bMT(32,27,"collective")," "),t.R7$(3),t.SpI(" ",t.bMT(35,29,"private")," "),t.R7$(3),t.SpI(" ",t.bMT(38,31,"block_paid_abbrev")," "),t.R7$(5),t.SpI(" ",t.bMT(43,33,"total")," "),t.R7$(3),t.SpI(" ",n.totalCollectiveDurationFormatted," "),t.R7$(2),t.SpI(" ",n.totalPrivateDurationFormatted," "),t.R7$(2),t.SpI(" ",n.totalPayedDurationFormatted," "),t.R7$(1),t.Y8G("ngForOf",n.reversedMonthsData),t.R7$(3),t.SpI(" ",t.bMT(54,35,"total")," "),t.R7$(3),t.SpI(" ",n.totalCollectiveDurationFormatted," "),t.R7$(2),t.SpI(" ",n.totalPrivateDurationFormatted," "),t.R7$(2),t.SpI(" ",n.totalPayedDurationFormatted," "))},dependencies:[m.YU,m.Sq,M.W9,v.j9,b.D9],styles:[".content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-side-img-b[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:20px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.menu-section-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.menu-section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.menu-section-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-primary);padding:5px 8px;border-radius:40px;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center}.menu-section-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.menu-section-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.menu-section-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.table-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;border-radius:8px}.table-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;border-bottom:1px solid #444953}.table-line-total[_ngcontent-%COMP%]{font-weight:500}.table-line[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;color:#fff}.table-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.table-line-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.width-big[_ngcontent-%COMP%]{width:40%}.width-small[_ngcontent-%COMP%]{width:30%}.no-border[_ngcontent-%COMP%]{border:none!important}.input-form-icon-b[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:36px;border-radius:12px;color:#fff;padding:0 12px;display:flex;align-items:center;gap:9px}.input-form-icon-b[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon-b[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:100%;border:none;background:transparent;outline:0}.background-grey-translucent[_ngcontent-%COMP%]{background:rgba(65,69,78,.4)}.margin-auto[_ngcontent-%COMP%]{margin:auto}.remove-bottom[_ngcontent-%COMP%]{margin-bottom:-12px!important}.stats-titles[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-between;align-items:center}.stats-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.stats-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px}.color-selected[_ngcontent-%COMP%]{color:var(--ion-color-primary)!important}.chart-container[_ngcontent-%COMP%]{display:block;width:100%!important}"]}),l})()}];let Y=(()=>{var i;class l{}return(i=l).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[f.iI.forChild(T),f.iI]}),l})(),A=(()=>{var i;class l{}return(i=l).\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.$C({type:i}),i.\u0275inj=t.G2t({imports:[m.MD,k.YN,M.bv,Y,v.FR,b.h]}),l})()}}]);