"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7756],{7756:(M,x,r)=>{r.r(x),r.d(x,{LoginPageModule:()=>X});var h=r(177),u=r(9417),f=r(8974),_=r(3314),v=r(467),d=r(4843),o=r(6996),p=r(1547);function S(e,c){if(1&e&&(o.j41(0,"div",14),o.EFF(1),o.k0s()),2&e){const n=o.XpG().$implicit;o.R7$(1),o.E5c(" ",n.city,"",n.city&&n.province?", ":"","",n.province," ")}}function b(e,c){1&e&&o.nrm(0,"img",15)}const P=function(e){return{"school-selected":e}};function k(e,c){if(1&e){const n=o.RV6();o.j41(0,"div",9),o.bIt("click",function(){const a=o.eBV(n).$implicit,s=o.XpG(2);return o.Njj(s.selectSchool(a))}),o.j41(1,"div",10)(2,"div",11),o.EFF(3),o.k0s(),o.DNE(4,S,2,3,"div",12),o.k0s(),o.DNE(5,b,1,0,"img",13),o.k0s()}if(2&e){const n=c.$implicit,t=o.XpG(2);o.Y8G("ngClass",o.eq3(4,P,n.id===t.currentSchoolId)),o.R7$(3),o.JRh(n.name),o.R7$(1),o.Y8G("ngIf",n.city||n.province),o.R7$(1),o.Y8G("ngIf",n.id===t.currentSchoolId)}}function w(e,c){if(1&e&&(o.j41(0,"div",7),o.DNE(1,k,6,6,"div",8),o.k0s()),2&e){const n=o.XpG();o.R7$(1),o.Y8G("ngForOf",n.schools)}}function I(e,c){1&e&&(o.j41(0,"div",16),o.EFF(1),o.nI1(2,"translate"),o.k0s()),2&e&&(o.R7$(1),o.SpI(" ",o.bMT(2,1,"no_schools_available")," "))}let y=(()=>{var e;class c{constructor(t){this.modalController=t,this.schools=[],this.currentSchoolId=null}ngOnInit(){}selectSchool(t){this.modalController.dismiss({school:t})}cancel(){this.modalController.dismiss()}}return(e=c).\u0275fac=function(t){return new(t||e)(o.rXU(f.W3))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-school-selector"]],inputs:{schools:"schools",currentSchoolId:"currentSchoolId"},decls:9,vars:5,consts:[[1,"modal-wrapper"],[1,"modal-header","background-color-dark"],[1,"montserrat"],["src","assets/icon/icons-outline-close.svg",1,"cursor-pointer","close-icon",3,"click"],[1,"modal-content"],["class","schools-list",4,"ngIf"],["class","no-schools montserrat color-light",4,"ngIf"],[1,"schools-list"],["class","school-item montserrat cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"school-item","montserrat","cursor-pointer",3,"ngClass","click"],[1,"school-info"],[1,"school-name"],["class","school-location color-light",4,"ngIf"],["src","assets/icon/icons-outline-check-circle-green.svg","class","check-icon",4,"ngIf"],[1,"school-location","color-light"],["src","assets/icon/icons-outline-check-circle-green.svg",1,"check-icon"],[1,"no-schools","montserrat","color-light"]],template:function(t,i){1&t&&(o.j41(0,"div",0)(1,"div",1)(2,"h2",2),o.EFF(3),o.nI1(4,"translate"),o.k0s(),o.j41(5,"img",3),o.bIt("click",function(){return i.cancel()}),o.k0s()(),o.j41(6,"div",4),o.DNE(7,w,2,1,"div",5),o.DNE(8,I,3,3,"div",6),o.k0s()()),2&t&&(o.R7$(3),o.JRh(o.bMT(4,3,"select_school")),o.R7$(4),o.Y8G("ngIf",i.schools&&i.schools.length>0),o.R7$(1),o.Y8G("ngIf",!i.schools||0===i.schools.length))},dependencies:[h.YU,h.Sq,h.bT,p.D9],styles:[".modal-wrapper[_ngcontent-%COMP%]{width:100%;max-width:500px;margin:0 auto;background:var(--ion-background-color);border-radius:12px;overflow:hidden}.modal-header[_ngcontent-%COMP%]{padding:20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid #444953}.modal-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:18px;font-weight:600;color:#fff}.modal-header[_ngcontent-%COMP%]   .close-icon[_ngcontent-%COMP%]{width:24px;height:24px}.modal-content[_ngcontent-%COMP%]{padding:16px;max-height:60vh;overflow-y:auto}.schools-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.school-item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:16px;background:#2b303b;border-radius:8px;transition:all .2s ease}.school-item[_ngcontent-%COMP%]:hover{background:#343a47}.school-item.school-selected[_ngcontent-%COMP%]{background:rgba(42,201,64,.1);border:1px solid rgba(42,201,64,.3)}.school-info[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:4px}.school-name[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#fff}.school-location[_ngcontent-%COMP%]{font-size:13px}.check-icon[_ngcontent-%COMP%]{width:24px;height:24px;flex-shrink:0}.no-schools[_ngcontent-%COMP%]{text-align:center;padding:40px 20px;font-size:14px}"]}),c})();var j=r(4387),R=r(5663),O=r(918),L=r(5794),T=r(8551),F=r(642);function D(e,c){if(1&e){const n=o.RV6();o.j41(0,"div")(1,"div",6),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.j41(4,"div",7)(5,"div",8),o.EFF(6),o.nI1(7,"translate"),o.k0s(),o.j41(8,"div",9),o.nrm(9,"img",10),o.j41(10,"input",11),o.bIt("ngModelChange",function(i){o.eBV(n);const a=o.XpG();return o.Njj(a.email=i)}),o.k0s()(),o.j41(11,"div",8),o.EFF(12),o.nI1(13,"translate"),o.k0s(),o.j41(14,"div",9),o.nrm(15,"img",12),o.j41(16,"input",13),o.bIt("ngModelChange",function(i){o.eBV(n);const a=o.XpG();return o.Njj(a.password=i)}),o.k0s(),o.j41(17,"img",14),o.bIt("click",function(){o.eBV(n);const i=o.XpG();return o.Njj(i.togglePassword())}),o.k0s()()(),o.j41(18,"button",15),o.bIt("click",function(){o.eBV(n);const i=o.XpG();return o.Njj(i.onLogin())}),o.EFF(19),o.nI1(20,"translate"),o.k0s(),o.j41(21,"div",16),o.bIt("click",function(){o.eBV(n);const i=o.XpG();return o.Njj(i.showLogin=!1)}),o.EFF(22),o.nI1(23,"translate"),o.k0s()()}if(2&e){const n=o.XpG();o.R7$(2),o.SpI(" ",o.bMT(3,9,"login")," "),o.R7$(4),o.SpI(" ",o.bMT(7,11,"email")," "),o.R7$(4),o.Y8G("ngModel",n.email),o.R7$(2),o.SpI(" ",o.bMT(13,13,"password")," "),o.R7$(4),o.Y8G("ngModel",n.password)("type",n.showPassword?"text":"password"),o.R7$(2),o.Y8G("disabled",!n.email||!n.password),o.R7$(1),o.SpI(" ",o.bMT(20,15,"login")," "),o.R7$(3),o.SpI(" ",o.bMT(23,17,"forgot_password")," ")}}function E(e,c){if(1&e){const n=o.RV6();o.j41(0,"div")(1,"div",17),o.EFF(2),o.nI1(3,"translate"),o.k0s(),o.j41(4,"div")(5,"div",8),o.EFF(6),o.nI1(7,"translate"),o.k0s(),o.j41(8,"div",9),o.nrm(9,"img",10),o.j41(10,"input",11),o.bIt("ngModelChange",function(i){o.eBV(n);const a=o.XpG();return o.Njj(a.emailRecover=i)}),o.k0s()()(),o.j41(11,"button",15),o.bIt("click",function(){o.eBV(n);const i=o.XpG();return o.Njj(i.onRecover())}),o.EFF(12),o.nI1(13,"translate"),o.k0s()()}if(2&e){const n=o.XpG();o.R7$(2),o.SpI(" ",o.bMT(3,5,"recover_password")," "),o.R7$(4),o.SpI(" ",o.bMT(7,7,"email")," "),o.R7$(4),o.Y8G("ngModel",n.emailRecover),o.R7$(1),o.Y8G("disabled",!n.emailRecover),o.R7$(1),o.SpI(" ",o.bMT(13,9,"reset_password")," ")}}const G=[{path:"",component:(()=>{var e;class c{constructor(t,i,a,s,l,C,m,g,N){this.router=t,this.teachService=i,this.monitorDataService=a,this.sharedDataService=s,this.modalController=l,this.toastr=C,this.spinnerService=m,this.translate=g,this.monitorRealtimeService=N,this.showLogin=!0,this.showPassword=!1}ngOnInit(){}togglePassword(){this.showPassword=!this.showPassword}onLogin(){var t=this;return(0,v.A)(function*(){t.spinnerService.show(),t.teachService.login(t.email,t.password).subscribe(function(){var i=(0,v.A)(function*(a){t.toastr.success(t.translate.instant("toast.connected_correctly")),localStorage.setItem("token",a.data.token),localStorage.setItem("monitorId",a.data.user.monitors[0].id),t.monitorRealtimeService.connect(a.data.user.monitors[0].id);const s=a.data.user.monitors[0];let l=s.active_school;const C=yield(0,d._)(t.teachService.getData("monitors",s.id,{"with[]":"schools"}));if(s.schools=C.data.schools,!(s.schools&&s.schools.length>0))return console.error("Monitor has no schools!"),t.toastr.error("No tiene escuelas asignadas"),void t.spinnerService.hide();{const m=t.monitorDataService.getActiveSchool();if(m&&s.schools.some(g=>g.id===m))l=m;else if(!l)if(s.schools.length>1){t.spinnerService.hide();const g=yield t.showSchoolSelector(s.schools,null);g?(l=g.id,localStorage.setItem("activeSchool",l.toString())):l=s.schools[0].id,t.spinnerService.show()}else l=s.schools[0].id;if(l!==s.active_school)try{yield(0,d._)(t.teachService.updateData("monitors",s.id,{active_school:l}))}catch(g){console.error("Error updating active_school:",g)}}s.active_school=l,t.monitorDataService.setMonitorData(s);try{yield(0,d._)(t.sharedDataService.fetchDegrees(l)),yield(0,d._)(t.sharedDataService.fetchSports(l)),yield(0,d._)(t.sharedDataService.fetchLanguages()),yield(0,d._)(t.sharedDataService.fetchStations()),yield(0,d._)(t.sharedDataService.fetchSchools())}catch(m){console.error("Error fetching data:",m),t.toastr.error(t.translate.instant("toast.error_loading_data"))}t.spinnerService.hide(),t.goTo("home"),t.email="",t.password=""});return function(a){return i.apply(this,arguments)}}(),i=>{t.spinnerService.hide(),console.error("Login failed",i),t.toastr.error(t.translate.instant("toast.identification_error"))})})()}showSchoolSelector(t,i){var a=this;return(0,v.A)(function*(){const s=yield a.modalController.create({component:y,componentProps:{schools:t,currentSchoolId:i},cssClass:"school-selector-modal",backdropDismiss:!1});yield s.present();const{data:l}=yield s.onWillDismiss();return(null==l?void 0:l.school)||null})()}onRecover(){this.emailRecover&&(this.spinnerService.show(),(0,d._)(this.teachService.postData("forgot-password",{email:this.emailRecover,type:"monitor"})).then(i=>{this.spinnerService.hide(),this.toastr.success(this.translate.instant("toast.recover_correctly")),this.emailRecover="",this.showLogin=!0}).catch(i=>{console.error("Error during recover:",i),this.spinnerService.hide(),this.toastr.error(this.translate.instant("toast.error"))}))}goTo(...t){this.router.navigate(t)}}return(e=c).\u0275fac=function(t){return new(t||e)(o.rXU(_.Ix),o.rXU(j.R),o.rXU(R.O),o.rXU(O.H),o.rXU(f.W3),o.rXU(L.tw),o.rXU(T.D),o.rXU(p.c$),o.rXU(F.L))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-login"]],decls:8,vars:2,consts:[[1,"content-wrapper","content-background-image","status-bar-overlap-wrapper"],[1,"header-content"],[1,"header-back","background-color-dark","cursor-pointer",3,"click"],["src","assets/icon/arrow-left.svg",1,"header-back-icon"],["src","assets/images/boukii-logo.png",1,"header-logo"],[4,"ngIf"],[1,"content-title"],[1,"pb-24"],[1,"input-label","color-light","montserrat"],[1,"input-form-icon","background-color-dark"],["src","assets/icon/icon-mail.png"],["type","text",1,"montserrat",3,"ngModel","ngModelChange"],["src","assets/icon/icon-password.png"],[1,"montserrat",3,"ngModel","type","ngModelChange"],["src","assets/icon/icon-eye.png",1,"cursor-pointer",3,"click"],[1,"content-button","btn-back-primary","montserrat",3,"disabled","click"],[1,"content-footer","cursor-pointer","montserrat",3,"click"],[1,"content-title-b"]],template:function(t,i){1&t&&(o.j41(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2),o.bIt("click",function(){return i.showLogin?i.goTo("start"):i.showLogin=!0}),o.nrm(4,"img",3),o.k0s(),o.nrm(5,"img",4),o.k0s(),o.DNE(6,D,24,19,"div",5),o.DNE(7,E,14,11,"div",5),o.k0s()()),2&t&&(o.R7$(6),o.Y8G("ngIf",i.showLogin),o.R7$(1),o.Y8G("ngIf",!i.showLogin))},dependencies:[h.bT,u.me,u.BC,u.vS,f.W9,p.D9],styles:[".content-wrapper[_ngcontent-%COMP%]{width:100%;min-height:100%;padding:20px 16px}.header-content[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center;margin-bottom:60px}.header-logo[_ngcontent-%COMP%]{width:100px}.header-back[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:34px;height:34px;border-radius:12px;display:flex;align-items:center;justify-content:center}.header-back-icon[_ngcontent-%COMP%]{width:22px}.content-title[_ngcontent-%COMP%]{color:#fff;text-align:left;font-size:24px;font-weight:600;line-height:1.2;margin-bottom:24px}.content-title-b[_ngcontent-%COMP%]{color:#fff;text-align:left;font-size:21px;font-weight:600;line-height:1.2;margin-bottom:12px}.content-subtitle[_ngcontent-%COMP%]{font-size:14px;margin-bottom:24px}.input-label[_ngcontent-%COMP%]{font-size:14px;margin-bottom:8px}.input-form-icon[_ngcontent-%COMP%]{width:100%;height:48px;border-radius:12px;color:#fff;padding:0 16px;display:flex;align-items:center;gap:9px;margin-bottom:24px}.input-form-icon[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:18px;position:relative;top:-1px}.input-form-icon[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{color:#fff;font-size:15px;width:100%;border:none;background:transparent;outline:0}.content-button[_ngcontent-%COMP%]{width:100%;height:44px;line-height:44px;display:block;border-radius:44px;color:#000;text-align:center;font-size:14px;font-weight:500;cursor:pointer;transition:all ease-in-out .3s}.content-footer[_ngcontent-%COMP%]{text-align:center;margin-top:18px;font-size:15px}button[disabled][_ngcontent-%COMP%]{opacity:.4;pointer-events:none}"]}),c})()}];let $=(()=>{var e;class c{}return(e=c).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[_.iI.forChild(G),_.iI]}),c})(),X=(()=>{var e;class c{}return(e=c).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[h.MD,u.YN,f.bv,$,p.h]}),c})()},4843:(M,x,r)=>{r.d(x,{_:()=>f});var h=r(9350),u=r(7707);function f(_,v){const d="object"==typeof v;return new Promise((o,p)=>{const S=new u.Ms({next:b=>{o(b),S.unsubscribe()},error:p,complete:()=>{d?o(v.defaultValue):p(new h.G)}});_.subscribe(S)})}}}]);