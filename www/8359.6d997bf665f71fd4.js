"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8359],{8359:(k,D,s)=>{s.r(D),s.d(D,{StatsPageModule:()=>E});var p=s(6814),A=s(6223),x=s(3582),m=s(5367),P=s(5861),f=s(3185),g=s(6676),t=(s(9361),s(6689)),Z=s(2234),T=s(5693),_=s(3271),S=s(2425),I=s(7364);const b=function(a){return{"color-selected":a}};function w(a,l){if(1&a&&(t.TgZ(0,"div",26)(1,"div",27)(2,"div",28),t._uU(3),t.qZA(),t.TgZ(4,"span",28),t._uU(5),t.qZA()(),t.TgZ(6,"div",23),t._uU(7),t.qZA(),t.TgZ(8,"div",23),t._uU(9),t.qZA()()),2&a){const c=l.$implicit,e=l.index,n=t.oxw();t.xp6(2),t.Q6J("ngClass",t.VKq(6,b,e>=n.currentEndIndex&&e<n.currentStartIndex)),t.xp6(1),t.Oqu(c.name),t.xp6(1),t.Q6J("ngClass",t.VKq(8,b,e>=n.currentEndIndex&&e<n.currentStartIndex)),t.xp6(1),t.Oqu(c.year),t.xp6(2),t.hij(" ",c.collectiveCourses," "),t.xp6(2),t.hij(" ",c.privateCourses," ")}}const Y=[{path:"",component:(()=>{var a;class l{constructor(e,n,o,r,d,u){this.router=e,this.monitorDataService=n,this.sharedDataService=o,this.teachService=r,this.toastr=d,this.spinnerService=u,this.lineChartData={datasets:[{data:[80,72,39,37,35,31,36,46,39,37,35,31],label:"Heures",yAxisID:"y",backgroundColor:"rgba(51,153,255,0.4)",borderColor:"rgba(51,153,255,1)",pointBackgroundColor:"rgba(51,153,255,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(51,153,255,0.8)",fill:"origin"}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.lineChartOptions={elements:{line:{tension:.3}},scales:{y:{beginAtZero:!0,position:"left",min:0,grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"#c8c8c8"}},x:{ticks:{color:"#c8c8c8"},grid:{display:!1}}},plugins:{legend:{display:!1}}},this.lineChartType="line",this.selectedYear="year",this.currentStartIndex=3,this.currentEndIndex=0}ngOnInit(){var e=this;return(0,P.Z)(function*(){e.subscription=e.monitorDataService.getMonitorData().subscribe(function(){var n=(0,P.Z)(function*(o){o&&(e.spinnerService.show(),e.monitorData=o,e.loadBookings(),e.spinnerService.hide())});return function(o){return n.apply(this,arguments)}}())})()}loadBookings(){const n=this.initializeMonthsData()[0],o=g(`${n.year}-${n.name}-01`,"YYYY-MMM-DD").startOf("month").format("YYYY-MM-DD"),r=g().format("YYYY-MM-DD");console.log(o),console.log(r),this.teachService.getData("teach/getAgenda",null,{date_start:o,date_end:r,school_id:this.monitorData.active_school}).subscribe(d=>{console.log(d.data),this.monthsData=this.initializeMonthsData();let v={totalDuration:0},C={totalDuration:0};d.data.bookings.forEach(i=>{const J=g(i.date).format("MMM YYYY").toUpperCase(),M=this.monthsData.find(h=>`${h.name} ${h.year}`===J);if(M){const h=this.calculateDuration(i.hour_start,i.hour_end);1===i.course.course_type?M.collectiveCourses+=h:2===i.course.course_type&&(M.privateCourses+=h)}}),v.totalDuration=this.formatDuration(v.totalDuration),C.totalDuration=this.formatDuration(C.totalDuration),Object.keys(this.monthsData).forEach(i=>{this.monthsData[i].collectiveCourses=this.formatDuration(this.monthsData[i].collectiveCourses),this.monthsData[i].privateCourses=this.formatDuration(this.monthsData[i].privateCourses)}),console.log("Collective Courses:",v),console.log("Private Courses:",C),console.log("Monthly Data:",this.monthsData),this.monthsData.map(i=>this.durationInHours(i.collectiveCourses)),this.monthsData.map(i=>this.durationInHours(i.privateCourses));let O=0,y=0;this.monthsData.forEach(i=>{O+=this.hoursToMinutes(this.durationInHours(i.collectiveCourses)),y+=this.hoursToMinutes(this.durationInHours(i.privateCourses))}),this.totalCollectiveDurationFormatted=this.formatDuration(O),this.totalPrivateDurationFormatted=this.formatDuration(y),console.log(this.totalCollectiveDurationFormatted),console.log(this.totalPrivateDurationFormatted),this.reversedMonthsData=this.monthsData.slice().reverse(),this.updateChartData()},d=>{this.spinnerService.hide(),console.error("There was an error!",d)})}hoursToMinutes(e){return 60*e}durationInHours(e){const[n,o]=e.split("h").map(r=>parseInt(r,10));return n+o/60}changeMonths(e){this.currentEndIndex+e>=0&&this.currentStartIndex+e<=24&&(this.currentStartIndex+=e,this.currentEndIndex+=e,this.updateChartData())}updateChartData(){const e=this.monthsData.length-this.currentStartIndex,n=this.monthsData.length-this.currentEndIndex,o=this.monthsData.slice(e,n).map(r=>this.durationInHours(r.collectiveCourses)+this.durationInHours(r.privateCourses));this.lineChartData.datasets[0].data=o,this.lineChartData.labels=this.monthsData.slice(e,n).map(r=>r.name),this.chart&&this.chart.update()}navigateToPreviousMonths(){this.currentStartIndex>0&&(this.currentStartIndex-=3,this.currentEndIndex-=3,this.updateChartData())}navigateToNextMonths(){this.currentEndIndex<this.monthsData.length&&(this.currentStartIndex+=3,this.currentEndIndex+=3,this.updateChartData())}initializeMonthsData(){const e=[];let n=g();for(let o=0;o<24;o++){const r=n.format("MMM YYYY").toUpperCase();e.unshift({name:r.split(" ")[0],year:r.split(" ")[1],collectiveCourses:0,privateCourses:0}),n.subtract(1,"months")}return e}calculateDuration(e,n){const[o,r]=e.split(":").map(Number),[d,u]=n.split(":").map(Number);return 60*(d-o)+(u-r)}formatDuration(e){return`${Math.floor(e/60)}h${e%60}m`}updateChartDataB(){this.lineChartData="all"===this.selectedYear?{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31,80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC","JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]}:{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.chart&&this.chart.update()}goTo(...e){this.router.navigate(e)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(a=l).\u0275fac=function(e){return new(e||a)(t.Y36(m.F0),t.Y36(Z.q),t.Y36(T.g),t.Y36(_.b),t.Y36(S._W),t.Y36(I.V))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-stats"]],viewQuery:function(e,n){if(1&e&&t.Gf(f.jh,5),2&e){let o;t.iGM(o=t.CRH())&&(n.chart=o.first)}},decls:46,vars:8,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-top"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/statistiques.png"],[1,"background-color-dark","padding-wrapper","mt-24","mb-24"],[1,"stats-titles","mb-24"],[1,"input-form-icon-b","background-grey-translucent"],[1,"montserrat"],[1,"stats-icons"],["src","assets/icon/icons-outline-arrow-left-2.svg",1,"cursor-pointer",3,"click"],["src","assets/icon/icons-outline-arrow-right-3-white.svg",1,"cursor-pointer",3,"click"],[1,"chart-scroll-wrapper"],["baseChart","",1,"chart-container",3,"data","options","type"],[1,"padding-wrapper"],[1,"cursor-pointer","menu-section-content","mb-12"],[1,"menu-section-title"],[1,"table-line","no-border","padding-wrapper","pb-8"],[1,"width-big"],[1,"width-small"],[1,"background-color-dark","padding-wrapper","table-wrapper"],[1,"table-line","table-line-total","pb-8","mb-8"],[1,"montserrat","width-small"],["class","table-line pb-8 mb-8",4,"ngFor","ngForOf"],[1,"table-line","table-line-total","pb-8","no-border"],[1,"table-line","pb-8","mb-8"],[1,"montserrat","width-big","table-line-text"],[3,"ngClass"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),t.NdJ("click",function(){return n.goTo("home")}),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"img",5),t.TgZ(7,"div"),t._uU(8,"Statistiques"),t.qZA()()()(),t.TgZ(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9),t._uU(13," Heures totales "),t.qZA()(),t.TgZ(14,"div",10)(15,"img",11),t.NdJ("click",function(){return n.changeMonths(3)}),t.qZA(),t.TgZ(16,"img",12),t.NdJ("click",function(){return n.changeMonths(-3)}),t.qZA()()(),t.TgZ(17,"div",13),t._UZ(18,"canvas",14),t.qZA()(),t.TgZ(19,"div",15)(20,"div",16)(21,"div",17),t._uU(22,"Rapport d'activit\xe9"),t.qZA()(),t.TgZ(23,"div",18)(24,"div",19),t._uU(25," Mois "),t.qZA(),t.TgZ(26,"div",20),t._uU(27," Collectif "),t.qZA(),t.TgZ(28,"div",20),t._uU(29," Priv\xe9 "),t.qZA()(),t.TgZ(30,"div",21)(31,"div",22)(32,"div",19),t._uU(33," TOTAL "),t.qZA(),t.TgZ(34,"div",23),t._uU(35),t.qZA(),t.TgZ(36,"div",23),t._uU(37),t.qZA()(),t.YNc(38,w,10,10,"div",24),t.TgZ(39,"div",25)(40,"div",19),t._uU(41," TOTAL "),t.qZA(),t.TgZ(42,"div",23),t._uU(43),t.qZA(),t.TgZ(44,"div",23),t._uU(45),t.qZA()()()()()()),2&e&&(t.xp6(18),t.Q6J("data",n.lineChartData)("options",n.lineChartOptions)("type",n.lineChartType),t.xp6(17),t.hij(" ",n.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",n.totalPrivateDurationFormatted," "),t.xp6(1),t.Q6J("ngForOf",n.reversedMonthsData),t.xp6(5),t.hij(" ",n.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",n.totalPrivateDurationFormatted," "))},dependencies:[p.mk,p.sg,x.W2,f.jh],styles:[".content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-side-img-b[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:20px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.menu-section-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.menu-section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.menu-section-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-primary);padding:5px 8px;border-radius:40px;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center}.menu-section-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.menu-section-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.menu-section-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.table-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;border-radius:8px}.table-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;border-bottom:1px solid #444953}.table-line-total[_ngcontent-%COMP%]{font-weight:500}.table-line[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;color:#fff}.table-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.table-line-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.width-big[_ngcontent-%COMP%]{width:40%}.width-small[_ngcontent-%COMP%]{width:30%}.no-border[_ngcontent-%COMP%]{border:none!important}.input-form-icon-b[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:36px;border-radius:12px;color:#fff;padding:0 12px;display:flex;align-items:center;gap:9px}.input-form-icon-b[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon-b[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:100%;border:none;background:transparent;outline:0}.background-grey-translucent[_ngcontent-%COMP%]{background:rgba(65,69,78,.4)}.margin-auto[_ngcontent-%COMP%]{margin:auto}.remove-bottom[_ngcontent-%COMP%]{margin-bottom:-12px!important}.stats-titles[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-between;align-items:center}.stats-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.stats-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px}.color-selected[_ngcontent-%COMP%]{color:var(--ion-color-primary)!important}.chart-container[_ngcontent-%COMP%]{display:block;width:100%!important}"]}),l})()}];let U=(()=>{var a;class l{}return(a=l).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[m.Bz.forChild(Y),m.Bz]}),l})(),E=(()=>{var a;class l{}return(a=l).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[p.ez,A.u5,x.Pc,U,f.vQ]}),l})()}}]);