"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8359],{8359:(I,M,r)=>{r.r(M),r.d(M,{StatsPageModule:()=>F});var D=r(6814),y=r(6223),b=r(3582),g=r(5367),P=r(5861),m=r(3185),h=r(6676),t=(r(9361),r(6689)),A=r(2234),Z=r(5693),T=r(3271),w=r(2425),Y=r(7364);function S(a,c){if(1&a&&(t.TgZ(0,"div",22)(1,"div",23)(2,"div"),t._uU(3),t.qZA()(),t.TgZ(4,"div",19),t._uU(5),t.qZA(),t.TgZ(6,"div",19),t._uU(7),t.qZA()()),2&a){const l=c.$implicit;t.xp6(3),t.Oqu(l.name),t.xp6(2),t.hij(" ",l.collectiveCourses," "),t.xp6(2),t.hij(" ",l.privateCourses," ")}}const U=[{path:"",component:(()=>{var a;class c{constructor(e,n,o,s,u,p){this.router=e,this.monitorDataService=n,this.sharedDataService=o,this.teachService=s,this.toastr=u,this.spinnerService=p,this.lineChartData={datasets:[{data:[80,72,39,37,35,31,36,46,39,37,35,31],label:"Heures",yAxisID:"y",backgroundColor:"rgba(51,153,255,0.4)",borderColor:"rgba(51,153,255,1)",pointBackgroundColor:"rgba(51,153,255,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(51,153,255,0.8)",fill:"origin"}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.lineChartOptions={elements:{line:{tension:.3}},scales:{y:{beginAtZero:!0,position:"left",min:0,grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"#c8c8c8"}},x:{ticks:{color:"#c8c8c8"},grid:{display:!1}}},plugins:{legend:{display:!1}}},this.lineChartType="line",this.selectedYear="year"}ngOnInit(){var e=this;return(0,P.Z)(function*(){e.subscription=e.monitorDataService.getMonitorData().subscribe(function(){var n=(0,P.Z)(function*(o){o&&(e.spinnerService.show(),e.monitorData=o,e.loadBookings(),e.spinnerService.hide())});return function(o){return n.apply(this,arguments)}}())})()}loadBookings(){const n=this.initializeMonthsData()[0],o=h(`${n.year}-${n.name}-01`,"YYYY-MMM-DD").startOf("month").format("YYYY-MM-DD"),s=h().format("YYYY-MM-DD");console.log(o),console.log(s),this.teachService.getData("teach/getAgenda",null,{date_start:o,date_end:s,school_id:this.monitorData.active_school}).subscribe(u=>{console.log(u.data),this.monthsData=this.initializeMonthsData();let f={totalDuration:0},v={totalDuration:0};u.data.bookings.forEach(i=>{const B=h(i.date).format("MMM YYYY").toUpperCase(),C=this.monthsData.find(d=>`${d.name} ${d.year}`===B);if(C){const d=this.calculateDuration(i.hour_start,i.hour_end);1===i.course.course_type?C.collectiveCourses+=d:2===i.course.course_type&&(C.privateCourses+=d)}}),f.totalDuration=this.formatDuration(f.totalDuration),v.totalDuration=this.formatDuration(v.totalDuration),Object.keys(this.monthsData).forEach(i=>{this.monthsData[i].collectiveCourses=this.formatDuration(this.monthsData[i].collectiveCourses),this.monthsData[i].privateCourses=this.formatDuration(this.monthsData[i].privateCourses)}),console.log("Collective Courses:",f),console.log("Private Courses:",v),console.log("Monthly Data:",this.monthsData),this.monthsData.map(i=>this.durationInHours(i.collectiveCourses)),this.monthsData.map(i=>this.durationInHours(i.privateCourses));let O=0,x=0;this.monthsData.forEach(i=>{O+=this.hoursToMinutes(this.durationInHours(i.collectiveCourses)),x+=this.hoursToMinutes(this.durationInHours(i.privateCourses))}),this.totalCollectiveDurationFormatted=this.formatDuration(O),this.totalPrivateDurationFormatted=this.formatDuration(x),console.log(this.totalCollectiveDurationFormatted),console.log(this.totalPrivateDurationFormatted),this.reversedMonthsData=this.monthsData.slice().reverse(),this.updateChartData(this.monthsData)},u=>{this.spinnerService.hide(),console.error("There was an error!",u)})}hoursToMinutes(e){return 60*e}durationInHours(e){const[n,o]=e.split("h").map(s=>parseInt(s,10));return n+o/60}updateChartData(e){const n=e.map(o=>this.durationInHours(o.collectiveCourses)+this.durationInHours(o.privateCourses));this.lineChartData.datasets[0].data=n,this.lineChartData.labels=e.map(o=>o.name),this.chart&&this.chart.update()}initializeMonthsData(){const e=[];let n=h();for(let o=0;o<12;o++){const s=n.format("MMM YYYY").toUpperCase();e.unshift({name:s.split(" ")[0],year:s.split(" ")[1],collectiveCourses:0,privateCourses:0}),n.subtract(1,"months")}return e}calculateDuration(e,n){const[o,s]=e.split(":").map(Number),[u,p]=n.split(":").map(Number);return 60*(u-o)+(p-s)}formatDuration(e){return`${Math.floor(e/60)}h${e%60}m`}updateChartDataB(){this.lineChartData="all"===this.selectedYear?{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31,80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC","JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]}:{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.chart&&this.chart.update()}goTo(...e){this.router.navigate(e)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(a=c).\u0275fac=function(e){return new(e||a)(t.Y36(g.F0),t.Y36(A.q),t.Y36(Z.g),t.Y36(T.b),t.Y36(w._W),t.Y36(Y.V))},a.\u0275cmp=t.Xpm({type:a,selectors:[["app-stats"]],viewQuery:function(e,n){if(1&e&&t.Gf(m.jh,5),2&e){let o;t.iGM(o=t.CRH())&&(n.chart=o.first)}},decls:42,vars:8,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-top"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/statistiques.png"],[1,"background-color-dark","padding-wrapper","mt-24","mb-24"],[1,"input-form-icon-b","background-grey-translucent","mb-24"],[1,"montserrat"],[1,"chart-scroll-wrapper"],["baseChart","",1,"chart-container",3,"data","options","type"],[1,"padding-wrapper"],[1,"cursor-pointer","menu-section-content","mb-12"],[1,"menu-section-title"],[1,"table-line","no-border","padding-wrapper","pb-8"],[1,"width-big"],[1,"width-small"],[1,"background-color-dark","padding-wrapper","table-wrapper"],[1,"table-line","table-line-total","pb-8","mb-8"],[1,"montserrat","width-small"],["class","table-line pb-8 mb-8",4,"ngFor","ngForOf"],[1,"table-line","table-line-total","pb-8","no-border"],[1,"table-line","pb-8","mb-8"],[1,"montserrat","width-big","table-line-text"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),t.NdJ("click",function(){return n.goTo("home")}),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"img",5),t.TgZ(7,"div"),t._uU(8,"Statistiques"),t.qZA()()()(),t.TgZ(9,"div",6)(10,"div",7)(11,"div",8),t._uU(12," Heures totales "),t.qZA()(),t.TgZ(13,"div",9),t._UZ(14,"canvas",10),t.qZA()(),t.TgZ(15,"div",11)(16,"div",12)(17,"div",13),t._uU(18,"Rapport d'activit\xe9"),t.qZA()(),t.TgZ(19,"div",14)(20,"div",15),t._uU(21," Mois "),t.qZA(),t.TgZ(22,"div",16),t._uU(23," Collectif "),t.qZA(),t.TgZ(24,"div",16),t._uU(25," Priv\xe9 "),t.qZA()(),t.TgZ(26,"div",17)(27,"div",18)(28,"div",15),t._uU(29," TOTAL "),t.qZA(),t.TgZ(30,"div",19),t._uU(31),t.qZA(),t.TgZ(32,"div",19),t._uU(33),t.qZA()(),t.YNc(34,S,8,3,"div",20),t.TgZ(35,"div",21)(36,"div",15),t._uU(37," TOTAL "),t.qZA(),t.TgZ(38,"div",19),t._uU(39),t.qZA(),t.TgZ(40,"div",19),t._uU(41),t.qZA()()()()()()),2&e&&(t.xp6(14),t.Q6J("data",n.lineChartData)("options",n.lineChartOptions)("type",n.lineChartType),t.xp6(17),t.hij(" ",n.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",n.totalPrivateDurationFormatted," "),t.xp6(1),t.Q6J("ngForOf",n.reversedMonthsData),t.xp6(5),t.hij(" ",n.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",n.totalPrivateDurationFormatted," "))},dependencies:[D.sg,b.W2,m.jh],styles:[".content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-side-img-b[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:20px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.menu-section-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.menu-section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.menu-section-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-primary);padding:5px 8px;border-radius:40px;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center}.menu-section-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.menu-section-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.menu-section-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.table-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;border-radius:8px}.table-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;border-bottom:1px solid #444953}.table-line-total[_ngcontent-%COMP%]{font-weight:500}.table-line[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;color:#fff}.table-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.table-line-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.width-big[_ngcontent-%COMP%]{width:40%}.width-small[_ngcontent-%COMP%]{width:30%}.no-border[_ngcontent-%COMP%]{border:none!important}.input-form-icon-b[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:36px;border-radius:12px;color:#fff;padding:0 12px;display:flex;align-items:center;gap:9px}.input-form-icon-b[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon-b[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:100%;border:none;background:transparent;outline:0}.background-grey-translucent[_ngcontent-%COMP%]{background:rgba(65,69,78,.4)}.margin-auto[_ngcontent-%COMP%]{margin:auto}.remove-bottom[_ngcontent-%COMP%]{margin-bottom:-12px!important}.chart-scroll-wrapper[_ngcontent-%COMP%]{overflow-x:scroll;-webkit-overflow-scrolling:touch}.chart-container[_ngcontent-%COMP%]{display:block;width:100%!important}"]}),c})()}];let _=(()=>{var a;class c{}return(a=c).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[g.Bz.forChild(U),g.Bz]}),c})(),F=(()=>{var a;class c{}return(a=c).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.oAB({type:a}),a.\u0275inj=t.cJS({imports:[D.ez,y.u5,b.Pc,_,m.vQ]}),c})()}}]);