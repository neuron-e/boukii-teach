"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8359],{8359:(L,M,s)=>{s.r(M),s.d(M,{StatsPageModule:()=>z});var f=s(6814),U=s(6223),P=s(3582),D=s(8520),x=s(5861),v=s(3185),m=s(6676),t=s(2029),N=s(2234),E=s(5693),j=s(3271),H=s(2425),F=s(7364),C=s(3911);const y=function(o){return{"color-selected":o}};function J(o,h){if(1&o&&(t.TgZ(0,"div",27)(1,"div",28)(2,"div",29),t._uU(3),t.qZA(),t.TgZ(4,"span",29),t._uU(5),t.qZA()(),t.TgZ(6,"div",24),t._uU(7),t.qZA(),t.TgZ(8,"div",24),t._uU(9),t.qZA(),t.TgZ(10,"div",24),t._uU(11),t.qZA()()),2&o){const c=h.$implicit,a=h.index,e=t.oxw();t.xp6(2),t.Q6J("ngClass",t.VKq(7,y,a>=e.currentEndIndex&&a<e.currentStartIndex)),t.xp6(1),t.Oqu(c.name),t.xp6(1),t.Q6J("ngClass",t.VKq(9,y,a>=e.currentEndIndex&&a<e.currentStartIndex)),t.xp6(1),t.Oqu(c.year),t.xp6(2),t.hij(" ",c.collectiveCourses," "),t.xp6(2),t.hij(" ",c.privateCourses," "),t.xp6(2),t.hij(" ",c.blockPayed," ")}}const B=[{path:"",component:(()=>{var o;class h{constructor(a,e,i,d,p,u,r){this.router=a,this.monitorDataService=e,this.sharedDataService=i,this.teachService=d,this.toastr=p,this.spinnerService=u,this.translate=r,this.lineChartData={datasets:[{data:[80,72,39,37,35,31,36,46,39,37,35,31],label:"Heures",yAxisID:"y",backgroundColor:"rgba(51,153,255,0.4)",borderColor:"rgba(51,153,255,1)",pointBackgroundColor:"rgba(51,153,255,1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(51,153,255,0.8)",fill:"origin"}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.lineChartOptions={elements:{line:{tension:.3}},scales:{y:{beginAtZero:!0,position:"left",min:0,grid:{color:"rgba(255,255,255,0.3)"},ticks:{color:"#c8c8c8"}},x:{ticks:{color:"#c8c8c8"},grid:{display:!1}}},plugins:{legend:{display:!0}}},this.lineChartType="line",this.selectedYear="year",this.currentStartIndex=3,this.currentEndIndex=0,this.hourStartDay="08:00",this.hourEndDay="18:00"}ngOnInit(){var a=this;return(0,x.Z)(function*(){a.subscription=a.monitorDataService.getMonitorData().subscribe(function(){var e=(0,x.Z)(function*(i){i&&(a.spinnerService.show(),a.monitorData=i,a.loadBookings(),a.spinnerService.hide())});return function(i){return e.apply(this,arguments)}}())})()}loadBookings(){const e=this.initializeMonthsData()[0],p={date_start:m(`${e.year}-${e.name}-01`,"YYYY-MMM-DD").startOf("month").format("YYYY-MM-DD"),date_end:m().format("YYYY-MM-DD")};this.monitorData.active_school&&(p.school_id=this.monitorData.active_school),this.teachService.getData("teach/getAgenda",null,p).subscribe(u=>{this.monthsData=this.initializeMonthsData();let _={totalDuration:0},O={totalDuration:0},Z={totalDuration:0},A={totalDuration:0},I={totalDuration:0};u.data.bookings.forEach(n=>{const b=m(n.date).format("MMM YYYY").toUpperCase(),g=this.monthsData.find(l=>`${l.name} ${l.year}`===b);if(g){const l=this.calculateDuration(n.hour_start,n.hour_end);1===n.course.course_type?g.collectiveCourses+=l:2===n.course.course_type&&(g.privateCourses+=l)}}),u.data.nwd.forEach(n=>{const b=m(n.start_date).format("MMM YYYY").toUpperCase(),g=this.monthsData.find(l=>`${l.name} ${l.year}`===b);if(g){let l;l=n.full_day?this.calculateDuration(this.hourStartDay,this.hourEndDay):this.calculateDuration(n.start_time,n.end_time),1===n.user_nwd_subtype_id?g.blockNwd+=l:2===n.user_nwd_subtype_id?g.blockPayed+=l:3===n.user_nwd_subtype_id&&(g.blockNotPayed+=l)}}),_.totalDuration=this.formatDuration(_.totalDuration),O.totalDuration=this.formatDuration(O.totalDuration),A.totalDuration=this.formatDuration(A.totalDuration),Z.totalDuration=this.formatDuration(Z.totalDuration),I.totalDuration=this.formatDuration(I.totalDuration),Object.keys(this.monthsData).forEach(n=>{this.monthsData[n].collectiveCourses=this.formatDuration(this.monthsData[n].collectiveCourses),this.monthsData[n].privateCourses=this.formatDuration(this.monthsData[n].privateCourses),this.monthsData[n].blockNwd=this.formatDuration(this.monthsData[n].blockNwd),this.monthsData[n].blockPayed=this.formatDuration(this.monthsData[n].blockPayed),this.monthsData[n].blockNotPayed=this.formatDuration(this.monthsData[n].blockNotPayed)}),this.monthsData.map(n=>this.durationInHours(n.collectiveCourses)),this.monthsData.map(n=>this.durationInHours(n.privateCourses)),this.monthsData.map(n=>this.durationInHours(n.blockNwd)),this.monthsData.map(n=>this.durationInHours(n.blockPayed)),this.monthsData.map(n=>this.durationInHours(n.blockNotPayed));let k=0,w=0,T=0,S=0,Y=0;this.monthsData.forEach(n=>{k+=this.hoursToMinutes(this.durationInHours(n.collectiveCourses)),w+=this.hoursToMinutes(this.durationInHours(n.privateCourses)),T+=this.hoursToMinutes(this.durationInHours(n.blockNwd)),S+=this.hoursToMinutes(this.durationInHours(n.blockPayed)),Y+=this.hoursToMinutes(this.durationInHours(n.blockNotPayed))}),this.totalCollectiveDurationFormatted=this.formatDuration(k),this.totalPrivateDurationFormatted=this.formatDuration(w),this.totalNwdDurationFormatted=this.formatDuration(T),this.totalPayedDurationFormatted=this.formatDuration(S),this.totalNotPayedDurationFormatted=this.formatDuration(Y),this.reversedMonthsData=this.monthsData.slice().reverse(),this.updateChartData()},u=>{this.spinnerService.hide(),console.error("There was an error!",u)})}hoursToMinutes(a){return 60*a}durationInHours(a){const[e,i]=a.split("h").map(d=>parseInt(d,10));return e+i/60}changeMonths(a){this.currentEndIndex+a>=0&&this.currentStartIndex+a<=24&&(this.currentStartIndex+=a,this.currentEndIndex+=a,this.updateChartData())}updateChartData(){const a=this.monthsData.length-this.currentStartIndex,e=this.monthsData.length-this.currentEndIndex,i=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.collectiveCourses)),d=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.privateCourses)),p=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.blockPayed)),u=this.monthsData.slice(a,e).map(r=>this.durationInHours(r.collectiveCourses)+this.durationInHours(r.privateCourses)+this.durationInHours(r.blockPayed));this.lineChartData.datasets=[{data:i,label:this.translate.instant("collective_courses"),yAxisID:"y",borderColor:"rgba(252,196,47,1)"},{data:d,label:this.translate.instant("private_courses"),yAxisID:"y",borderColor:"rgba(56,199,77,1)"},{data:p,label:this.translate.instant("paid_blocks"),yAxisID:"y",borderColor:"rgba(100,100,100,1)"},{data:u,label:this.translate.instant("total"),yAxisID:"y",borderColor:"rgba(51,153,255,1)"}],this.lineChartData.labels=this.monthsData.slice(a,e).map(r=>r.name),this.chart&&this.chart.update()}navigateToPreviousMonths(){this.currentStartIndex>0&&(this.currentStartIndex-=3,this.currentEndIndex-=3,this.updateChartData())}navigateToNextMonths(){this.currentEndIndex<this.monthsData.length&&(this.currentStartIndex+=3,this.currentEndIndex+=3,this.updateChartData())}initializeMonthsData(){const a=[];let e=m();for(let i=0;i<24;i++){const d=e.format("MMM YYYY").toUpperCase();a.unshift({name:d.split(" ")[0],year:d.split(" ")[1],collectiveCourses:0,privateCourses:0,blockNwd:0,blockPayed:0,blockNotPayed:0}),e.subtract(1,"months")}return a}calculateDuration(a,e){const[i,d]=a.split(":").map(Number),[p,u]=e.split(":").map(Number);return 60*(p-i)+(u-d)}formatDuration(a){return`${Math.floor(a/60)}h${a%60}m`}updateChartDataB(){this.lineChartData="all"===this.selectedYear?{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31,80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC","JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]}:{...this.lineChartData,datasets:[{...this.lineChartData.datasets[0],data:[80,72,39,37,35,31,36,46,39,37,35,31]}],labels:["JAN","FEB","MAR","AVR","MAI","JUI","JUL","AUG","SEP","OCT","NOV","DEC"]},this.chart&&this.chart.update()}goTo(...a){this.router.navigate(a)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}}return(o=h).\u0275fac=function(a){return new(a||o)(t.Y36(D.F0),t.Y36(N.q),t.Y36(E.g),t.Y36(j.b),t.Y36(H._W),t.Y36(F.V),t.Y36(C.sK))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-stats"]],viewQuery:function(a,e){if(1&a&&t.Gf(v.jh,5),2&a){let i;t.iGM(i=t.CRH())&&(e.chart=i.first)}},decls:61,vars:37,consts:[[1,"content-size","content-background-image"],[1,"background-color-dark","padding-wrapper","status-bar-overlap-wrapper"],[1,"header-top"],["src","assets/icon/arrow-left.svg",1,"header-top-side-img","cursor-pointer",3,"click"],[1,"header-section-title"],["src","assets/icon/statistiques.png"],[1,"background-color-dark","padding-wrapper","mt-24","mb-24"],[1,"stats-titles","mb-24"],[1,"input-form-icon-b","background-grey-translucent"],[1,"montserrat"],[1,"stats-icons"],["src","assets/icon/icons-outline-arrow-left-2.svg",1,"cursor-pointer",3,"click"],["src","assets/icon/icons-outline-arrow-right-3-white.svg",1,"cursor-pointer",3,"click"],[1,"chart-scroll-wrapper"],["baseChart","",1,"chart-container",3,"data","options","type"],[1,"padding-wrapper"],[1,"cursor-pointer","menu-section-content","mb-12"],[1,"menu-section-title"],[1,"table-line","no-border","padding-wrapper","pb-8"],[1,"width-big"],[1,"width-small"],[1,"background-color-dark","padding-wrapper","table-wrapper"],[1,"table-line","table-line-total","pb-8","mb-8"],[1,"width-big","uppercase"],[1,"montserrat","width-small"],["class","table-line pb-8 mb-8",4,"ngFor","ngForOf"],[1,"table-line","table-line-total","pb-8","no-border"],[1,"table-line","pb-8","mb-8"],[1,"montserrat","width-big","table-line-text"],[3,"ngClass"]],template:function(a,e){1&a&&(t.TgZ(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"img",3),t.NdJ("click",function(){return e.goTo("home")}),t.qZA(),t.TgZ(5,"div",4),t._UZ(6,"img",5),t.TgZ(7,"div"),t._uU(8),t.ALo(9,"translate"),t.qZA()()()(),t.TgZ(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9),t._uU(14),t.ALo(15,"translate"),t.qZA()(),t.TgZ(16,"div",10)(17,"img",11),t.NdJ("click",function(){return e.changeMonths(3)}),t.qZA(),t.TgZ(18,"img",12),t.NdJ("click",function(){return e.changeMonths(-3)}),t.qZA()()(),t.TgZ(19,"div",13),t._UZ(20,"canvas",14),t.qZA()(),t.TgZ(21,"div",15)(22,"div",16)(23,"div",17),t._uU(24),t.ALo(25,"translate"),t.qZA()(),t.TgZ(26,"div",18)(27,"div",19),t._uU(28),t.ALo(29,"translate"),t.qZA(),t.TgZ(30,"div",20),t._uU(31),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"div",20),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.TgZ(36,"div",20),t._uU(37),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"div",21)(40,"div",22)(41,"div",23),t._uU(42),t.ALo(43,"translate"),t.qZA(),t.TgZ(44,"div",24),t._uU(45),t.qZA(),t.TgZ(46,"div",24),t._uU(47),t.qZA(),t.TgZ(48,"div",24),t._uU(49),t.qZA()(),t.YNc(50,J,12,11,"div",25),t.TgZ(51,"div",26)(52,"div",23),t._uU(53),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"div",24),t._uU(56),t.qZA(),t.TgZ(57,"div",24),t._uU(58),t.qZA(),t.TgZ(59,"div",24),t._uU(60),t.qZA()()()()()()),2&a&&(t.xp6(8),t.Oqu(t.lcZ(9,19,"statistics")),t.xp6(6),t.hij(" ",t.lcZ(15,21,"total_hours")," "),t.xp6(6),t.Q6J("data",e.lineChartData)("options",e.lineChartOptions)("type",e.lineChartType),t.xp6(4),t.Oqu(t.lcZ(25,23,"activity_report")),t.xp6(4),t.hij(" ",t.lcZ(29,25,"month")," "),t.xp6(3),t.hij(" ",t.lcZ(32,27,"collective")," "),t.xp6(3),t.hij(" ",t.lcZ(35,29,"private")," "),t.xp6(3),t.hij(" ",t.lcZ(38,31,"block_paid_abbrev")," "),t.xp6(5),t.hij(" ",t.lcZ(43,33,"total")," "),t.xp6(3),t.hij(" ",e.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",e.totalPrivateDurationFormatted," "),t.xp6(2),t.hij(" ",e.totalPayedDurationFormatted," "),t.xp6(1),t.Q6J("ngForOf",e.reversedMonthsData),t.xp6(3),t.hij(" ",t.lcZ(54,35,"total")," "),t.xp6(3),t.hij(" ",e.totalCollectiveDurationFormatted," "),t.xp6(2),t.hij(" ",e.totalPrivateDurationFormatted," "),t.xp6(2),t.hij(" ",e.totalPayedDurationFormatted," "))},dependencies:[f.mk,f.sg,P.W2,v.jh,C.X$],styles:[".content-size[_ngcontent-%COMP%]{width:100%;min-height:100%}.padding-wrapper[_ngcontent-%COMP%]{padding:20px 16px}.header-top[_ngcontent-%COMP%]{position:relative;top:0;left:0;width:100%;display:flex;align-items:center;justify-content:center}.header-top-side-img[_ngcontent-%COMP%]{position:absolute;left:0;top:50%;transform:translateY(-50%);width:28px}.header-top-side-img-b[_ngcontent-%COMP%]{position:absolute;right:0;top:50%;transform:translateY(-50%);width:20px}.header-top-title[_ngcontent-%COMP%]{font-size:15px;color:#fff;font-weight:600}.header-section-title[_ngcontent-%COMP%]{display:flex;gap:10px;align-items:center;justify-content:center}.header-section-title[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.header-section-title[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.menu-section-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.menu-section-title[_ngcontent-%COMP%]{font-size:17px;font-weight:500}.menu-section-text[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-text[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-primary);padding:5px 8px;border-radius:40px;font-size:12px;font-weight:500;display:flex;align-items:center;justify-content:center}.menu-section-text[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:12px}.menu-section-text[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.menu-section-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.menu-section-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px}.table-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;border-radius:8px}.table-line[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;border-bottom:1px solid #444953}.table-line-total[_ngcontent-%COMP%]{font-weight:500}.table-line[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{font-size:13px;color:#fff}.table-line[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:11px}.table-line-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:3px}.width-big[_ngcontent-%COMP%]{width:40%}.width-small[_ngcontent-%COMP%]{width:30%}.no-border[_ngcontent-%COMP%]{border:none!important}.input-form-icon-b[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content;height:36px;border-radius:12px;color:#fff;padding:0 12px;display:flex;align-items:center;gap:9px}.input-form-icon-b[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-form-icon-b[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{color:#fff;font-size:14px;width:100%;border:none;background:transparent;outline:0}.background-grey-translucent[_ngcontent-%COMP%]{background:rgba(65,69,78,.4)}.margin-auto[_ngcontent-%COMP%]{margin:auto}.remove-bottom[_ngcontent-%COMP%]{margin-bottom:-12px!important}.stats-titles[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:space-between;align-items:center}.stats-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:20px}.stats-icons[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:32px}.color-selected[_ngcontent-%COMP%]{color:var(--ion-color-primary)!important}.chart-container[_ngcontent-%COMP%]{display:block;width:100%!important}"]}),h})()}];let q=(()=>{var o;class h{}return(o=h).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[D.Bz.forChild(B),D.Bz]}),h})(),z=(()=>{var o;class h{}return(o=h).\u0275fac=function(a){return new(a||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[f.ez,U.u5,P.Pc,q,v.vQ,C.aw]}),h})()}}]);