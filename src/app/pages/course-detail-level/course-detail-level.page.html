<ion-content>
  <div class="content-size content-background-image status-bar-overlap">

    <div class="background-color-dark padding-wrapper">
      <div class="header-content mb-24">
        <img src="assets/icon/arrow-left.svg" class="cursor-pointer header-content-icon" (click)="goTo('course-detail',bookingId,dateBooking)" />
        <div *ngIf="selectedBooking" class="header-top-title" [title]="selectedBooking.course.name">
          {{selectedBooking.course.name}}
        </div>
      </div>

      <!--Only if group-->
      <div *ngIf="clientMonitor && clientMonitor.main" class="header-user-data mt-24">
        <div class="header-user-data-img">
          <img [src]="clientMonitor.main.image ? clientMonitor.main.image : 'assets/icon/icons-outline-default-avatar.svg'" />
        </div>
        <div class="header-user-data-text">
          <div class="header-user-data-text-top">
            <div class="color-light">
              <ng-container *ngIf="clientMonitor.main.language1_id">
                {{getLanguageById(clientMonitor.main.language1_id)}} Â·
              </ng-container>
              {{getCountryById(clientMonitor.main.country)}} Â· {{getBirthYears(clientMonitor.main.birth_date)}} {{ 'years' | translate }}
            </div>
          </div>
          <div class="header-user-data-text-title">
            <div>{{clientMonitor.main.first_name}} {{clientMonitor.main.last_name}}</div>
            <img src="assets/icon/icon-crown.png" />
          </div>
          <div class="header-user-data-text-icons">
            <!--<img class="cursor-pointer" src="assets/icon/icon-message-box.png" />-->
            <a *ngIf="isPhone(clientMonitor.main.phone)" [href]="'tel:' + clientMonitor.main.phone" class="icon-with-label">
              <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
              <span class="icon-label">M</span>
            </a>
            <a *ngIf="isPhone(clientMonitor.main.telephone)" [href]="'tel:' + clientMonitor.main.telephone" class="icon-with-label">
              <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
              <span class="icon-label">T</span>
            </a>
            <a *ngIf="clientMonitor.main.email" [href]="'mailto:' + clientMonitor.main.email"><img class="cursor-pointer" src="assets/icon/icon-mail-box.png" /></a>
            <!--<img class="cursor-pointer" src="assets/icon/icon-ticket-box.png" />-->

          </div>
        </div>
      </div>
      <!--/Only if group-->

      <!--Only if admin-->
      <div *ngIf="clientMonitor && !clientMonitor.main" class="header-user-data mt-24">
        <div class="header-user-data-img">
          <img [src]="clientMonitor.image ? clientMonitor.image : 'assets/icon/icons-outline-default-avatar.svg'" />
        </div>
        <div class="header-user-data-text">
          <div class="header-user-data-text-top">
            <div class="color-light">
              <ng-container *ngIf="clientMonitor.language1_id">
                {{getLanguageById(clientMonitor.language1_id)}} Â·
              </ng-container>
              {{getCountryById(clientMonitor.country)}} Â· {{clientMonitor.birth_years}} {{ 'years' | translate }}
            </div>
          </div>
          <div class="header-user-data-text-title">
            <div>{{clientMonitor.first_name}} {{clientMonitor.last_name}}</div>
          </div>
          <div class="header-user-data-text-icons">
            <!--<img class="cursor-pointer" src="assets/icon/icon-message-box.png" />-->
            <a *ngIf="isPhone(clientMonitor.phone)" [href]="'tel:' + clientMonitor.phone" class="icon-with-label">
              <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
              <span class="icon-label">M</span>
            </a>
            <a *ngIf="isPhone(clientMonitor.telephone)" [href]="'tel:' + clientMonitor.telephone" class="icon-with-label">
              <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
              <span class="icon-label">T</span>
            </a>
            <a *ngIf="clientMonitor.email" [href]="'mailto:' + clientMonitor.email"><img class="cursor-pointer" src="assets/icon/icon-mail-box.png" /></a>
            <!--<img class="cursor-pointer" src="assets/icon/icon-ticket-box.png" />-->

          </div>
        </div>
      </div>
      <!--/Only if admin-->

    </div>

    <div class="padding-wrapper">

      <div class="background-color-dark box-radius">

        <!--Only if group-->
        <div *ngIf="clientMonitor && clientMonitor.main" class="header-user-data padding-wrapper">
          <div class="header-user-data-img">
            <img [src]="clientMonitor.image ? clientMonitor.image : 'assets/icon/icons-outline-default-avatar.svg'" />
          </div>
          <div class="header-user-data-text">
            <div class="header-user-data-text-top">
              <div class="color-light">
                <ng-container *ngIf="clientMonitor.language1_id">
                  {{getLanguageById(clientMonitor.language1_id)}} Â·
                </ng-container>
                {{getCountryById(clientMonitor.country)}} Â· {{clientMonitor.birth_years}} {{ 'years' | translate }}
              </div>
            </div>
            <div class="header-user-data-text-title">
              <div>{{clientMonitor.first_name}} {{clientMonitor.last_name}}</div>
            </div>
            <div class="header-user-data-text-icons">
              <!--<img class="cursor-pointer" src="assets/icon/icon-message-box.png" />-->
              <a *ngIf="isPhone(clientMonitor.phone)" [href]="'tel:' + clientMonitor.phone" class="icon-with-label">
                <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
                <span class="icon-label">M</span>
              </a>
              <a *ngIf="isPhone(clientMonitor.telephone)" [href]="'tel:' + clientMonitor.telephone" class="icon-with-label">
                <img class="cursor-pointer" src="assets/icon/icon-phone-box.png" />
                <span class="icon-label">T</span>
              </a>
              <a *ngIf="clientMonitor.email" [href]="'mailto:' + clientMonitor.email"><img class="cursor-pointer" src="assets/icon/icon-mail-box.png" /></a>
              <!--<img class="cursor-pointer" src="assets/icon/icon-ticket-box.png" />-->

            </div>
          </div>
        </div>
        <!--/Only if group-->
        
        <div class="box-top-center">
          <div class="box-top-left">
            <div class="box-top-icon cursor-pointer">
              <ng-container *ngIf="selectedBooking && selectedBooking.course.sport && sports.length">
                <img [src]="selectedBooking.course.sport.icon_selected" />
                <div class="montserrat">
                  {{ selectedBooking.course.sport.name }}
                </div>
              </ng-container>
            </div>
          </div>

        </div>
        
        <div class="pt-24">
          <app-level-full *ngIf="clientMonitor && sportDegrees && sportDegrees.length"
            [allLevels]="sportDegrees"
            [selectLevel]="selectedLevelId"
            (levelSelected)="onLevelSelected($event)"
            [size]="280"
            class="cursor-pointer"></app-level-full>

          <div class="padding-wrapper mt-8">
            <div class="level-current-banner background-color-dark mb-12 level-current-clickable" (click)="resetToCurrentLevel()">
              <div class="level-current-label">{{ 'level_in_progress' | translate }}</div>
              <div class="level-current-value">{{ getLevelNameById(clientMonitor?.degree_sport) }}</div>
            </div>
            <div class="level-meta mb-16">
              <div class="level-meta-item level-meta-left level-meta-clickable" (click)="goToPreviousLevel()">
                <span class="level-meta-label">{{ 'previous_level' | translate }}</span>
                <span class="level-meta-value">{{ getPreviousLevelName() }}</span>
              </div>
              <div class="level-meta-item level-meta-right level-meta-clickable" (click)="goToNextLevel()">
                <span class="level-meta-label">{{ 'next_level' | translate }}</span>
                <span class="level-meta-value">{{ getNextLevelName() }}</span>
              </div>
            </div>
            <button class="content-button btn-back-primary montserrat level-cta" (click)="goToClientLevelSelected()">
              {{ 'evaluate_progress' | translate }}
            </button>
          </div>
        </div>
      </div>

      <div class="flex-title-selector mt-32 mb-8">
        <div class="flex-title-selector-interior">
          <div class="background-color-dark flex-title-selector-icon">
            <img src="assets/icon/icon-observations.png" />
          </div>
          <div class="flex-title-selector-text">
            {{ 'observations' | translate }}
            <ion-icon
              name="information-circle-outline"
              class="info-icon"
              (click)="toggleObservationsInfo($event)">
            </ion-icon>
            <div *ngIf="showObservationsInfo" class="observations-tooltip">
              {{ 'observations_sources_description' | translate }}
            </div>
          </div>
        </div>
      </div>

      <div class="observations-card" (click)="showObservationsInfo = false">
        <div class="observations-panel" [class.open]="showBookingNotes">
          <div class="panel-heading" (click)="toggleBookingNotes()">
            <div class="panel-title">{{ 'booking_notes' | translate }}</div>
            <ion-icon [name]="showBookingNotes ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showBookingNotes" class="panel-body">
            {{ selectedBooking?.booking?.notes || ('not_assigned' | translate) }}
          </div>
        </div>

        <div class="observations-panel" [class.open]="showSchoolNotes">
          <div class="panel-heading" (click)="toggleSchoolNotes()">
            <div class="panel-title">{{ 'school_notes' | translate }}</div>
            <ion-icon [name]="showSchoolNotes ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showSchoolNotes" class="panel-body">
            {{ selectedBooking?.booking?.notes_school || ('not_assigned' | translate) }}
          </div>
        </div>

        <div class="observations-panel" [class.open]="showClientObservations">
          <div class="panel-heading" (click)="toggleClientObservations()">
            <div class="panel-title">{{ 'client_observations' | translate }}</div>
            <ion-icon [name]="showClientObservations ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showClientObservations" class="panel-body">
            <div *ngIf="clientObservationHistory.length > 0; else noClientObservations">
              <div *ngFor="let obs of clientObservationHistory" class="observation-entry">
                {{ obs }}
              </div>
            </div>
            <ng-template #noClientObservations>
              <div class="observation-empty">{{ 'not_assigned' | translate }}</div>
            </ng-template>
          </div>
        </div>

      </div>

      <div class="flex-title-selector mt-32 mb-8">
        <div class="flex-title-selector-interior">
          <div class="background-color-dark flex-title-selector-icon">
            <img src="assets/icon/icon-award-level-grey.svg" />
          </div>
          <div class="flex-title-selector-text">
            {{ 'evaluation_section' | translate }}
          </div>
        </div>
      </div>

      <div class="observations-card evaluation-card">
        <div class="observations-panel" [class.open]="showEvaluationObservations">
          <div class="panel-heading" (click)="toggleEvaluationObservations()">
            <div class="panel-title">{{ 'evaluation_observations' | translate }}</div>
            <ion-icon [name]="showEvaluationObservations ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showEvaluationObservations" class="panel-body">
            {{ getEvaluationForSelectedLevel()?.observations || ('not_assigned' | translate) }}
          </div>
        </div>

        <div class="observations-panel" [class.open]="showMonitorComments">
          <div class="panel-heading" (click)="toggleMonitorComments()">
            <div class="panel-title">{{ 'monitor_comments' | translate }}</div>
            <ion-icon [name]="showMonitorComments ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showMonitorComments" class="panel-body">
            <div *ngIf="commentsLoading" class="mini-empty">{{ 'loading' | translate }}</div>
            <div *ngIf="!commentsLoading">
              <div *ngIf="getVisibleComments().length === 0" class="mini-empty">
                {{ 'no_comments' | translate }}
              </div>
              <div class="comment-mini" *ngFor="let comment of getVisibleComments()">
                <div class="comment-mini-text">{{ comment.comment }}</div>
                <div class="comment-mini-meta">
                  <span class="comment-mini-author">{{ getCommentAuthor(comment) }}</span>
                  <span>{{ comment.created_at | date:'short' }}</span>
                </div>
              </div>
              <button *ngIf="evaluationComments.length > commentsPreviewLimit" class="mini-toggle" (click)="toggleCommentsView()">
                {{ showAllComments ? ('show_less' | translate) : ('view_more' | translate) }}
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="flex-title-selector mt-32 mb-8">
        <div class="flex-title-selector-interior">
          <div class="background-color-dark flex-title-selector-icon">
            <img src="assets/icon/icon-historic.png" />
          </div>
          <div class="flex-title-selector-text">
            {{ 'historical' | translate }}
          </div>
        </div>
      </div>

      <div class="history-card">
        <div class="history-panel" [class.open]="showHistoryPanel">
          <div class="panel-heading" (click)="toggleHistoryPanel()">
            <div class="panel-title">{{ 'history' | translate }}</div>
            <ion-icon [name]="showHistoryPanel ? 'chevron-up-outline' : 'chevron-down-outline'"></ion-icon>
          </div>
          <div *ngIf="showHistoryPanel" class="history-body">
            <div *ngIf="historyLoading" class="mini-empty">
              {{ 'loading' | translate }}
            </div>
            <ng-container *ngIf="!historyLoading">
              <div *ngIf="getVisibleHistory().length === 0" class="mini-empty">
                {{ 'history_no_changes' | translate }}
              </div>
              <div class="history-mini" *ngFor="let entry of getVisibleHistory()">
                <div class="history-mini-title">{{ getHistoryTitle(entry) }}</div>
                <div class="history-mini-meta">
                  {{ getHistoryUserLabel(entry) }} · {{ entry.created_at | date:'short' }}
                </div>
                <div class="history-mini-detail" *ngIf="getHistorySummary(entry)">
                  {{ getHistorySummary(entry) }}
                </div>
              </div>
              <button *ngIf="evaluationHistory.length > historyPreviewLimit" class="mini-toggle" (click)="toggleHistoryView()">
                {{ showAllHistory ? ('show_less' | translate) : ('view_more' | translate) }}
              </button>
            </ng-container>
          </div>
        </div>
      </div>

      
    </div>

  </div>

</ion-content>
