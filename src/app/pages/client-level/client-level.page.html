<ion-content>
  <div class="content-size dark-background status-bar-overlap">

    <div class="padding-wrapper">
      <div class="header-content no-margin">
        <div class="montserrat level-back color-light cursor-pointer" (click)="goBackType()">
          Cancel
        </div>
      </div>
    </div>
    
    <div class="padding-wrapper">
      <div *ngIf="sportEvaluation" class="flex-sport">
        <img [src]="sportEvaluation.icon_selected" />
        <span class="montserrat">{{sportEvaluation.name}}</span>
      </div>
  </div>
    
        <app-level-wheel *ngIf="clientMonitor && sportDegrees && sportDegrees.length" [allLevels]="sportDegrees" 
          [currentLevel]="clientMonitor.degree_sport" (currentLevelChange)="onCurrentLevelChange($event)"></app-level-wheel>


        <div *ngIf="alreadyCompleted" class="completed-banner background-color-dark mt-12 pt-24 pb-24">
          Niveau terminé
        </div>
        
        <div class="padding-wrapper mt-12 mb-12">
          <div class="circle-list-title mb-24">
            <div>Objectifs</div>
            <span class="color-light">{{countGoalsCompleted()}}/{{filteredGoals.length}}</span>
          </div>
          <div class="circle-list">
            <ng-container *ngFor="let goal of filteredGoals;let i=index;">
              <div class="circle-list-item">
                <div class="montserrat circle-list-item-text">
                  {{goal.name}}
                </div>
              </div>
              <ion-range [disabled]="alreadyCompleted" [(ngModel)]="goal.score" [ticks]="true" [snaps]="true" step="5" [min]="0" [max]="10"></ion-range>
              <div class="range-labels mb-24">
                <div class="montserrat color-light">Non accompli</div>
                <div class="montserrat color-light">À améliorer</div>
                <div class="montserrat color-light">Accompli</div>
              </div>
            </ng-container>
          </div>

          <div class="input-label color-light montserrat mt-32">
            Observations:
          </div>
          <textarea [disabled]="alreadyCompleted" [(ngModel)]="observationsEvaluation" class="montserrat textarea-form background-color-dark" rows="5"></textarea>

          <ng-container *ngIf="allGoalsCompleted() && !alreadyCompleted">
            <div class="input-label color-light montserrat mt-12">
              CONFIRMATION DE NIVEAU
            </div>
            <div class="circle-list-item">
              <div class="custom-radio">
                <label class="simple-check-option">
                    <input type="checkbox" [(ngModel)]="completeLevel" />
                    <div class="custom-check"></div>
                </label>
              </div>
              <div class="montserrat color-light circle-list-item-text">
                Confirmez-vous qu'il a terminé le niveau?
              </div>
            </div>
          </ng-container>
        </div>

        <div class="padding-wrapper mt-12 pt-24 top-border-wrapper">

          <div class="flex-title-selector-text mb-12">
            Multimedia
          </div>

          <div class="media-list">
            <div *ngIf="!alreadyCompleted" class="media-list-item">
              <img (click)="toggleMultimedia()" src="assets/icon/icon-camera-photo-box.png" class="box-selector-image cursor-pointer" />
            </div>

            <!--Multimedia-->
            <div *ngFor="let multimedia of allMultimedia;let i = index" class="media-list-item">
              <img *ngIf="multimedia.type == 'image'" [src]="multimedia.file" (click)="viewMultimedia(multimedia.type,multimedia.file)" class="box-selector-image cursor-pointer">
              <video *ngIf="multimedia.type == 'video'" [src]="multimedia.file" (click)="viewMultimedia(multimedia.type,multimedia.file)" class="box-selector-image cursor-pointer" muted playsinline></video>
              <div *ngIf="multimedia.type == 'video'" class="media-list-video cursor-pointer" (click)="viewMultimedia(multimedia.type,multimedia.file)">
                <img src="assets/icon/play.png" />
              </div>
              <div *ngIf="!alreadyCompleted" (click)="deleteMultimedia(i)" class="media-close-box cursor-pointer">
                <img src="assets/icon/icon-close.png" />
              </div>
            </div>
          </div>

          <button *ngIf="!alreadyCompleted" (click)="saveEvaluation()" class="content-button btn-back-primary montserrat mt-32 mb-32">
            Sauver progrès
          </button>

          <button *ngIf="alreadyCompleted" class="content-button btn-back-grey montserrat mt-32 mb-32">
            Niveau terminé
          </button>
        </div>

  </div>
</ion-content>

<app-file-upload *ngIf="showMultimedia"
  title="Ajouter du multimédia"
  [allowImage]="true" 
  [allowVideo]="true" 
  (fileSelected)="addMultimedia($event)"
  (close)="toggleMultimedia()">
</app-file-upload>

<app-file-view *ngIf="showView"
  [type]="viewTypeSelected"
  [file]="viewFileSelected"
  (close)="toggleView()">
</app-file-view>